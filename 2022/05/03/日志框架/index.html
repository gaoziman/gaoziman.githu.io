<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>日志框架 | 爱笑的Gao的个人博客</title><meta name="keywords" content="JavaWeb,日志"><meta name="author" content="Gao"><meta name="copyright" content="Gao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="日志框架第一章 日志的概念一、概述 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。  在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的文件。记录是保持日志的行为。在最简单的情况下，消息被写入单个日志文件。 #二、日志的作用 调试 在Java项目调试时，查看栈信息可以方">
<meta property="og:type" content="article">
<meta property="og:title" content="日志框架">
<meta property="og:url" content="https://manamn.space/2022/05/03/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/index.html">
<meta property="og:site_name" content="爱笑的Gao的个人博客">
<meta property="og:description" content="日志框架第一章 日志的概念一、概述 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。  在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的文件。记录是保持日志的行为。在最简单的情况下，消息被写入单个日志文件。 #二、日志的作用 调试 在Java项目调试时，查看栈信息可以方">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/005BYqpggy1fwrgjhte8cj31hc0u0ds1.jpg">
<meta property="article:published_time" content="2022-05-03T03:41:26.000Z">
<meta property="article:modified_time" content="2022-05-06T03:52:36.358Z">
<meta property="article:author" content="Gao">
<meta property="article:tag" content="JavaWeb">
<meta property="article:tag" content="日志">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/005BYqpggy1fwrgjhte8cj31hc0u0ds1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://manamn.space/2022/05/03/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '日志框架',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-06 11:52:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="爱笑的Gao的个人博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">390</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">104</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-zhuye"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-yuedu"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link faa-float animated-hover"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/photos"><i class="fa-fw iconfont icon-xiangji1"></i><span> 照片墙</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-wo faa-float animated-hover"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://tva1.sinaimg.cn/large/005BYqpggy1fwrgjhte8cj31hc0u0ds1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">爱笑的Gao的个人博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-zhuye"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-yuedu"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link faa-float animated-hover"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/photos"><i class="fa-fw iconfont icon-xiangji1"></i><span> 照片墙</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-wo faa-float animated-hover"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">日志框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-03T03:41:26.000Z" title="发表于 2022-05-03 11:41:26">2022-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-06T03:52:36.358Z" title="更新于 2022-05-06 11:52:36">2022-05-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/JavaWeb/">JavaWeb</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="日志框架"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="日志框架"><a href="#日志框架" class="headerlink" title="日志框架"></a>日志框架</h1><h2 id="第一章-日志的概念"><a href="#第一章-日志的概念" class="headerlink" title="第一章 日志的概念"></a>第一章 日志的概念</h2><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p> 日志文件是用于记录系统操作事件的文件集合，可分为事件日志和消息日志。具有处理历史数据、诊断问题的追踪以及理解系统的活动等重要作用。</p>
<p> 在计算机中，日志文件是记录在操作系统或其他软件运行中发生的事件或在通信软件的不同用户之间的消息的文件。记录是保持日志的行为。在最简单的情况下，消息被写入单个日志文件。</p>
<h3 id="二、日志的作用"><a href="#二、日志的作用" class="headerlink" title="#二、日志的作用"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%8C%E3%80%81%E6%97%A5%E5%BF%97%E7%9A%84%E4%BD%9C%E7%94%A8">#</a>二、日志的作用</h3><ul>
<li><p>调试</p>
<p>在Java项目调试时，查看栈信息可以方便地知道当前程序的运行状态，输出的日志便于记录程序在之前的运行结果。如果你大量使用System.out或者System.err，这是一种最方便最有效的方法，但显得不够专业。</p>
</li>
<li><p>错误定位</p>
<p>不要以为项目能正确跑起来就可以高枕无忧，项目在运行一段时候后，可能由于数据问题，网络问题，内存问题等出现异常。这时日志可以帮助开发或者运维人员快速定位错误位置，提出解决方案。</p>
</li>
<li><p>数据分析</p>
<p>大数据的兴起，使得大量的日志分析成为可能，ELK也让日志分析门槛降低了很多。日志中蕴含了大量的用户数据，包括点击行为，兴趣偏好等，用户画像对于公司下一步的战略方向有一定指引作用。</p>
</li>
</ul>
<h3 id="三、接触过的日志"><a href="#三、接触过的日志" class="headerlink" title="#三、接触过的日志"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%89%E3%80%81%E6%8E%A5%E8%A7%A6%E8%BF%87%E7%9A%84%E6%97%A5%E5%BF%97">#</a>三、接触过的日志</h3><p>最简单的日志输出方式，我们每天都在使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;这个数的结果是：&quot;</span>+ num);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>以及错误日志：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.err.println(<span class="string">&quot;此处发生了异常&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>此类代码在程序的执行过程中没有什么实质的作用，但是却能打印一些中间变量，辅助我们调试和错误的排查。</p>
<p>日志系统我们也见过：</p>
<p>在tomcat中</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021105443307.a3ff32dd.png" alt="image-20211021105443307"></p>
<p>当我们的程序无法启动或者运行过程中产生问题，会有所记录，比如我的catalina.log中查看，发现确实有错误信息，这能帮我们迅速定位：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021105553886.9a0eb0bf.png" alt="image-20211021105553886"></p>
<p>而我们的System.err只能做到控制台打印日志，所以我们需要更强大日志框架来处理：</p>
<h3 id="四、主流日志框架"><a href="#四、主流日志框架" class="headerlink" title="#四、主流日志框架"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E5%9B%9B%E3%80%81%E4%B8%BB%E6%B5%81%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">#</a>四、主流日志框架</h3><ul>
<li>日志实现（具体干活的）：JUL（java util logging）、logback、log4j、log4j2</li>
<li>日志门面（指定规则的）：JCL（Jakarta Commons Logging）、slf4j（ Simple Logging Facade for Java）</li>
</ul>
<h2 id="第二章-JUL日志框架"><a href="#第二章-JUL日志框架" class="headerlink" title="第二章 JUL日志框架"></a>第二章 JUL日志框架</h2><p>JUL全称Java util Logging是java原生的日志框架，使用时不需要另外引用第三方类库，相对其他日志框 架使用方便，学习简单，能够在小型应用中灵活使用。</p>
<p>在JUL中有以下组件，我们先做了解，慢慢学习：</p>
<ul>
<li>Loggers：被称为记录器，应用程序通过获取Logger对象，调用其API来来发布日志信息。Logger 通常时应用程序访问日志系统的入口程序。</li>
<li>Appenders：也被称为Handlers，每个Logger都会关联一组Handlers，Logger会将日志交给关联 Handlers处理，由Handlers负责将日志做记录。Handlers在此是一个抽象，其具体的实现决定了 日志记录的位置可以是控制台、文件、网络上的其他日志服务或操作系统日志等。</li>
<li>Layouts：也被称为Formatters，它负责对日志事件中的数据进行转换和格式化。Layouts决定了 数据在一条日志记录中的最终形式。</li>
<li>Level：每条日志消息都有一个关联的日志级别。该级别粗略指导了日志消息的重要性和紧迫，我 可以将Level和Loggers，Appenders做关联以便于我们过滤消息。</li>
<li>Filters：过滤器，根据需要定制哪些信息会被记录，哪些信息会被放过。</li>
</ul>
<p><strong>总结一下就是：</strong></p>
<p> 用户使用Logger来进行日志记录，Logger持有若干个Handler，日志的输出操作是由Handler完成的。 在Handler在输出日志前，会经过Filter的过滤，判断哪些日志级别过滤放行哪些拦截，Handler会将日志内容输出到指定位置（日志文件、控制台等）。Handler在输出日志时会使用Layout，将输出内容进行排版。</p>
<h3 id="一、入门案例"><a href="#一、入门案例" class="headerlink" title="#一、入门案例"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B">#</a>一、入门案例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;myLogger&quot;</span>);</span><br><span class="line">    logger.info(<span class="string">&quot;信息&quot;</span>);</span><br><span class="line">    logger.warning(<span class="string">&quot;警告信息&quot;</span>);</span><br><span class="line">    logger.severe(<span class="string">&quot;严重信息&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021111645121.964a89ab.png" alt="image-20211021111645121"></p>
<h3 id="二、日志的级别"><a href="#二、日志的级别" class="headerlink" title="#二、日志的级别"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%8C%E3%80%81%E6%97%A5%E5%BF%97%E7%9A%84%E7%BA%A7%E5%88%AB">#</a>二、日志的级别</h3><p> jul中定义的日志级别，从上述例子中我们也看到使用info和warning打印出的日志有不同的前缀，通过给日志设置不同的级别可以清晰的从日志中区分出哪些是基本信息，哪些是调试信息，哪些是严重的异常。</p>
<p>（1）java.util.logging.Level中定义了日志的级别：</p>
<ol>
<li>SEVERE（最高值）</li>
<li>WARNING</li>
<li>INFO （默认级别）</li>
<li>CONFIG</li>
<li>FINE</li>
<li>FINER</li>
<li>FINEST（最低值）</li>
</ol>
<p>再例如：我们查看tomcat的日志，能明显的看到不同级别的日志，其实tomcat默认使用的就是JUL：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021112420933.acbc908d.png" alt="image-20211021112420933"></p>
<p>还有两个特殊的级别：</p>
<ul>
<li>OFF，可用来关闭日志记录。</li>
<li>ALL，启用所有消息的日志记录。</li>
</ul>
<p>虽然我们测试了7个日志级别，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogger</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(LoggerTest.class.getName());</span><br><span class="line">    logger.severe(<span class="string">&quot;severe&quot;</span>);</span><br><span class="line">    logger.warning(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">    logger.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    logger.config(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">    logger.fine(<span class="string">&quot;fine&quot;</span>);</span><br><span class="line">    logger.finer(<span class="string">&quot;finer&quot;</span>);</span><br><span class="line">    logger.finest(<span class="string">&quot;finest&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11</p>
<p>我们发现能够打印的只有三行，这是为什么呢？</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021112943297.146bb073.png" alt="image-20211021112943297"></p>
<p>我们找一下这个文件，下图是jdk11的日志配置文件：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021113111605.8c77f1ae.png" alt="image-20211021113111605"></p>
<p>或者在jdk1.8中：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021113311661.8a239252.png" alt="image-20211021113311661"></p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021113415090.8c59f8f9.png" alt="image-20211021113415090"></p>
<p>就可以看到系统默认在控制台打印的日志级别了，系统配置我们暂且不动，一会我们独立创建配置文件完成修改。</p>
<p>但是我们可以简单的看看这个日志配置了哪些内容：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">.level</span>= <span class="string">INFO</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># Handler specific properties.</span></span><br><span class="line"><span class="comment"># Describes specific configuration info for Handlers.</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># default file output is in user&#x27;s home directory.</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.pattern</span> = <span class="string">%h/java%u.log</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.limit</span> = <span class="string">50000</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.count</span> = <span class="string">1</span></span><br><span class="line"><span class="comment"># Default number of locks FileHandler can obtain synchronously.</span></span><br><span class="line"><span class="comment"># This specifies maximum number of attempts to obtain lock file by FileHandler</span></span><br><span class="line"><span class="comment"># implemented by incrementing the unique field %u as per FileHandler API documentation.</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.maxLocks</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.formatter</span> = <span class="string">java.util.logging.XMLFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Limit the message that are printed on the console to INFO and above.</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.level</span> = <span class="string">INFO</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="string">java.util.logging.SimpleFormatter</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</p>
<p> 在日志中我们发现了，貌似可以给这个日志对象添加各种handler就是处理器，比如ConsoleHandler专门处理控制台日志，FileHandler貌似可以处理文件，同时我们确实发现了他有这么一个方法：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021114314901.e1fd4727.png" alt="image-20211021114314901"></p>
<h3 id="三、日志配置"><a href="#三、日志配置" class="headerlink" title="#三、日志配置"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%89%E3%80%81%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE">#</a>三、日志配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogConfig</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 1.创建日志记录器对象</span></span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;com.ydlclass.log.JULTest&quot;</span>);</span><br><span class="line">    <span class="comment">// 一、自定义日志级别</span></span><br><span class="line">    <span class="comment">// a.关闭系统默认配置</span></span><br><span class="line">    logger.setUseParentHandlers(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// b.创建handler对象</span></span><br><span class="line">    <span class="type">ConsoleHandler</span> <span class="variable">consoleHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsoleHandler</span>();</span><br><span class="line">    <span class="comment">// c.创建formatter对象</span></span><br><span class="line">    <span class="type">SimpleFormatter</span> <span class="variable">simpleFormatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleFormatter</span>();</span><br><span class="line">    <span class="comment">// d.进行关联</span></span><br><span class="line">    consoleHandler.setFormatter(simpleFormatter);</span><br><span class="line">    logger.addHandler(consoleHandler);</span><br><span class="line">    <span class="comment">// e.设置日志级别</span></span><br><span class="line">    logger.setLevel(Level.ALL);</span><br><span class="line">    consoleHandler.setLevel(Level.ALL);</span><br><span class="line">    <span class="comment">// 二、输出到日志文件</span></span><br><span class="line">    <span class="type">FileHandler</span> <span class="variable">fileHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileHandler</span>(<span class="string">&quot;d:/logs/jul.log&quot;</span>);</span><br><span class="line">    fileHandler.setFormatter(simpleFormatter);</span><br><span class="line">    logger.addHandler(fileHandler);</span><br><span class="line">    <span class="comment">// 2.日志记录输出</span></span><br><span class="line">    logger.severe(<span class="string">&quot;severe&quot;</span>);</span><br><span class="line">    logger.warning(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">    logger.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    logger.config(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">    logger.fine(<span class="string">&quot;fine&quot;</span>);</span><br><span class="line">    logger.finer(<span class="string">&quot;finer&quot;</span>);</span><br><span class="line">    logger.finest(<span class="string">&quot;finest&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30</p>
<p>再次查看结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">严重: severe</span><br><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">警告: warning</span><br><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">信息: info</span><br><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">配置: config</span><br><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">详细: fine</span><br><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">较详细: finer</span><br><span class="line">10月 21, 2021 11:50:01 上午 com.ydlclass.entity.LoggerTest testConfig</span><br><span class="line">非常详细: finest</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</p>
<p>文件中也输出了正确的结果：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021115105181.2de920a7.png" alt="image-20211021115105181"></p>
<h3 id="四、-Logger之间的父子关系"><a href="#四、-Logger之间的父子关系" class="headerlink" title="#四、 Logger之间的父子关系"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E5%9B%9B%E3%80%81-logger%E4%B9%8B%E9%97%B4%E7%9A%84%E7%88%B6%E5%AD%90%E5%85%B3%E7%B3%BB">#</a>四、 Logger之间的父子关系</h3><p> JUL中Logger之间存在父子关系，这种父子关系通过树状结构存储，JUL在初始化时会创建一个顶层 RootLogger作为所有Logger父Logger，存储上作为树状结构的根节点。并父子关系通过名称来关联。默认子Logger会继承父Logger的属性。</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021123800692.68e5b1a2.png" alt="image-20211021123800692"></p>
<p>所有的logger实例都是由LoggerManager统一管理，不妨我们点进getLogger方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Logger <span class="title function_">demandLogger</span><span class="params">(String name, String resourceBundleName, Class&lt;?&gt; caller)</span> &#123;</span><br><span class="line">    <span class="type">LogManager</span> <span class="variable">manager</span> <span class="operator">=</span> LogManager.getLogManager();</span><br><span class="line">    <span class="keyword">if</span> (!SystemLoggerHelper.disableCallerCheck) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isSystem(caller.getModule())) &#123;</span><br><span class="line">            <span class="keyword">return</span> manager.demandSystemLogger(name, resourceBundleName, caller);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> manager.demandLogger(name, resourceBundleName, caller);</span><br><span class="line">    <span class="comment">// ends up calling new Logger(name, resourceBundleName, caller)</span></span><br><span class="line">    <span class="comment">// iff the logger doesn&#x27;t exist already</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11</p>
<p>我们可以看到LogManager是单例的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> LogManager <span class="title function_">getLogManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (manager != <span class="literal">null</span>) &#123;</span><br><span class="line">        manager.ensureLogManagerInitialized();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> manager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogParent</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger1</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;com.ydlclass.service&quot;</span>);</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger2</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;com.ydlclass&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;logger1 = &quot;</span> + logger1);</span><br><span class="line">    System.out.println(<span class="string">&quot;logger1.getParent() = &quot;</span> + logger1.getParent());</span><br><span class="line">    System.out.println(<span class="string">&quot;logger2 = &quot;</span> + logger2);</span><br><span class="line">    System.out.println(<span class="string">&quot;logger2.getParent() = &quot;</span> + logger2.getParent());</span><br><span class="line">    System.out.println(logger1.getParent() == logger2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">logger1 = java.util.logging.Logger@2b4bac49</span><br><span class="line">logger1.getParent() = java.util.logging.Logger<span class="meta">@fd07cbb</span></span><br><span class="line">logger2 = java.util.logging.Logger<span class="meta">@fd07cbb</span></span><br><span class="line">logger2.getParent() = java.util.logging.LogManager$RootLogger@3571b748</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogParent</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger1</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;com.ydlclass.service&quot;</span>);</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger2</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;com.ydlclass&quot;</span>);</span><br><span class="line">    <span class="comment">// 一、对logger2进行独立的配置</span></span><br><span class="line">    <span class="comment">// 1.关闭系统默认配置</span></span><br><span class="line">    logger2.setUseParentHandlers(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 2.创建handler对象</span></span><br><span class="line">    <span class="type">ConsoleHandler</span> <span class="variable">consoleHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsoleHandler</span>();</span><br><span class="line">    <span class="comment">// 3.创建formatter对象</span></span><br><span class="line">    <span class="type">SimpleFormatter</span> <span class="variable">simpleFormatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleFormatter</span>();</span><br><span class="line">    <span class="comment">// 4.进行关联</span></span><br><span class="line">    consoleHandler.setFormatter(simpleFormatter);</span><br><span class="line">    logger2.addHandler(consoleHandler);</span><br><span class="line">    <span class="comment">// 5.设置日志级别</span></span><br><span class="line">    logger2.setLevel(Level.ALL);</span><br><span class="line">    consoleHandler.setLevel(Level.ALL);</span><br><span class="line">    <span class="comment">// 测试logger1是否被logger2影响</span></span><br><span class="line">    logger1.severe(<span class="string">&quot;severe&quot;</span>);</span><br><span class="line">    logger1.warning(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">    logger1.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    logger1.config(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">    logger1.fine(<span class="string">&quot;fine&quot;</span>);</span><br><span class="line">    logger1.finer(<span class="string">&quot;finer&quot;</span>);</span><br><span class="line">    logger1.finest(<span class="string">&quot;finest&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> <span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">严重: severe</span><br><span class="line"><span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">警告: warning</span><br><span class="line"><span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">信息: info</span><br><span class="line"><span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">配置: config</span><br><span class="line"><span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">详细: fine</span><br><span class="line"><span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">较详细: finer</span><br><span class="line"><span class="number">10</span>月 <span class="number">21</span>, <span class="number">2021</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">15</span> 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">非常详细: finest</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45</p>
<h3 id="五、日志格式化"><a href="#五、日志格式化" class="headerlink" title="#五、日志格式化"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%94%E3%80%81%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F%E5%8C%96">#</a>五、日志格式化</h3><p>我们可以独立的实现日志格式化的Formatter，而不使用SimpleFormatter，我们可以做如下处理，最后返回的结果我们可以随意拼写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Formatter</span> <span class="variable">myFormatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Formatter</span>()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">format</span><span class="params">(LogRecord record)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> record.getLoggerName()+<span class="string">&quot;.&quot;</span> +record.getSourceMethodName() + <span class="string">&quot; &quot;</span> + LocalDateTime.ofInstant(record.getInstant(), ZoneId.systemDefault())+<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">            +record.getLevel()+<span class="string">&quot;: &quot;</span> +record.getMessage() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>结果为：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021131248992.5b512b7e.png" alt="image-20211021131248992"></p>
<p>当然我们参考一下SimpleFormatter的该方法的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// format string for printing the log record</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">getLoggingProperty</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> LogManager.getLogManager().getProperty(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span></span><br><span class="line">    SurrogateLogger.getSimpleFormat(SimpleFormatter::getLoggingProperty);</span><br><span class="line"></span><br><span class="line"><span class="type">ZonedDateTime</span> <span class="variable">zdt</span> <span class="operator">=</span> ZonedDateTime.ofInstant(</span><br><span class="line">    record.getInstant(), ZoneId.systemDefault());</span><br><span class="line"><span class="keyword">return</span> String.format(format,</span><br><span class="line">                     zdt,</span><br><span class="line">                     source,</span><br><span class="line">                     record.getLoggerName(),</span><br><span class="line">                     record.getLevel().getLocalizedLevelName(),</span><br><span class="line">                     message,</span><br><span class="line">                     throwable);</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<p>这个写法貌似比我们的写法高级一点，所以我们必须好好学一下String的format方法了。</p>
<h4 id="1、String的format方法"><a href="#1、String的format方法" class="headerlink" title="#1、String的format方法"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81string%E7%9A%84format%E6%96%B9%E6%B3%95">#</a>1、String的format方法</h4><p>String类的format()方法用于创建格式化的字符串以及连接多个字符串对象。</p>
<p>format()方法有两种重载形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">format</span><span class="params">(String format, Object... args)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Formatter</span>().format(format, args).toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">format</span><span class="params">(Locale l, String format, Object... args)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Formatter</span>(l).format(format, args).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>在这个方法中我们可以定义字符串模板，然后使用类似填空的方式将模板格式化成我们想要的结果字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">java</span> <span class="operator">=</span> String.format(<span class="string">&quot;hello %s&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>得到的结果就是hello world，我们可以把第一个参数当做模板， %s当做填空题，后边的可变参数当做答案。</p>
<h4 id="2、常用的转换符"><a href="#2、常用的转换符" class="headerlink" title="#2、常用的转换符"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_2%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84%E8%BD%AC%E6%8D%A2%E7%AC%A6">#</a>2、常用的转换符</h4><p>当然不同数据类型需要不同转换符完成字符串的转换，以下是不同类型的转化符列表：</p>
<table>
<thead>
<tr>
<th align="left">转换符</th>
<th align="left">详细说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>%s</strong></td>
<td align="left"><strong>字符串类型</strong></td>
<td align="left"><strong>“喜欢请收藏”</strong></td>
</tr>
<tr>
<td align="left">%c</td>
<td align="left">字符类型</td>
<td align="left">‘m’</td>
</tr>
<tr>
<td align="left">%b</td>
<td align="left">布尔类型</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left"><strong>%d</strong></td>
<td align="left"><strong>整数类型（十进制）</strong></td>
<td align="left"><strong>88</strong></td>
</tr>
<tr>
<td align="left">%x</td>
<td align="left">整数类型（十六进制）</td>
<td align="left">FF</td>
</tr>
<tr>
<td align="left">%o</td>
<td align="left">整数类型（八进制）</td>
<td align="left">77</td>
</tr>
<tr>
<td align="left"><strong>%f</strong></td>
<td align="left"><strong>浮点类型</strong></td>
<td align="left"><strong>8.888</strong></td>
</tr>
<tr>
<td align="left">%a</td>
<td align="left">十六进制浮点类型</td>
<td align="left">FF.35AE</td>
</tr>
<tr>
<td align="left">%e</td>
<td align="left">指数类型</td>
<td align="left">9.38e+5</td>
</tr>
<tr>
<td align="left"><strong>%n</strong></td>
<td align="left">换行符</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">%tx</td>
<td align="left">日期与时间类型（x代表不同的日期与时间转换符)</td>
<td align="left">后边详细说</td>
</tr>
</tbody></table>
<p>小例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(<span class="string">&quot;过年了，%s今年%d岁了，今天收了%f元的压岁钱!&quot;</span>,</span><br><span class="line">                <span class="string">&quot;小明&quot;</span>,<span class="number">5</span>,<span class="number">88.88</span>);</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">    过年了，小明今年<span class="number">5</span>岁了，今天收了<span class="number">88.880000</span>元的压岁钱!</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<p>这要比拼写字符串简单多了。</p>
<h4 id="3、特殊符号"><a href="#3、特殊符号" class="headerlink" title="#3、特殊符号"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_3%E3%80%81%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7">#</a>3、特殊符号</h4><p>接下来我们看几个特殊字符的常用搭配，可以实现一些高级功能：</p>
<table>
<thead>
<tr>
<th align="left">标志</th>
<th align="left">说明</th>
<th align="left">示例</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">为正数或者负数添加符号，因为一般整数不会主动加符号</td>
<td align="left">(“%+d”,15)</td>
<td align="left">+15</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">数字前面补0，用于对齐</td>
<td align="left">(“%04d”, 99)</td>
<td align="left">0099</td>
</tr>
<tr>
<td align="left">空格</td>
<td align="left">在整数之前添加指定数量的空格</td>
<td align="left">(“%4d”, 99)</td>
<td align="left">99</td>
</tr>
<tr>
<td align="left">,</td>
<td align="left">以“,”对数字分组(常用显示金额)</td>
<td align="left">(“%,f”, 9999.99)</td>
<td align="left">9,999.990000</td>
</tr>
<tr>
<td align="left">(</td>
<td align="left">使用括号包含负数</td>
<td align="left">(“%(f”, -99.99)</td>
<td align="left">(99.990000)</td>
</tr>
</tbody></table>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(&quot;过年了，%s今年%03d岁了，今天收了%,f元的压岁钱!&quot;,</span><br><span class="line">                &quot;小明&quot;,5,8888.88);</span><br><span class="line">                结果</span><br><span class="line">        过年了，小明今年005岁了，今天收了8,888.880000元的压岁钱!        </span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<p>默认情况下，我们的可变参数是安装顺序依次替换，但是我想重复利用可变参数那该怎么处理呢？</p>
<p>我们可以采用 在转换符中加<code>数字$</code>完成匹配：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(&quot;%1$s %1$s %1$s&quot;,&quot;小明&quot;);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>其中1$就代表第一个参数，那么2$就代表第二个参数了：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">小明 小明 小明</span><br></pre></td></tr></table></figure>

<p>1</p>
<h4 id="4、日期处理"><a href="#4、日期处理" class="headerlink" title="#4、日期处理"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_4%E3%80%81%E6%97%A5%E6%9C%9F%E5%A4%84%E7%90%86">#</a>4、日期处理</h4><p>第一个例子中有说到 %tx x代表日期转换符 我也顺便列举下日期转换符</p>
<table>
<thead>
<tr>
<th align="left">标志</th>
<th align="left">说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c</td>
<td align="left">包括全部日期和时间信息</td>
<td align="left">周四 10月 21 14:52:10 GMT+08:00 2021</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">“年-月-日”格式</td>
<td align="left">2021-10-21</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">“月&#x2F;日&#x2F;年”格式</td>
<td align="left">10&#x2F;21&#x2F;21</td>
</tr>
<tr>
<td align="left">r</td>
<td align="left">“HH:MM:SS PM”格式（12时制）</td>
<td align="left">02:53:20 下午</td>
</tr>
<tr>
<td align="left">T</td>
<td align="left">“HH:MM:SS”格式（24时制）</td>
<td align="left">14:53:39</td>
</tr>
<tr>
<td align="left">R</td>
<td align="left">“HH:MM”格式（24时制）</td>
<td align="left">14:53</td>
</tr>
<tr>
<td align="left">b</td>
<td align="left">月份本地化</td>
<td align="left">10月</td>
</tr>
<tr>
<td align="left">y</td>
<td align="left">两位的年</td>
<td align="left">21</td>
</tr>
<tr>
<td align="left">Y</td>
<td align="left">四位的年</td>
<td align="left">2021</td>
</tr>
<tr>
<td align="left">m</td>
<td align="left">月</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">日</td>
<td align="left">21</td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">24小时制的时</td>
<td align="left">14</td>
</tr>
<tr>
<td align="left">l</td>
<td align="left">12小时制的时</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">M</td>
<td align="left">分</td>
<td align="left">57</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">秒</td>
<td align="left">46</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">秒为单位的时间戳</td>
<td align="left">1634799527</td>
</tr>
<tr>
<td align="left">p</td>
<td align="left">上午还是下午</td>
<td align="left">下午</td>
</tr>
</tbody></table>
<p>我们可以使用以下三个类去进行格式化，其中可能存在不支持的情况，比如LocalDateTime不支持c：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(&quot;%tc&quot;,new Date());</span><br><span class="line">System.out.printf(&quot;%tc&quot;,ZonedDateTime.now());</span><br><span class="line">System.out.printf(&quot;%tF&quot;,LocalDateTime.now());</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3</p>
<p>此时我们使用debug查看，默认情况下的fomat，我们不妨来读一读：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021131531722.c04db0d5.png" alt="image-20211021131531722"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10月 21, 2021 2:23:42 下午 com.ydlclass.entity.LoggerTest testLogParent</span><br><span class="line">警告: warning</span><br></pre></td></tr></table></figure>

<p>1<br>2</p>
<h3 id="六、配置文件"><a href="#六、配置文件" class="headerlink" title="#六、配置文件"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">#</a>六、配置文件</h3><p>我们不妨看看一个文件处理器的源码是怎么读配置项的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LogManager</span> <span class="variable">manager</span> <span class="operator">=</span> LogManager.getLogManager();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">cname</span> <span class="operator">=</span> getClass().getName();</span><br><span class="line"></span><br><span class="line">        pattern = manager.getStringProperty(cname + <span class="string">&quot;.pattern&quot;</span>, <span class="string">&quot;%h/java%u.log&quot;</span>);</span><br><span class="line">        limit = manager.getLongProperty(cname + <span class="string">&quot;.limit&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (limit &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            limit = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        count = manager.getIntProperty(cname + <span class="string">&quot;.count&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            count = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        append = manager.getBooleanProperty(cname + <span class="string">&quot;.append&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        setLevel(manager.getLevelProperty(cname + <span class="string">&quot;.level&quot;</span>, Level.ALL));</span><br><span class="line">        setFilter(manager.getFilterProperty(cname + <span class="string">&quot;.filter&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        setFormatter(manager.getFormatterProperty(cname + <span class="string">&quot;.formatter&quot;</span>, <span class="keyword">new</span> <span class="title class_">XMLFormatter</span>()));</span><br><span class="line">        <span class="comment">// Initialize maxLocks from the logging.properties file.</span></span><br><span class="line">        <span class="comment">// If invalid/no property is provided 100 will be used as a default value.</span></span><br><span class="line">        maxLocks = manager.getIntProperty(cname + <span class="string">&quot;.maxLocks&quot;</span>, MAX_LOCKS);</span><br><span class="line">        <span class="keyword">if</span>(maxLocks &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            maxLocks = MAX_LOCKS;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            setEncoding(manager.getStringProperty(cname +<span class="string">&quot;.encoding&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                setEncoding(<span class="literal">null</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex2) &#123;</span><br><span class="line">                <span class="comment">// doing a setEncoding with null should always work.</span></span><br><span class="line">                <span class="comment">// assert false;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35</p>
<p>可以从以下源码中看到配置项：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileHandler</span> <span class="keyword">extends</span> <span class="title class_">StreamHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MeteredStream meter;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> append;</span><br><span class="line">    <span class="comment">// 限制文件大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> limit;       <span class="comment">// zero =&gt; no limit.</span></span><br><span class="line">    <span class="comment">// 控制日志文件的数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">    <span class="comment">// 日志文件的格式化方式</span></span><br><span class="line">    <span class="keyword">private</span> String pattern;</span><br><span class="line">    <span class="keyword">private</span> String lockFileName;</span><br><span class="line">    <span class="keyword">private</span> FileChannel lockFileChannel;</span><br><span class="line">    <span class="keyword">private</span> File files[];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_LOCKS</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// 可以理解为同时可以有多少个线程打开文件，源码中有介绍</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxLocks</span> <span class="operator">=</span> MAX_LOCKS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; locks = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<p>我们已经知道系统默认的配置文件的位置，那我们能不能自定义呢？当然可以了，我们从jdk中赋值一个配置文件过来：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">.level</span>= <span class="string">INFO</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># default file output is in user&#x27;s home directory.</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.pattern</span> = <span class="string">%h/java%u.log</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.limit</span> = <span class="string">50000</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.count</span> = <span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Default number of locks FileHandler can obtain synchronously.</span></span><br><span class="line"><span class="comment"># This specifies maximum number of attempts to obtain lock file by FileHandler</span></span><br><span class="line"><span class="comment"># implemented by incrementing the unique field %u as per FileHandler API documentation.</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.maxLocks</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.formatter</span> = <span class="string">java.util.logging.XMLFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Limit the message that are printed on the console to INFO and above.</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.level</span> = <span class="string">INFO</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="string">java.util.logging.SimpleFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># java.util.logging.SimpleFormatter.format=%4$s: %5$s [%1$tc]%n</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern = manager.getStringProperty(cname + &quot;.pattern&quot;, &quot;%h/java%u.log&quot;);</span><br></pre></td></tr></table></figure>

<p>1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> File <span class="title function_">generate</span><span class="params">(String pat, <span class="type">int</span> count, <span class="type">int</span> generation, <span class="type">int</span> unique)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(pat);</span><br><span class="line">    <span class="type">Path</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">sawg</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">sawu</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">word</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="type">Path</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (Path elem : path) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev = prev.resolveSibling(word.toString());</span><br><span class="line">            result = result == <span class="literal">null</span> ? prev : result.resolve(prev);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pattern</span> <span class="operator">=</span> elem.toString();</span><br><span class="line">        <span class="type">int</span> <span class="variable">ix</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        word.setLength(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (ix &lt; pattern.length()) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> pattern.charAt(ix);</span><br><span class="line">            ix++;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (ix &lt; pattern.length()) &#123;</span><br><span class="line">                ch2 = Character.toLowerCase(pattern.charAt(ix));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ch == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ch2 == <span class="string">&#x27;t&#x27;</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">tmpDir</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;java.io.tmpdir&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (tmpDir == <span class="literal">null</span>) &#123;</span><br><span class="line">                        tmpDir = System.getProperty(<span class="string">&quot;user.home&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    result = Paths.get(tmpDir);</span><br><span class="line">                    ix++;</span><br><span class="line">                    word.setLength(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ch2 == <span class="string">&#x27;h&#x27;</span>) &#123;</span><br><span class="line">                    result = Paths.get(System.getProperty(<span class="string">&quot;user.home&quot;</span>));</span><br><span class="line">                    <span class="keyword">if</span> (jdk.internal.misc.VM.isSetUID()) &#123;</span><br><span class="line">                        <span class="comment">// Ok, we are in a set UID program.  For safety&#x27;s sake</span></span><br><span class="line">                        <span class="comment">// we disallow attempts to open files relative to %h.</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;can&#x27;t use %h in set UID program&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ix++;</span><br><span class="line">                    word.setLength(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ch2 == <span class="string">&#x27;g&#x27;</span>) &#123;</span><br><span class="line">                    word = word.append(generation);</span><br><span class="line">                    sawg = <span class="literal">true</span>;</span><br><span class="line">                    ix++;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ch2 == <span class="string">&#x27;u&#x27;</span>) &#123;</span><br><span class="line">                    word = word.append(unique);</span><br><span class="line">                    sawu = <span class="literal">true</span>;</span><br><span class="line">                    ix++;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ch2 == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">                    word = word.append(<span class="string">&#x27;%&#x27;</span>);</span><br><span class="line">                    ix++;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            word = word.append(ch);</span><br><span class="line">        &#125;</span><br><span class="line">        prev = elem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">1</span> &amp;&amp; !sawg) &#123;</span><br><span class="line">        word = word.append(<span class="string">&#x27;.&#x27;</span>).append(generation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (unique &gt; <span class="number">0</span> &amp;&amp; !sawu) &#123;</span><br><span class="line">        word = word.append(<span class="string">&#x27;.&#x27;</span>).append(unique);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (word.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">n</span> <span class="operator">=</span> word.toString();</span><br><span class="line">        <span class="type">Path</span> <span class="variable">p</span> <span class="operator">=</span> prev == <span class="literal">null</span> ? Paths.get(n) : prev.resolveSibling(n);</span><br><span class="line">        result = result == <span class="literal">null</span> ? p : result.resolve(p);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        result = Paths.get(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (path.getRoot() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result.toFile();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> path.getRoot().resolve(result).toFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(System.getProperty(&quot;user.home&quot;) );</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>C:\Users\zn\java0.log</p>
<p>我们将拷贝的文件稍作修改：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">.level</span>= <span class="string">INFO</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># default file output is in user&#x27;s home directory.</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.pattern</span> = <span class="string">D:/log/java%u.log</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.limit</span> = <span class="string">50000</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.count</span> = <span class="string">1</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.maxLocks</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.formatter</span> = <span class="string">java.util.logging.XMLFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Limit the message that are printed on the console to INFO and above.</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.level</span> = <span class="string">INFO</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="string">java.util.logging.SimpleFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># java.util.logging.SimpleFormatter.format=%4$s: %5$s [%1$tc]%n</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 读取自定义配置文件</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span></span><br><span class="line">        JULTest.class.getClassLoader().getResourceAsStream(<span class="string">&quot;logging.properties&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取日志管理器对象</span></span><br><span class="line">    <span class="type">LogManager</span> <span class="variable">logManager</span> <span class="operator">=</span> LogManager.getLogManager();</span><br><span class="line">    <span class="comment">// 通过日志管理器加载配置文件</span></span><br><span class="line">    logManager.readConfiguration(in);</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;com.ydlclass.log.JULTest&quot;</span>);</span><br><span class="line">    logger.severe(<span class="string">&quot;severe&quot;</span>);</span><br><span class="line">    logger.warning(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">    logger.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    logger.config(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">    logger.fine(<span class="string">&quot;fine&quot;</span>);</span><br><span class="line">    logger.finer(<span class="string">&quot;finer&quot;</span>);</span><br><span class="line">    logger.finest(<span class="string">&quot;finest&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18</p>
<p>配置文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">handlers</span>= <span class="string">java.util.logging.ConsoleHandler,java.util.logging.FileHandler</span></span><br><span class="line"><span class="attr">.level</span>= <span class="string">INFO</span></span><br><span class="line"></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.pattern</span> = <span class="string">D:/logs/java%u.log</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.limit</span> = <span class="string">50000</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.count</span> = <span class="string">1</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.maxLocks</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.formatter</span> = <span class="string">java.util.logging.XMLFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Limit the message that are printed on the console to INFO and above.</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.level</span> = <span class="string">INFO</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="string">java.util.logging.SimpleFormatter</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021161011899.61d59d16.png" alt="image-20211021161011899"></p>
<p>文件中也出现了：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021161036728.94ce60b8.png" alt="image-20211021161036728"></p>
<p>打开日志发现是xml，因为这里用的就是XMLFormatter：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021161646767.03a8129f.png" alt="image-20211021161646767"></p>
<p>上边我们配置了两个handler给根Logger，我们还可以给其他的Logger做独立的配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">handlers</span> = <span class="string">java.util.logging.ConsoleHandler</span></span><br><span class="line"><span class="attr">.level</span> = <span class="string">INFO</span></span><br><span class="line"><span class="comment"># 对这个logger独立配置</span></span><br><span class="line"><span class="attr">com.ydlclass.handlers</span> = <span class="string">java.util.logging.FileHandler</span></span><br><span class="line"><span class="attr">com.ydlclass.level</span> = <span class="string">ALL</span></span><br><span class="line"><span class="attr">com.ydlclass.useParentHandlers</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 修改了名字</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.pattern</span> = <span class="string">D:/logs/ydl-java%u.log</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.limit</span> = <span class="string">50000</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.count</span> = <span class="string">1</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.maxLocks</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.formatter</span> = <span class="string">java.util.logging.SimpleFormatter</span></span><br><span class="line"><span class="comment"># 文件使用追加方式</span></span><br><span class="line"><span class="attr">java.util.logging.FileHandler.append</span> = <span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Limit the message that are printed on the console to INFO and above.</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.level</span> = <span class="string">INFO</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.formatter</span> = <span class="string">java.util.logging.SimpleFormatter</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 修改日志格式</span></span><br><span class="line"><span class="attr">java.util.logging.SimpleFormatter.format</span>=<span class="string">%4$s: %5$s [%1$tc]%n</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22</p>
<p>执行发现控制台没有内容，文件中有了，说明没有问题OK了：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021161557198.13d982f4.png" alt="image-20211021161557198"></p>
<p>日志出现以下内容：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021161911691.70526a4f.png" alt="image-20211021161911691"></p>
<h2 id="第三章-LOG4J-日志框架"><a href="#第三章-LOG4J-日志框架" class="headerlink" title="第三章 LOG4J 日志框架"></a>第三章 LOG4J 日志框架</h2><p> Log4j是Apache下的一款开源的日志框架。 官方网站： <a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/1.2/%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E6%AC%BE%E6%AF%94%E8%BE%83%E8%80%81%E7%9A%84%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%EF%BC%8C%E7%9B%AE%E5%89%8D%E6%96%B0%E7%9A%84log4j2%E5%81%9A%E4%BA%86%E5%BE%88%E5%A4%A7%E7%9A%84%E6%94%B9%E5%8A%A8%EF%BC%8C%E4%BB%BB%E7%84%B6%E6%9C%89%E4%B8%80%E4%BA%9B%E9%A1%B9%E7%9B%AE%E5%9C%A8%E4%BD%BF%E7%94%A8log4j%E3%80%82">http://logging.apache.org/log4j/1.2/，这是一款比较老的日志框架，目前新的log4j2做了很大的改动，任然有一些项目在使用log4j。</a></p>
<h3 id="一、入门案例-1"><a href="#一、入门案例-1" class="headerlink" title="#一、入门案例"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-1">#</a>一、入门案例</h3><ol>
<li>建立maven工程</li>
<li>添加依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;maven.compiler.source&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;maven.compiler.target&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27</p>
<ol>
<li>java代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogger</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(Log4jTest.class);</span><br><span class="line">    <span class="comment">// 日志记录输出</span></span><br><span class="line">    logger.info(<span class="string">&quot;hello log4j&quot;</span>);</span><br><span class="line">    <span class="comment">// 日志级别</span></span><br><span class="line">    logger.fatal(<span class="string">&quot;fatal&quot;</span>); <span class="comment">// 严重错误，一般会造成系统崩溃和终止运行</span></span><br><span class="line">    logger.error(<span class="string">&quot;error&quot;</span>); <span class="comment">// 错误信息，但不会影响系统运行</span></span><br><span class="line">    logger.warn(<span class="string">&quot;warn&quot;</span>); <span class="comment">// 警告信息，可能会发生问题</span></span><br><span class="line">    logger.info(<span class="string">&quot;info&quot;</span>); <span class="comment">// 程序运行信息，数据库的连接、网络、IO操作等</span></span><br><span class="line">    logger.debug(<span class="string">&quot;debug&quot;</span>); <span class="comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span></span><br><span class="line">    logger.trace(<span class="string">&quot;trace&quot;</span>); <span class="comment">// 追踪信息，记录程序的所有流程信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13</p>
<p>发现会有一些警告，JUL可以直接在控制台输出是因为他有默认的配置文件，而这个独立的第三方的日志框架却没有配置文件：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log4j:WARN No appenders could be found for logger (com.ydlclass.entity.Log4jTest).</span><br><span class="line">log4j:WARN Please initialize the log4j system properly.</span><br><span class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3</p>
<p>我们在执行代码之前，加上以下代码，他会初始化一个默认配置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BasicConfigurator.configure();</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0 [main] INFO com.ydlclass.entity.Log4jTest  - hello log4j</span><br><span class="line">1 [main] FATAL com.ydlclass.entity.Log4jTest  - fatal</span><br><span class="line">1 [main] ERROR com.ydlclass.entity.Log4jTest  - error</span><br><span class="line">1 [main] WARN com.ydlclass.entity.Log4jTest  - warn</span><br><span class="line">1 [main] INFO com.ydlclass.entity.Log4jTest  - info</span><br><span class="line">1 [main] DEBUG com.ydlclass.entity.Log4jTest  - debug</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6</p>
<p>从源码看，这一行代码给我们的RootLogger加入一个控制台的输出源，就和jul中的handler一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">root</span> <span class="operator">=</span> Logger.getRootLogger();</span><br><span class="line">    root.addAppender(<span class="keyword">new</span> <span class="title class_">ConsoleAppender</span>(<span class="keyword">new</span> <span class="title class_">PatternLayout</span>(<span class="string">&quot;%r [%t] %p %c %x - %m%n&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<p>log4j定义了以下的日志的级别，和JUL的略有不同：</p>
<ol>
<li>fatal 指出每个严重的错误事件将会导致应用程序的退出。</li>
<li>error 指出虽然发生错误事件，但仍然不影响系统的继续运行。</li>
<li>warn 表明会出现潜在的错误情形。</li>
<li>info 一般和在粗粒度级别上，强调应用程序的运行全程。</li>
<li>debug 一般用于细粒度级别上，对调试应用程序非常有帮助。</li>
<li>trace 是程序追踪，可以用于输出程序运行中的变量，显示执行的流程。</li>
</ol>
<p>和JUL一样：还有两个特殊的级别：OFF，可用来关闭日志记录。 ALL，启用所有消息的日志记录。</p>
<p>一般情况下，我们只使用4个级别，优先级从高到低为 ERROR &gt; WARN &gt; INFO &gt; DEBUG。</p>
<h3 id="二、组件讲解"><a href="#二、组件讲解" class="headerlink" title="#二、组件讲解"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%8C%E3%80%81%E7%BB%84%E4%BB%B6%E8%AE%B2%E8%A7%A3">#</a>二、组件讲解</h3><p> Log4J 主要由 Loggers (日志记录器)、Appenders（输出端）和 Layout（日志格式化器）组成。其中 Loggers 控制日志的输出级别与日志是否输出；Appenders 指定日志的输出方式（输出到控制台、文件 等）；Layout 控制日志信息的输出格式。</p>
<h4 id="1、Loggers"><a href="#1、Loggers" class="headerlink" title="#1、Loggers"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81loggers">#</a>1、Loggers</h4><p>日志记录器：负责收集处理日志记录，实例的命名就是类“XX”的full quailied name（类的全限定名）， Logger的名字大小写敏感，其命名有继承机制：例如：name为com.ydlclass.service的logger会继承 name为com.ydlclass的logger，和JUL一致。</p>
<p>Log4J中有一个特殊的logger叫做“root”，他是所有logger的根，也就意味着其他所有的logger都会直接 或者间接地继承自root。root logger可以用Logger.getRootLogger()方法获取。 JUL是不是也有一个名为<code>.</code>的根。</p>
<h4 id="2、Appenders"><a href="#2、Appenders" class="headerlink" title="#2、Appenders"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_2%E3%80%81appenders">#</a>2、Appenders</h4><p>Appender和JUL的Handler很像，用来指定日志输出到哪个地方，可以同时指定日志的输出目的地。Log4j 常用的输出目的地 有以下几种：</p>
<table>
<thead>
<tr>
<th>输出端类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ConsoleAppender</td>
<td>将日志输出到控制台</td>
</tr>
<tr>
<td>FileAppender</td>
<td>将日志输出到文件中</td>
</tr>
<tr>
<td>DailyRollingFileAppender</td>
<td>将日志输出到一个日志文件，并且每天输出到一个新的文件</td>
</tr>
<tr>
<td>RollingFileAppender</td>
<td>将日志信息输出到一个日志文件，并且指定文件的尺寸，当文件大 小达到指定尺寸时，会自动把文件改名，同时产生一个新的文件</td>
</tr>
<tr>
<td>JDBCAppender</td>
<td>把日志信息保存到数据库中</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置一个控制台输出源</span></span><br><span class="line"><span class="type">ConsoleAppender</span> <span class="variable">consoleAppender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsoleAppender</span>();</span><br><span class="line">consoleAppender.setName(<span class="string">&quot;ydl&quot;</span>);</span><br><span class="line">consoleAppender.setWriter(<span class="keyword">new</span> <span class="title class_">PrintWriter</span>(System.out));</span><br><span class="line">logger.addAppender(consoleAppender);</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<h4 id="3、Layouts"><a href="#3、Layouts" class="headerlink" title="#3、Layouts"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_3%E3%80%81layouts">#</a>3、Layouts</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Layout</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Layout</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">format</span><span class="params">(LoggingEvent loggingEvent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> loggingEvent.getLoggerName() + <span class="string">&quot; &quot;</span></span><br><span class="line">            +loggingEvent.getMessage() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">ignoresThrowable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">activateOptions</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<p>有一些默认的实现类：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Layout layout = new SimpleLayout();</span><br></pre></td></tr></table></figure>

<p>1</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021174447092.80a06256.png" alt="image-20211021174447092"></p>
<p>他的实现太简单了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">format</span><span class="params">(LoggingEvent event)</span> &#123;</span><br><span class="line">    sbuf.setLength(<span class="number">0</span>);</span><br><span class="line">    sbuf.append(event.getLevel().toString());</span><br><span class="line">    sbuf.append(<span class="string">&quot; - &quot;</span>);</span><br><span class="line">    sbuf.append(event.getRenderedMessage());</span><br><span class="line">    sbuf.append(LINE_SEP);</span><br><span class="line">    <span class="keyword">return</span> sbuf.toString();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<p> 还有一个比较常用的Layout，就是PatternLayout这个实现类，能够根据特定的占位符进行转化，和JUL很像，但是又不一样，我们庖丁解牛研究一番，首先看他的构造器，构造器中如果传入一个pattern字符串，他会根据这个pattern创建一个链表，这个链表具体干什么咱们慢慢往后看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">PatternLayout</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.pattern = pattern;</span><br><span class="line">    head = createPatternParser((pattern == <span class="literal">null</span>) ? DEFAULT_CONVERSION_PATTERN :</span><br><span class="line">                               pattern).parse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<p>将步骤拆解开来看，首先创建了一个解析器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> PatternParser <span class="title function_">createPatternParser</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PatternParser</span>(pattern);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3</p>
<p>查看parse方法，这个方法比较复杂我们简化来看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PatternConverter <span class="title function_">parse</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; patternLength) &#123;</span><br><span class="line">        ...此次省略了很多代码，但是可以从这个核心看出来</span><br><span class="line">        c = pattern.charAt(i++);</span><br><span class="line">        finalizeConverter(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p>
<p>而finalizeConverter做的工作大家就能看的很清楚了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalizeConverter</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">    <span class="type">PatternConverter</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">switch</span>(c) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">CategoryPatternConverter</span>(formattingInfo,</span><br><span class="line">					extractPrecisionOption());</span><br><span class="line">      <span class="comment">//LogLog.debug(&quot;CATEGORY converter.&quot;);</span></span><br><span class="line">      <span class="comment">//formattingInfo.dump();</span></span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">//处理类名的转化器</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">ClassNamePatternConverter</span>(formattingInfo,</span><br><span class="line">					 extractPrecisionOption());</span><br><span class="line">      <span class="comment">//LogLog.debug(&quot;CLASS_NAME converter.&quot;);</span></span><br><span class="line">      <span class="comment">//formattingInfo.dump();</span></span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">     <span class="comment">//处理时间的转化器</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">      <span class="type">String</span> <span class="variable">dateFormatStr</span> <span class="operator">=</span> AbsoluteTimeDateFormat.ISO8601_DATE_FORMAT;</span><br><span class="line">      DateFormat df;</span><br><span class="line">		... </span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">DatePatternConverter</span>(formattingInfo, df);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">//输出日志时间发生的位置，包括类名、线程、及在代码中的行数</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;F&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">LocationPatternConverter</span>(formattingInfo,</span><br><span class="line">					FILE_LOCATION_CONVERTER);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">LocationPatternConverter</span>(formattingInfo,</span><br><span class="line">					FULL_LOCATION_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">LocationPatternConverter</span>(formattingInfo,</span><br><span class="line">					LINE_LOCATION_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">BasicPatternConverter</span>(formattingInfo, MESSAGE_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">LocationPatternConverter</span>(formattingInfo,</span><br><span class="line">					METHOD_LOCATION_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">BasicPatternConverter</span>(formattingInfo, LEVEL_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">BasicPatternConverter</span>(formattingInfo,</span><br><span class="line">					 RELATIVE_TIME_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">BasicPatternConverter</span>(formattingInfo, THREAD_CONVERTER);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">BasicPatternConverter</span>(formattingInfo, NDC_CONVERTER);</span><br><span class="line">      <span class="comment">//LogLog.debug(&quot;NDC converter.&quot;);</span></span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;X&#x27;</span>:</span><br><span class="line">      <span class="type">String</span> <span class="variable">xOpt</span> <span class="operator">=</span> extractOption();</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">MDCPatternConverter</span>(formattingInfo, xOpt);</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      LogLog.error(<span class="string">&quot;Unexpected char [&quot;</span> +c+<span class="string">&quot;] at position &quot;</span>+i</span><br><span class="line">		   +<span class="string">&quot; in conversion patterrn.&quot;</span>);</span><br><span class="line">      pc = <span class="keyword">new</span> <span class="title class_">LiteralPatternConverter</span>(currentLiteral.toString());</span><br><span class="line">      currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addConverter(pc);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82</p>
<p>下边就是一个典型的链表结构的构建了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addConverter</span><span class="params">(PatternConverter pc)</span> &#123;</span><br><span class="line">    currentLiteral.setLength(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// Add the pattern converter to the list.</span></span><br><span class="line">    addToList(pc);</span><br><span class="line">    <span class="comment">// Next pattern is assumed to be a literal.</span></span><br><span class="line">    state = LITERAL_STATE;</span><br><span class="line">    <span class="comment">// Reset formatting info</span></span><br><span class="line">    formattingInfo.reset();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title function_">addToList</span><span class="params">(PatternConverter pc)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>) &#123;</span><br><span class="line">        head = tail = pc;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tail.next = pc;</span><br><span class="line">        tail = pc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<p> 构建完转化器链表之后，就是循环这个链表，一次处理对应的占位符了，他的核心的格式化的方法也是format方法，在format方法中是通过一个转化器链来完成转化的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">format</span><span class="params">(LoggingEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">// 在format方法中是通过一个转化器链来完成转化的</span></span><br><span class="line">    <span class="type">PatternConverter</span> <span class="variable">c</span> <span class="operator">=</span> head;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(c != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 这一句是核心，第一个参数是一个StringBuilder，第二个参数LoggingEvent</span></span><br><span class="line">      c.format(sbuf, event);</span><br><span class="line">      c = c.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sbuf.toString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p>
<p> 这里就是通过一个pattern字符串，这个字符串可能张这个样子（%-d{yyyy-MM-dd HH:mm:ss} [%t:%r] -[%p] %m%n），使用createPatternParser().parse()方法构建一个处理器的链表，这个每个处理器处理一个占位符比如（%d）。</p>
<p>进入c.format()方法，我们会进入一个抽象类PatternConverter中的format方法，里边的核心就是如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">format</span><span class="params">(StringBuffer sbuf, LoggingEvent e)</span> &#123;</span><br><span class="line">    <span class="comment">// 核心就是这一句</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> convert(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<p>log4j 其实采用类似 C 语言的 printf 函数的打印格式格式化日志信息，源码已经看过了，具体的占位符及其含义如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">%m 输出代码中指定的日志信息</span><br><span class="line">%p 输出日志级别，及 DEBUG、INFO 等</span><br><span class="line">%n 换行符（Windows平台的换行符为 &quot;\n&quot;，Unix 平台为 &quot;\n&quot;）</span><br><span class="line">%r 输出自应用启动到输出该 log 信息耗费的毫秒数</span><br><span class="line">%c 输出打印语句所属的类的全名</span><br><span class="line">%t 输出产生该日志的线程全名</span><br><span class="line">%d 输出服务器当前时间，默认为 ISO8601，也可以指定格式，如：%d&#123;yyyy年MM月dd日HH:mm:ss&#125;</span><br><span class="line">%l 输出日志时间发生的位置，包括类名、线程、及在代码中的行数。如：Test.main(Test.java:10)</span><br><span class="line">%F 输出日志消息产生时所在的文件名称</span><br><span class="line">%L 输出代码中的行号</span><br><span class="line">%% 输出一个 &quot;%&quot; 字符</span><br><span class="line">* 可以在 % 与字符之间加上修饰符来控制最小宽度、最大宽度和文本的对其方式。如：</span><br><span class="line">%5c 输出category名称，最小宽度是5，category&lt;5，默认的情况下右对齐</span><br><span class="line">%-5c 输出category名称，最小宽度是5，category&lt;5，&quot;-&quot;号指定左对齐,会有空格</span><br><span class="line">%.5c 输出category名称，最大宽度是5，category&gt;5，就会将左边多出的字符截掉，&lt;5不会有空格</span><br><span class="line">%20.30c category名称&lt;20补空格，并且右对齐，&gt;30字符，就从左边交远销出的字符截掉</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</p>
<p>举一个例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n</span><br><span class="line">打印：日期 [线程:毫秒数] - [日志级别] - 日志信息 换行</span><br></pre></td></tr></table></figure>

<p>1<br>2</p>
<p>尝试写一个：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLog</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 获取一个logger</span></span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(TestLog4j.class);</span><br><span class="line">    <span class="comment">// 创建一个layout</span></span><br><span class="line">    <span class="type">Layout</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PatternLayout</span>(<span class="string">&quot;%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建一个输出源</span></span><br><span class="line">    <span class="type">ConsoleAppender</span> <span class="variable">appender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsoleAppender</span>();</span><br><span class="line">    appender.setLayout(layout);</span><br><span class="line">    appender.setWriter(<span class="keyword">new</span> <span class="title class_">PrintWriter</span>(System.out));</span><br><span class="line">    logger.addAppender(appender);</span><br><span class="line">    logger.warn(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line"><span class="number">2021</span>-<span class="number">10</span>-<span class="number">21</span> <span class="number">21</span>:<span class="number">31</span>:<span class="number">05</span> [main:<span class="number">0</span>] -[WARN] warning</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</p>
<p>配置一个jdbcAppender</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JDBCAppender</span> <span class="variable">jdbcAppender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JDBCAppender</span>();</span><br><span class="line">jdbcAppender.setDriver(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">jdbcAppender.setURL(<span class="string">&quot;jdbc:mysql://localhost:3306/ydlclass?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&quot;</span>);</span><br><span class="line">jdbcAppender.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">jdbcAppender.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">jdbcAppender.setSql(<span class="string">&quot;INSERT INTO log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) values(&#x27;ydlclass&#x27;,&#x27;%d&#123;yyyy-MM-ddHH:mm:ss&#125;&#x27;,&#x27;%p&#x27;,&#x27;%c&#x27;,&#x27;%F&#x27;,&#x27;%t&#x27;,&#x27;%L&#x27;,&#x27;%l&#x27;,&#x27;%m&#x27;)&quot;</span>);</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `log` (</span><br><span class="line">    `log_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `project_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;目项名&#x27;</span>,</span><br><span class="line">    `create_date` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `level` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;优先级&#x27;</span>,</span><br><span class="line">    `category` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所在类的全名&#x27;</span>,</span><br><span class="line">    `file_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;输出日志消息产生时所在的文件名称 &#x27;</span>,</span><br><span class="line">    `thread_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;日志事件的线程名&#x27;</span>,</span><br><span class="line">    `line` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;号行&#x27;</span>,</span><br><span class="line">    `all_category` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;日志事件的发生位置&#x27;</span>,</span><br><span class="line">    `message` <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;输出代码中指定的消息&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`log_id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13</p>
<p>依赖</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.22&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<h3 id="三、配置"><a href="#三、配置" class="headerlink" title="#三、配置"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE">#</a>三、配置</h3><p>log4j不仅仅可以在控制台，文件文件中输出日志，甚至可以在数据库中，我们先使用配置的方式完成日志的输入：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定日志的输出级别与输出端</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">INFO,Console,ydl</span></span><br><span class="line"><span class="comment"># 控制台输出配置</span></span><br><span class="line"><span class="attr">log4j.appender.Console</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.Console.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.Console.layout.ConversionPattern</span>=<span class="string">%d [%t] %-5p [%c] - %m%n</span></span><br><span class="line"><span class="comment"># 文件输出配置</span></span><br><span class="line"><span class="attr">log4j.appender.ydl</span> = <span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="comment">#指定日志的输出路径</span></span><br><span class="line"><span class="attr">log4j.appender.ydl.File</span> = <span class="string">D:/logs/ydl.log</span></span><br><span class="line"><span class="attr">log4j.appender.ydl.Append</span> = <span class="string">true</span></span><br><span class="line"><span class="comment">#使用自定义日志格式化器</span></span><br><span class="line"><span class="attr">log4j.appender.ydl.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="comment">#指定日志的输出格式</span></span><br><span class="line"><span class="attr">log4j.appender.ydl.layout.ConversionPattern</span> = <span class="string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%t:%r] -[%p] %m%n</span></span><br><span class="line"><span class="comment">#指定日志的文件编码</span></span><br><span class="line"><span class="attr">log4j.appender.ydl.encoding</span>=<span class="string">UTF-8</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<p>有了这个配置文件我们些代码就简单了一些：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConfig</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 获取一个logger</span></span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(TestLog4j.class);</span><br><span class="line">    logger.warn(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">    <span class="number">2021</span>-<span class="number">10</span>-<span class="number">21</span> <span class="number">21</span>:<span class="number">37</span>:<span class="number">06</span>,<span class="number">705</span> [main] WARN  [com.ydlclass.TestLog4j] - warning</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</p>
<p>文件也有了：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021213817159.f1e0ce56.png" alt="image-20211021213817159"></p>
<p>内容：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021213845319.dcc33aa3.png" alt="image-20211021213845319"></p>
<p>我们查看了可是确实没有问题。</p>
<p> 当然日志配置文件是什么时候读取的呢？每一个logger都是LogManager创建的，而LogManager有一个静态代码块帮助我们解析配置文件，细节就不需要了解了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogManager</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@deprecated</span> This variable is for internal use only. It will</span></span><br><span class="line"><span class="comment">   * become package protected in future versions.</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_CONFIGURATION_FILE</span> <span class="operator">=</span> <span class="string">&quot;log4j.properties&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_XML_CONFIGURATION_FILE</span> <span class="operator">=</span> <span class="string">&quot;log4j.xml&quot;</span>;  </span><br><span class="line">   </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@deprecated</span> This variable is for internal use only. It will</span></span><br><span class="line"><span class="comment">   * become private in future versions.</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">public</span> String DEFAULT_CONFIGURATION_KEY=<span class="string">&quot;log4j.configuration&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@deprecated</span> This variable is for internal use only. It will</span></span><br><span class="line"><span class="comment">   * become private in future versions.</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">public</span> String CONFIGURATOR_CLASS_KEY=<span class="string">&quot;log4j.configuratorClass&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@deprecated</span> This variable is for internal use only. It will</span></span><br><span class="line"><span class="comment">  * become private in future versions.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_INIT_OVERRIDE_KEY</span> <span class="operator">=</span> </span><br><span class="line">                                                 <span class="string">&quot;log4j.defaultInitOverride&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">guard</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">private</span> RepositorySelector repositorySelector;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="comment">// By default we use a DefaultRepositorySelector which always returns &#x27;h&#x27;.</span></span><br><span class="line">      <span class="type">Hierarchy</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hierarchy</span>(<span class="keyword">new</span> <span class="title class_">RootLogger</span>((Level) Level.DEBUG));</span><br><span class="line">      repositorySelector = <span class="keyword">new</span> <span class="title class_">DefaultRepositorySelector</span>(h);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/** Search for the properties file log4j.properties in the CLASSPATH.  */</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">override</span> <span class="operator">=</span>OptionConverter.getSystemProperty(DEFAULT_INIT_OVERRIDE_KEY,</span><br><span class="line">                                                         <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// if there is no default init override, then get the resource</span></span><br><span class="line">      <span class="comment">// specified by the user or the default config file.</span></span><br><span class="line">      <span class="keyword">if</span>(override == <span class="literal">null</span> || <span class="string">&quot;false&quot;</span>.equalsIgnoreCase(override)) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="type">String</span> <span class="variable">configurationOptionStr</span> <span class="operator">=</span> OptionConverter.getSystemProperty(</span><br><span class="line">              DEFAULT_CONFIGURATION_KEY, </span><br><span class="line">              <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">          <span class="type">String</span> <span class="variable">configuratorClassName</span> <span class="operator">=</span> OptionConverter.getSystemProperty(</span><br><span class="line">              CONFIGURATOR_CLASS_KEY, </span><br><span class="line">              <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">          <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// if the user has not specified the log4j.configuration</span></span><br><span class="line">          <span class="comment">// property, we search first for the file &quot;log4j.xml&quot; and then</span></span><br><span class="line">          <span class="comment">// &quot;log4j.properties&quot;</span></span><br><span class="line">          <span class="keyword">if</span>(configurationOptionStr == <span class="literal">null</span>) &#123;	</span><br><span class="line">              url = Loader.getResource(DEFAULT_XML_CONFIGURATION_FILE);</span><br><span class="line">              <span class="keyword">if</span>(url == <span class="literal">null</span>) &#123;</span><br><span class="line">                  url = Loader.getResource(DEFAULT_CONFIGURATION_FILE);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                  url = <span class="keyword">new</span> <span class="title class_">URL</span>(configurationOptionStr);</span><br><span class="line">              &#125; <span class="keyword">catch</span> (MalformedURLException ex) &#123;</span><br><span class="line">                  <span class="comment">// so, resource is not a URL:</span></span><br><span class="line">                  <span class="comment">// attempt to get the resource from the class path</span></span><br><span class="line">                  url = Loader.getResource(configurationOptionStr); </span><br><span class="line">              &#125;	</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// If we have a non-null url, then delegate the rest of the</span></span><br><span class="line">          <span class="comment">// configuration to the OptionConverter.selectAndConfigure</span></span><br><span class="line">          <span class="comment">// method.</span></span><br><span class="line">          <span class="keyword">if</span>(url != <span class="literal">null</span>) &#123;</span><br><span class="line">              LogLog.debug(<span class="string">&quot;Using URL [&quot;</span>+url+<span class="string">&quot;] for automatic log4j configuration.&quot;</span>);</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                  OptionConverter.selectAndConfigure(url, configuratorClassName,</span><br><span class="line">                                                     LogManager.getLoggerRepository());</span><br><span class="line">              &#125; <span class="keyword">catch</span> (NoClassDefFoundError e) &#123;</span><br><span class="line">                  LogLog.warn(<span class="string">&quot;Error during default initialization&quot;</span>, e);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              LogLog.debug(<span class="string">&quot;Could not find resource: [&quot;</span>+configurationOptionStr+<span class="string">&quot;].&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          LogLog.debug(<span class="string">&quot;Default initialization of overridden by &quot;</span> + </span><br><span class="line">                       DEFAULT_INIT_OVERRIDE_KEY + <span class="string">&quot;property.&quot;</span>); </span><br><span class="line">      &#125;  </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94</p>
<p>还有更有意思的，我们可以直接添加一个数据源，讲日志输出到数据库中，就是一个和数据库链接的输出源而已：</p>
<p>加入一个数据库的日志输出源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysql</span></span><br><span class="line"><span class="attr">log4j.appender.logDB</span>=<span class="string">org.apache.log4j.jdbc.JDBCAppender</span></span><br><span class="line"><span class="attr">log4j.appender.logDB.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.logDB.Driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">log4j.appender.logDB.URL</span>=<span class="string">jdbc:mysql://localhost:3306/ssm</span></span><br><span class="line"><span class="attr">log4j.appender.logDB.User</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">log4j.appender.logDB.Password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">log4j.appender.logDB.Sql</span>=<span class="string">INSERT INTO log(project_name,create_date,level,category,file_name,thread_name,line,all_category,message) values(&#x27;ydlclass&#x27;,&#x27;%d&#123;yyyy-MM-ddHH:mm:ss&#125;&#x27;,&#x27;%p&#x27;,&#x27;%c&#x27;,&#x27;%F&#x27;,&#x27;%t&#x27;,&#x27;%L&#x27;,&#x27;%l&#x27;,&#x27;%m&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<p>需要</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `log` (</span><br><span class="line">    `log_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `project_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;目项名&#x27;</span>,</span><br><span class="line">    `create_date` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    `level` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;优先级&#x27;</span>,</span><br><span class="line">    `category` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所在类的全名&#x27;</span>,</span><br><span class="line">    `file_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;输出日志消息产生时所在的文件名称 &#x27;</span>,</span><br><span class="line">    `thread_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;日志事件的线程名&#x27;</span>,</span><br><span class="line">    `line` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;号行&#x27;</span>,</span><br><span class="line">    `all_category` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;日志事件的发生位置&#x27;</span>,</span><br><span class="line">    `message` <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;输出代码中指定的消息&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`log_id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</p>
<p>pom中添加驱动：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<p>再次执行：</p>
<p>发现除了控制台，文件，数据库中也有了日志了：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021215028322.46a6267d.png" alt="image-20211021215028322"></p>
<h3 id="四、自定义Logger"><a href="#四、自定义Logger" class="headerlink" title="#四、自定义Logger"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E5%9B%9B%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89logger">#</a>四、自定义Logger</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RootLogger配置</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span> = <span class="string">trace,console</span></span><br><span class="line"><span class="comment"># 自定义Logger</span></span><br><span class="line"><span class="attr">log4j.logger.com.ydlclass</span>= <span class="string">WARN,logDB</span></span><br><span class="line"><span class="attr">log4j.logger.org.apache</span> = <span class="string">error</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<p>由此我们发现，我们可以很灵活的自定义，组装不同logger的实现，接下来我们写代码测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDefineLogger</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger1</span> <span class="operator">=</span> Logger.getLogger(Log4jTest.class);</span><br><span class="line">    logger1.fatal(<span class="string">&quot;fatal&quot;</span>); <span class="comment">// 严重错误，一般会造成系统崩溃和终止运行</span></span><br><span class="line">    logger1.error(<span class="string">&quot;error&quot;</span>); <span class="comment">// 错误信息，但不会影响系统运行</span></span><br><span class="line">    logger1.warn(<span class="string">&quot;warn&quot;</span>); <span class="comment">// 警告信息，可能会发生问题</span></span><br><span class="line">    logger1.info(<span class="string">&quot;info&quot;</span>); <span class="comment">// 程序运行信息，数据库的连接、网络、IO操作等</span></span><br><span class="line">    logger1.debug(<span class="string">&quot;debug&quot;</span>); <span class="comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span></span><br><span class="line">    logger1.trace(<span class="string">&quot;trace&quot;</span>); <span class="comment">// 追踪信息，记录程序的所有流程信息</span></span><br><span class="line">    <span class="comment">// 自定义 org.apache</span></span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger2</span> <span class="operator">=</span> Logger.getLogger(Logger.class);</span><br><span class="line">    logger2.fatal(<span class="string">&quot;fatal logger2&quot;</span>); <span class="comment">// 严重错误，一般会造成系统崩溃和终止运行</span></span><br><span class="line">    logger2.error(<span class="string">&quot;error logger2&quot;</span>); <span class="comment">// 错误信息，但不会影响系统运行</span></span><br><span class="line">    logger2.warn(<span class="string">&quot;warn logger2&quot;</span>); <span class="comment">// 警告信息，可能会发生问题</span></span><br><span class="line">    logger2.info(<span class="string">&quot;info logger2&quot;</span>); <span class="comment">// 程序运行信息，数据库的连接、网络、IO操作等</span></span><br><span class="line">    logger2.debug(<span class="string">&quot;debug logger2&quot;</span>); <span class="comment">// 调试信息，一般在开发阶段使用，记录程序的变量、参数等</span></span><br><span class="line">    logger2.trace(<span class="string">&quot;trace logger2&quot;</span>); <span class="comment">// 追踪信息，记录程序的所有流程信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19</p>
<p>我们发现logger1的日志级别成了warn，并且在数据库中有了日志，logger2级别成了error，他们其实都继承了根logger的一些属性。</p>
<h2 id="第四章-日志门面"><a href="#第四章-日志门面" class="headerlink" title="第四章 日志门面"></a>第四章 日志门面</h2><p> 当我们的系统变的复杂的之后，难免会集成其他的系统，不同的系统之间可能会使用不同的日志系统。那么在一个系统中，我们的日志框架可能会出现多个，会出现混乱，而且随着时间的发展，可能会出现新的效率更高的日志系统，如果我们想切换代价会非常的大。如果我们的日志系统能和jdbc一样，有一套自己的规范，其他实现均按照规范去实现，就能很灵活的使用日志框架了。</p>
<p> 日志门面就是为了解决这个问题而出现的一种技术，日志门面是规范，其他的实现按照规范实现各自的日志框架即可，我们程序员基于日志门面编程即可。举个例子：日志门面就好比菜单，日志实现就好比厨师，我们去餐馆吃饭按照菜单点菜即可，厨师是谁其实不重要，但是有一个符合我口味的厨师当然会更好。</p>
<p>常见的日志门面： JCL、slf4j</p>
<p>常见的日志实现： JUL、log4j、logback、log4j2</p>
<p>日志框架出现的历史顺序：</p>
<p>log4j –&gt;JUL–&gt;JCL–&gt; slf4j –&gt; logback –&gt; log4j2</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021221729341.b92ee908.png" alt="image-20211021221729341"></p>
<h3 id="一、SLF4J日志门面"><a href="#一、SLF4J日志门面" class="headerlink" title="#一、SLF4J日志门面"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%80%E3%80%81slf4j%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2">#</a>一、SLF4J日志门面</h3><p> 简单日志门面(Simple Logging Facade For Java) SLF4J主要是为了给Java日志访问提供一套标准、规范的API框架，其主要意义在于提供接口，具体的实现可以交由其他日志框架，例如log4j和logback等。 当然slf4j自己也提供了功能较为简单的实现，但是一般很少用到。对于一般的Java项目而言，日志框架 会选择slf4j-api作为门面，配上具体的实现框架（log4j、logback等），中间使用桥接器完成桥接。官方网站： <a target="_blank" rel="noopener" href="https://www.slf4j.org/">https://www.slf4j.org/</a></p>
<p>SLF4J是目前市面上最流行的日志门面。现在的项目中，基本上都是使用SLF4J作为我们的日志系统。</p>
<p>SLF4J日志门面主要提供两大功能：</p>
<ol>
<li>日志框架的绑定</li>
<li>日志框架的桥接</li>
</ol>
<h4 id="1、阿里日志规约"><a href="#1、阿里日志规约" class="headerlink" title="#1、阿里日志规约"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81%E9%98%BF%E9%87%8C%E6%97%A5%E5%BF%97%E8%A7%84%E7%BA%A6">#</a>1、阿里日志规约</h4><ol>
<li>应用中不可直接使用日志系统（Log4j、Logback）中的API，而应依赖使用日志框架SLF4J中的API。使用门面模式的日志框架，有利于维护和各个类的日志处理方法统一。</li>
<li>日志文件推荐至少保存15天，因为有些异常具备以“周”为频次发生的特点。</li>
<li>应用中的扩展日志（如打点、临时监控、访问日志等）命名方式：appName_logType_logName.log。logType为日志类型，推荐分类有stats&#x2F;monitor&#x2F;visit 等；</li>
<li>logName为日志描述。这种命名的好处：通过文件名就可以知道日志文件属于哪个应用，哪种类型，有什么目的，这也有利于归类查找。</li>
<li>对trace&#x2F;debug&#x2F;info级别的日志输出，必须使用条件输出形式或者占位符的方式。</li>
<li>避免重复打印日志，否则会浪费磁盘空间。务必在日志配置文件中设置additivity&#x3D;false。</li>
<li>异常信息应该包括两类：案发现场信息和异常堆栈信息。如果不处理，那么通过关键字向上抛出。</li>
<li>谨慎地记录日志。生产环境禁止输出debug日志；有选择地输出info日志；如果使用warn记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免吧服务器磁盘撑爆，并及时删除这些观察日志。</li>
<li>可以使用warn日志级别记录用户输入参数错误的情况，避免当用户投诉时无所适从。</li>
</ol>
<h4 id="2、SLF4J实战"><a href="#2、SLF4J实战" class="headerlink" title="#2、SLF4J实战"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_2%E3%80%81slf4j%E5%AE%9E%E6%88%98">#</a>2、SLF4J实战</h4><p>（1）添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--slf4j core 使用slf4j必須添加--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--slf4j 自带的简单日志实现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p>
<p>（2）编写代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSlf4j</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明日志对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span></span><br><span class="line">            LoggerFactory.getLogger(TestSlf4j.class);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSlfSimple</span><span class="params">()</span>  &#123;</span><br><span class="line">        <span class="comment">//打印日志信息</span></span><br><span class="line">        LOGGER.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        LOGGER.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        LOGGER.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">        LOGGER.trace(<span class="string">&quot;trace&quot;</span>);</span><br><span class="line">        <span class="comment">// 使用占位符输出日志信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;lucy&quot;</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">18</span>;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;&#123;&#125;今年&#123;&#125;岁了！&quot;</span>, name, age);</span><br><span class="line">        <span class="comment">// 将系统异常信息写入日志</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// e.printStackTrace();</span></span><br><span class="line">            LOGGER.info(<span class="string">&quot;出现异常：&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26</p>
<p>slf4j支持占位符：</p>
<h4 id="3、绑定其他日志的实现（Binding）"><a href="#3、绑定其他日志的实现（Binding）" class="headerlink" title="#3、绑定其他日志的实现（Binding）"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_3%E3%80%81%E7%BB%91%E5%AE%9A%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E7%9A%84%E5%AE%9E%E7%8E%B0-binding">#</a>3、绑定其他日志的实现（Binding）</h4><p>如前所述，SLF4J支持各种日志框架。SLF4J发行版附带了几个称为“SLF4J绑定”的jar文件，每个绑定对应一个受支持的框架。</p>
<p><strong>使用slf4j的日志绑定流程:</strong></p>
<ol>
<li><p>添加slf4j-api的依赖</p>
</li>
<li><p>使用slf4j的API在项目中进行统一的日志记录</p>
</li>
<li><p>绑定具体的日志实现框架</p>
<p>a. 绑定已经实现了slf4j的日志框架,直接添加对应依赖</p>
<p>b. 绑定没有实现slf4j的日志框架,先添加日志的适配器,再添加实现类的依赖</p>
</li>
<li><p>slf4j有且仅有一个日志实现框架的绑定（如果出现多个默认使用第一个依赖日志实现）</p>
</li>
</ol>
<p>绑定jul的实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-jdk14<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p>
<p>绑定log4j的实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--slf4j core 使用slf4j必須添加--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- log4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<p> 要切换日志框架，只需替换类路径上的slf4j绑定。例如，要从java.util.logging切换到log4j，只需将 slf4j-jdk14-1.7.27.jar替换为slf4j-log4j12-1.7.27.jar即可。</p>
<p> SLF4J不依赖于任何特殊的类装载。实际上，每个SLF4J绑定在编译时都是硬连线的， 以使用一个且只有 一个特定的日志记录框架。例如，slf4j-log4j12-1.7.27.jar绑定在编译时绑定以使用log4j。</p>
<h4 id="4、桥接旧的日志框架（Bridging）"><a href="#4、桥接旧的日志框架（Bridging）" class="headerlink" title="#4、桥接旧的日志框架（Bridging）"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_4%E3%80%81%E6%A1%A5%E6%8E%A5%E6%97%A7%E7%9A%84%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6-bridging">#</a>4、桥接旧的日志框架（Bridging）</h4><p> 通常，您依赖的某些组件依赖于SLF4J以外的日志记录API。您也可以假设这些组件在不久的将来不会切换到SLF4J。为了解决这种情况，SLF4J附带了几个桥接模块，这些模块将对log4j，JCL和 java.util.logging API的调用重定向，就好像它们是对SLF4J API一样。</p>
<p> 就是你还用log4j的api写代码，但是具体的实现给你抽离了，我们依赖了一个中间层，这个层其实是用旧的api操作slf4j，而不是操作具体的实现。</p>
<p>桥接解决的是项目中日志的遗留问题，当系统中存在之前的日志API，可以通过桥接转换到slf4j的实现</p>
<ol>
<li>先去除之前老的日志框架的依赖，必须去掉。</li>
<li>添加SLF4J提供的桥接组件，这个组件就是模仿之前老的日志写了一套相同的api，只不过这个api是在调用slf4j的api。</li>
<li>为项目添加SLF4J的具体实现。</li>
</ol>
<p>迁移的方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 桥接的组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18</p>
<p>SLF4J提供的桥接器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- log4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jul --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jul-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--jcl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19</p>
<p>注意问题：</p>
<ol>
<li>jcl-over-slf4j.jar和 slf4j-jcl.jar不能同时部署。前一个jar文件将导致JCL将日志系统的选择委托给 SLF4J，后一个jar文件将导致SLF4J将日志系统的选择委托给JCL，从而导致无限循环。</li>
<li>log4j-over-slf4j.jar和slf4j-log4j12.jar不能同时出现</li>
<li>jul-to-slf4j.jar和slf4j-jdk14.jar不能同时出现</li>
<li>所有的桥接都只对Logger日志记录器对象有效，如果程序中调用了内部的配置类或者是 Appender,Filter等对象，将无法产生效果。</li>
</ol>
<h4 id="5、SLF4J原理解析"><a href="#5、SLF4J原理解析" class="headerlink" title="#5、SLF4J原理解析"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_5%E3%80%81slf4j%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90">#</a>5、SLF4J原理解析</h4><ol>
<li>SLF4J通过LoggerFactory加载日志具体的实现对象。</li>
<li>LoggerFactory在初始化的过程中，会通过performInitialization()方法绑定具体的日志实现。</li>
<li>在绑定具体实现的时候，通过类加载器，加载org&#x2F;slf4j&#x2F;impl&#x2F;StaticLoggerBinder.class</li>
<li>所以，只要是一个日志实现框架，在org.slf4j.impl包中提供一个自己的StaticLoggerBinder类，在其中提供具体日志实现的LoggerFactory就可以被SLF4J所加载</li>
</ol>
<p>在slf4j中创建logger的方法是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="type">ILoggerFactory</span> <span class="variable">iLoggerFactory</span> <span class="operator">=</span> getILoggerFactory();</span><br><span class="line">    <span class="keyword">return</span> iLoggerFactory.getLogger(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<p>继续进入查看，核心就是performInitialization();：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ILoggerFactory <span class="title function_">getILoggerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (LoggerFactory.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;</span><br><span class="line">                INITIALIZATION_STATE = ONGOING_INITIALIZATION;</span><br><span class="line">                performInitialization();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p>
<p>继续进入查看，核心就是bind()，这个方法应该就能绑定日志实现了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">performInitialization</span><span class="params">()</span> &#123;</span><br><span class="line">        bind();</span><br><span class="line">        <span class="keyword">if</span> (INITIALIZATION_STATE == SUCCESSFUL_INITIALIZATION) &#123;</span><br><span class="line">            versionSanityCheck();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>来到这里，看看绑定的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bind</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// 以下内容就绑定成功了</span></span><br><span class="line">            StaticLoggerBinder.getSingleton();</span><br><span class="line">            INITIALIZATION_STATE = SUCCESSFUL_INITIALIZATION;</span><br><span class="line">            reportActualBinding(staticLoggerBinderPathSet);</span><br><span class="line">            fixSubstituteLoggers();</span><br><span class="line">            replayEvents();</span><br><span class="line">            <span class="comment">// release all resources in SUBST_FACTORY</span></span><br><span class="line">            SUBST_FACTORY.clear();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoClassDefFoundError ncde) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> ncde.getMessage();</span><br><span class="line">            <span class="keyword">if</span> (messageContainsOrgSlf4jImplStaticLoggerBinder(msg)) &#123;</span><br><span class="line">                INITIALIZATION_STATE = NOP_FALLBACK_INITIALIZATION;</span><br><span class="line">                Util.report(<span class="string">&quot;Failed to load class \&quot;org.slf4j.impl.StaticLoggerBinder\&quot;.&quot;</span>);</span><br><span class="line">                Util.report(<span class="string">&quot;Defaulting to no-operation (NOP) logger implementation&quot;</span>);</span><br><span class="line">                Util.report(<span class="string">&quot;See &quot;</span> + NO_STATICLOGGERBINDER_URL + <span class="string">&quot; for further details.&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                failedBinding(ncde);</span><br><span class="line">                <span class="keyword">throw</span> ncde;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (java.lang.NoSuchMethodError nsme) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> nsme.getMessage();</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="literal">null</span> &amp;&amp; msg.contains(<span class="string">&quot;org.slf4j.impl.StaticLoggerBinder.getSingleton()&quot;</span>)) &#123;</span><br><span class="line">                INITIALIZATION_STATE = FAILED_INITIALIZATION;</span><br><span class="line">                Util.report(<span class="string">&quot;slf4j-api 1.6.x (or later) is incompatible with this binding.&quot;</span>);</span><br><span class="line">                Util.report(<span class="string">&quot;Your binding is version 1.5.5 or earlier.&quot;</span>);</span><br><span class="line">                Util.report(<span class="string">&quot;Upgrade your binding to version 1.6.x.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> nsme;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            failedBinding(e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unexpected initialization failure&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36</p>
<p>每一个日志实现的中间包都有一个StaticLoggerBinder：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021233331749.82120764.png" alt="image-20211021233331749"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticLoggerBinder</span> <span class="keyword">implements</span> <span class="title class_">LoggerFactoryBinder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The unique instance of this class.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">StaticLoggerBinder</span> <span class="variable">SINGLETON</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticLoggerBinder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the singleton of this class.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the StaticLoggerBinder singleton</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> StaticLoggerBinder <span class="title function_">getSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SINGLETON;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Declare the version of the SLF4J API this implementation is compiled against. </span></span><br><span class="line"><span class="comment">     * The value of this field is modified with each major release. </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// to avoid constant folding by the compiler, this field must *not* be final</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">REQUESTED_API_VERSION</span> <span class="operator">=</span> <span class="string">&quot;1.6.99&quot;</span>; <span class="comment">// !final</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">loggerFactoryClassStr</span> <span class="operator">=</span> Log4jLoggerFactory.class.getName();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The ILoggerFactory instance returned by the &#123;<span class="doctag">@link</span> #getLoggerFactory&#125;</span></span><br><span class="line"><span class="comment">     * method should always be the same object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ILoggerFactory loggerFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">StaticLoggerBinder</span><span class="params">()</span> &#123;</span><br><span class="line">        loggerFactory = <span class="keyword">new</span> <span class="title class_">Log4jLoggerFactory</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unused&quot;)</span></span><br><span class="line">            <span class="type">Level</span> <span class="variable">level</span> <span class="operator">=</span> Level.TRACE;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldError nsfe) &#123;</span><br><span class="line">            Util.report(<span class="string">&quot;This version of SLF4J requires log4j version 1.2.12 or later. See also http://www.slf4j.org/codes.html#log4j_version&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ILoggerFactory <span class="title function_">getLoggerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> loggerFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLoggerFactoryClassStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> loggerFactoryClassStr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50</p>
<h3 id="二、JCL-日志门面"><a href="#二、JCL-日志门面" class="headerlink" title="#二、JCL 日志门面"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%8C%E3%80%81jcl-%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2">#</a>二、JCL 日志门面</h3><p> 全称为Jakarta Commons Logging，是Apache提供的一个通用日志API。 改日志门面的使用并不是很广泛。</p>
<p> 它是为 “所有的Java日志实现”提供一个统一的接口，它自身也提供一个日志的实现，但是功能非常常弱 （SimpleLog）。所以一般不会单独使用它。他允许开发人员使用不同的具体日志实现工具: Log4j, Jdk 自带的日志（JUL)</p>
<p>JCL 有两个基本的抽象类：Log(基本记录器)和LogFactory(负责创建Log实例)。</p>
<h4 id="1、JCL入门"><a href="#1、JCL入门" class="headerlink" title="#1、JCL入门"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81jcl%E5%85%A5%E9%97%A8">#</a>1、JCL入门</h4><ol>
<li><p>建立maven工程</p>
</li>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
</li>
<li><p>入门代码</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JULTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuick</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建日志对象</span></span><br><span class="line">        <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(JULTest.class);</span><br><span class="line">        <span class="comment">// 日志记录输出</span></span><br><span class="line">        log.fatal(<span class="string">&quot;fatal&quot;</span>);</span><br><span class="line">        log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        log.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</p>
<p><strong>我们为什么要使用日志门面：</strong></p>
<ol>
<li>面向接口开发，不再依赖具体的实现类。减少代码的耦合</li>
<li>项目通过导入不同的日志实现类，可以灵活的切换日志框架</li>
<li>统一API，方便开发者学习和使用</li>
<li>统一配置便于项目日志的管理</li>
</ol>
<h4 id="2、JCL原理"><a href="#2、JCL原理" class="headerlink" title="#2、JCL原理"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_2%E3%80%81jcl%E5%8E%9F%E7%90%86">#</a>2、JCL原理</h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021231249663.5e859d81.png" alt="image-20211021231249663"></p>
<ol>
<li>通过LogFactory动态加载Log实现类</li>
</ol>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211020173040622.50e7df1f.png" alt="image-20211020173040622"></p>
<ol>
<li>日志门面支持的日志实现数组</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] classesToDiscover =</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;org.apache.commons.logging.impl.Log4JLogger&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;org.apache.commons.logging.impl.Jdk14Logger&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;org.apache.commons.logging.impl.Jdk13LumberjackLogger&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;org.apache.commons.logging.impl.SimpleLog&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<ol>
<li>获取具体的日志实现</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; classesToDiscover.length &amp;&amp; result == <span class="literal">null</span>; ++i) &#123;</span><br><span class="line">    result = <span class="built_in">this</span>.createLogFromClass(classesToDiscover[i], logCategory,</span><br><span class="line">                                     <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<h4 id="3、日志生态图："><a href="#3、日志生态图：" class="headerlink" title="#3、日志生态图："></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_3%E3%80%81%E6%97%A5%E5%BF%97%E7%94%9F%E6%80%81%E5%9B%BE">#</a>3、日志生态图：</h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211031103502365.06f774c0.png" alt="image-20211031103502365"></p>
<p>历史插曲：现在聊聊历史：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021121882?utm_source=tag-newest">https://segmentfault.com/a/1190000021121882?utm_source=tag-newest</a></p>
<h2 id="第五章-Logback的使用"><a href="#第五章-Logback的使用" class="headerlink" title="第五章 Logback的使用"></a>第五章 Logback的使用</h2><p>Logback是由log4j创始人设计的另一个开源日志组件，性能比log4j要好。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://logback.qos.ch/index.html">https://logback.qos.ch/index.html</a></p>
<p>Logback主要分为三个模块：</p>
<ul>
<li>logback-core：其它两个模块的基础模块</li>
<li>logback-classic：它是log4j的一个改良版本，同时它完整实现了slf4j API</li>
<li>logback-access：访问模块与Servlet容器集成提供通过Http来访问日志的功能 后续的日志代码都是通过SLF4J日志门面搭建日志系统，所以在代码是没有区别，主要是通过修改配置文件和pom.xml依赖</li>
</ul>
<h3 id="一、logback入门"><a href="#一、logback入门" class="headerlink" title="#一、logback入门"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%80%E3%80%81logback%E5%85%A5%E9%97%A8">#</a>一、logback入门</h3><ol>
<li>添加依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<ol>
<li>java代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLogback</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(TestLog4j.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogback</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//打印日志信息</span></span><br><span class="line">        logger.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        logger.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        logger.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">        logger.trace(<span class="string">&quot;trace&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</p>
<p>其实我们发现即使项目中没有引入slf4j我们这里也是用的slf4j门面进行编程。</p>
<p>1、</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211022094203520.a45a4bf3.png" alt="image-20211022094203520"></p>
<p>2、从logback’的pom依赖中我们看到slf4j，依赖会进行传递</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211022094404297.f7046835.png" alt="image-20211022094404297"></p>
<h3 id="二、源码解析"><a href="#二、源码解析" class="headerlink" title="#二、源码解析"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%8C%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">#</a>二、源码解析</h3><h4 id="1、spi机制"><a href="#1、spi机制" class="headerlink" title="#1、spi机制"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81spi%E6%9C%BA%E5%88%B6">#</a>1、spi机制</h4><p>SPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。他是一种服务发现机制。它通过在ClassPath路径下的META-INF&#x2F;services文件夹查找文件，自动加载文件里所定义的类。</p>
<p>主要是使用，java.util包下的ServiceLoader实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; ServiceLoader&lt;S&gt; <span class="title function_">load</span><span class="params">(Class&lt;S&gt; service, ClassLoader loader)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServiceLoader</span>&lt;&gt;(service, loader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<h4 id="2、源码解析"><a href="#2、源码解析" class="headerlink" title="#2、源码解析"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_2%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">#</a>2、源码解析</h4><p>源码看一下启动过程：</p>
<p>1、我们从日志工厂的常见看起，这里是slf4j的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(TestLog4j.class);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>核心方法只有一句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> getLogger(clazz.getName());</span><br><span class="line">    ...中间的逻辑判断省略掉</span><br><span class="line">    <span class="keyword">return</span> logger;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<p>看一下getLogger方法，这里是先获取日志工厂，在从工厂中提取日志对象，我们不考虑日志对象，主要看看日志工厂的环境怎么初始化的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="type">ILoggerFactory</span> <span class="variable">iLoggerFactory</span> <span class="operator">=</span> getILoggerFactory();</span><br><span class="line">    <span class="keyword">return</span> iLoggerFactory.getLogger(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<p>日志工厂的创建方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ILoggerFactory <span class="title function_">getILoggerFactory</span><span class="params">()</span> &#123;</span><br><span class="line">	...去掉其他的代码，从这一行看。</span><br><span class="line">    <span class="keyword">return</span> StaticLoggerBinder.getSingleton().getLoggerFactory();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<p>这里就进入了，StaticLoggerBinder这个对象，这是日志实现用来和slf4j进行绑定的类，从此就进入日志实现中了。</p>
<p>StaticLoggerBinder.getSingleton()这里看到出来是一个单例，来到这个类当中，我们看到，直接返回了defaultLoggerContext</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public ILoggerFactory getLoggerFactory() &#123;</span><br><span class="line">        if (!initialized) &#123;</span><br><span class="line">            return defaultLoggerContext;</span><br><span class="line">        &#125;</span><br><span class="line">... 省略其他</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>这是个日志上下文，一定保存了我们的环境，配置内容一定在这个里边，那么哪里初始化他了呢，我们能想到的就是静态代码块了：</p>
<p>我们发现这个类中还真有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    SINGLETON.init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3</p>
<p>我们看到init()方法中，有一个autoConfig()，感觉就像在自动配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ContextInitializer</span>(defaultLoggerContext).autoConfig();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JoranException je) &#123;</span><br><span class="line">            Util.report(<span class="string">&quot;Failed to auto configure default logger context&quot;</span>, je);</span><br><span class="line">        &#125;</span><br><span class="line">        ...其他省略</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p>
<p>默认配置：ContextInitializer类是初始化的关键：</p>
<p>自动配置是这么玩的，先找配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoConfig</span><span class="params">()</span> <span class="keyword">throws</span> JoranException &#123;</span><br><span class="line">        StatusListenerConfigHelper.installIfAsked(loggerContext);</span><br><span class="line">        <span class="comment">// 这就是去找配置文件</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> findURLOfDefaultConfigurationFile(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 解析配置</span></span><br><span class="line">            configureByResource(url);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 没有找到文件，就去使用spi机制找一个配置类，这个配置类是在web中用的</span></span><br><span class="line">            <span class="type">Configurator</span> <span class="variable">c</span> <span class="operator">=</span> EnvUtil.loadFromServiceLoader(Configurator.class);</span><br><span class="line">            <span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    c.setContext(loggerContext);</span><br><span class="line">                    c.configure(loggerContext);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LogbackException</span>(String.format(<span class="string">&quot;Failed to initialize Configurator: %s using ServiceLoader&quot;</span>, c != <span class="literal">null</span> ? c.getClass()</span><br><span class="line">                                    .getCanonicalName() : <span class="string">&quot;null&quot;</span>), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 如果没有找到，就做基本的配置</span></span><br><span class="line">                <span class="type">BasicConfigurator</span> <span class="variable">basicConfigurator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicConfigurator</span>();</span><br><span class="line">                basicConfigurator.setContext(loggerContext);</span><br><span class="line">                basicConfigurator.configure(loggerContext);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26</p>
<p>寻找配置文件的过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">GROOVY_AUTOCONFIG_FILE</span> <span class="operator">=</span> <span class="string">&quot;logback.groovy&quot;</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">AUTOCONFIG_FILE</span> <span class="operator">=</span> <span class="string">&quot;logback.xml&quot;</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">TEST_AUTOCONFIG_FILE</span> <span class="operator">=</span> <span class="string">&quot;logback-test.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> URL <span class="title function_">findURLOfDefaultConfigurationFile</span><span class="params">(<span class="type">boolean</span> updateStatus)</span> &#123;</span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">myClassLoader</span> <span class="operator">=</span> Loader.getClassLoaderOfObject(<span class="built_in">this</span>);</span><br><span class="line">    <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> findConfigFileURLFromSystemProperties(myClassLoader, updateStatus);</span><br><span class="line">    <span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    url = getResource(TEST_AUTOCONFIG_FILE, myClassLoader, updateStatus);</span><br><span class="line">    <span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    url = getResource(GROOVY_AUTOCONFIG_FILE, myClassLoader, updateStatus);</span><br><span class="line">    <span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> getResource(AUTOCONFIG_FILE, myClassLoader, updateStatus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureByResource</span><span class="params">(URL url)</span> <span class="keyword">throws</span> JoranException &#123;</span><br><span class="line">       <span class="keyword">if</span> (url == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;URL argument cannot be null&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">final</span> <span class="type">String</span> <span class="variable">urlString</span> <span class="operator">=</span> url.toString();</span><br><span class="line">       <span class="keyword">if</span> (urlString.endsWith(<span class="string">&quot;groovy&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">if</span> (EnvUtil.isGroovyAvailable()) &#123;</span><br><span class="line">               <span class="comment">// avoid directly referring to GafferConfigurator so as to avoid</span></span><br><span class="line">               <span class="comment">// loading groovy.lang.GroovyObject . See also http://jira.qos.ch/browse/LBCLASSIC-214</span></span><br><span class="line">               GafferUtil.runGafferConfiguratorOn(loggerContext, <span class="built_in">this</span>, url);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="type">StatusManager</span> <span class="variable">sm</span> <span class="operator">=</span> loggerContext.getStatusManager();</span><br><span class="line">               sm.add(<span class="keyword">new</span> <span class="title class_">ErrorStatus</span>(<span class="string">&quot;Groovy classes are not available on the class path. ABORTING INITIALIZATION.&quot;</span>, loggerContext));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (urlString.endsWith(<span class="string">&quot;xml&quot;</span>)) &#123;</span><br><span class="line">           <span class="type">JoranConfigurator</span> <span class="variable">configurator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JoranConfigurator</span>();</span><br><span class="line">           configurator.setContext(loggerContext);</span><br><span class="line">           configurator.doConfigure(url);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LogbackException</span>(<span class="string">&quot;Unexpected filename extension of file [&quot;</span> + url.toString() + <span class="string">&quot;]. Should be either .groovy or .xml&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22</p>
<p>基础配置的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicConfigurator</span> <span class="keyword">extends</span> <span class="title class_">ContextAwareBase</span> <span class="keyword">implements</span> <span class="title class_">Configurator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BasicConfigurator</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(LoggerContext lc)</span> &#123;</span><br><span class="line">        addInfo(<span class="string">&quot;Setting up default configuration.&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ConsoleAppender&lt;ILoggingEvent&gt; ca = <span class="keyword">new</span> <span class="title class_">ConsoleAppender</span>&lt;ILoggingEvent&gt;();</span><br><span class="line">        ca.setContext(lc);</span><br><span class="line">        ca.setName(<span class="string">&quot;console&quot;</span>);</span><br><span class="line">        LayoutWrappingEncoder&lt;ILoggingEvent&gt; encoder = <span class="keyword">new</span> <span class="title class_">LayoutWrappingEncoder</span>&lt;ILoggingEvent&gt;();</span><br><span class="line">        encoder.setContext(lc);</span><br><span class="line">        </span><br><span class="line"> </span><br><span class="line">        <span class="comment">// same as </span></span><br><span class="line">        <span class="comment">// PatternLayout layout = new PatternLayout();</span></span><br><span class="line">        <span class="comment">// layout.setPattern(&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;);</span></span><br><span class="line">        <span class="type">TTLLLayout</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TTLLLayout</span>();</span><br><span class="line"> </span><br><span class="line">        layout.setContext(lc);</span><br><span class="line">        layout.start();</span><br><span class="line">        encoder.setLayout(layout);</span><br><span class="line">        </span><br><span class="line">        ca.setEncoder(encoder);</span><br><span class="line">        ca.start();</span><br><span class="line">        </span><br><span class="line">        <span class="type">Logger</span> <span class="variable">rootLogger</span> <span class="operator">=</span> lc.getLogger(Logger.ROOT_LOGGER_NAME);</span><br><span class="line">        rootLogger.addAppender(ca);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31</p>
<p>我们先不说配置的事情，从源码中我们可以看出有几种配置，因为有了</p>
<p>我们先模仿BasicConfigurator写一个类，只做略微的改动：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfigurator</span> <span class="keyword">extends</span> <span class="title class_">ContextAwareBase</span> <span class="keyword">implements</span> <span class="title class_">Configurator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyConfigurator</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(LoggerContext lc)</span> &#123;</span><br><span class="line">        addInfo(<span class="string">&quot;Setting up default configuration.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ConsoleAppender&lt;ILoggingEvent&gt; ca = <span class="keyword">new</span> <span class="title class_">ConsoleAppender</span>&lt;ILoggingEvent&gt;();</span><br><span class="line">        ca.setContext(lc);</span><br><span class="line">        ca.setName(<span class="string">&quot;console&quot;</span>);</span><br><span class="line">        LayoutWrappingEncoder&lt;ILoggingEvent&gt; encoder = <span class="keyword">new</span> <span class="title class_">LayoutWrappingEncoder</span>&lt;ILoggingEvent&gt;();</span><br><span class="line">        encoder.setContext(lc);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// same as</span></span><br><span class="line">        <span class="comment">// PatternLayout layout = new PatternLayout();</span></span><br><span class="line">        <span class="comment">// layout.setPattern(&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;);</span></span><br><span class="line">        <span class="type">PatternLayout</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PatternLayout</span>();</span><br><span class="line">        layout.setPattern(<span class="string">&quot;%d&#123;HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        layout.setContext(lc);</span><br><span class="line">        layout.start();</span><br><span class="line">        encoder.setLayout(layout);</span><br><span class="line"></span><br><span class="line">        ca.setEncoder(encoder);</span><br><span class="line">        ca.start();</span><br><span class="line"></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">rootLogger</span> <span class="operator">=</span> lc.getLogger(Logger.ROOT_LOGGER_NAME);</span><br><span class="line">        rootLogger.addAppender(ca);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31</p>
<p>在resource中新建META-INF目录，下边在新建services文件夹，再新建一个名字我<code>ch.qos.logback.classic.spi.Configurator</code>的文件，</p>
<p>内容是：com.ydlclass.MyConfigurator</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211022111350444.a7af7dc8.png" alt="image-20211022111350444"></p>
<h3 id="三、三大组件"><a href="#三、三大组件" class="headerlink" title="#三、三大组件"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%89%E3%80%81%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6">#</a>三、三大组件</h3><p>1、appender，输出源，一个日志可以后好几个输出源</p>
<p>2、encoder，一个appender有一个encoder，负责将一个event事件转换成一组byte数组，并将转换后的字节数据输出到文件中。</p>
<p>Encoder负责把事件转换为字节数组，并把字节数组写到合适的输出流。因此，encoder可以控制在什么时候、把什么样的字节数组写入到其拥有者维护的输出流中。Encoder接口有两个实现类，LayoutWrappingEncoder与PatternLayoutEncoder。</p>
<p>注意：在logback 0.9.19 版之前没有 encoder。</p>
<p>在之前的版本里，多数 appender 依靠 layout 来把事件转换成字符串并用 java.io.Writer 把字符串输出。在之前的版本里，用户需要在 FileAppender里嵌入一个 PatternLayout。</p>
<p>3、layout，格式化数据将event事件转化为字符串，解析的过程</p>
<p>4、filter 过滤器</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LevelFilter levelFilter = new LevelFilter();</span><br><span class="line">        levelFilter.setOnMatch(FilterReply.DENY);</span><br><span class="line">        levelFilter.setLevel(Level.WARN);</span><br><span class="line">        levelFilter.start();</span><br><span class="line">        ca.addFilter(levelFilter);</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5</p>
<ol>
<li>%-5level</li>
<li>%d{yyyy-MM-dd HH:mm:ss.SSS}日期</li>
<li>%c类的完整名称</li>
<li>%M为method</li>
<li>%L为行号</li>
<li>%thread线程名称</li>
<li>%m或者%msg为信息</li>
<li>%n换行</li>
</ol>
<p>能看到logback的格式化信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternLayout</span> <span class="keyword">extends</span> <span class="title class_">PatternLayoutBase</span>&lt;ILoggingEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, String&gt; defaultConverterMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HEADER_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;#logback.classic pattern: &quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        defaultConverterMap.putAll(Parser.DEFAULT_COMPOSITE_CONVERTER_MAP);</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;d&quot;</span>, DateConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;date&quot;</span>, DateConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;r&quot;</span>, RelativeTimeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;relative&quot;</span>, RelativeTimeConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;level&quot;</span>, LevelConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;le&quot;</span>, LevelConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;p&quot;</span>, LevelConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;t&quot;</span>, ThreadConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;thread&quot;</span>, ThreadConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;lo&quot;</span>, LoggerConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;logger&quot;</span>, LoggerConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;c&quot;</span>, LoggerConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;m&quot;</span>, MessageConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;msg&quot;</span>, MessageConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;message&quot;</span>, MessageConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;C&quot;</span>, ClassOfCallerConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;class&quot;</span>, ClassOfCallerConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;M&quot;</span>, MethodOfCallerConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;method&quot;</span>, MethodOfCallerConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;L&quot;</span>, LineOfCallerConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;line&quot;</span>, LineOfCallerConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;F&quot;</span>, FileOfCallerConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;file&quot;</span>, FileOfCallerConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;X&quot;</span>, MDCConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;mdc&quot;</span>, MDCConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;ex&quot;</span>, ThrowableProxyConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;exception&quot;</span>, ThrowableProxyConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;rEx&quot;</span>, RootCauseFirstThrowableProxyConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;rootException&quot;</span>, RootCauseFirstThrowableProxyConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;throwable&quot;</span>, ThrowableProxyConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;xEx&quot;</span>, ExtendedThrowableProxyConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;xException&quot;</span>, ExtendedThrowableProxyConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;xThrowable&quot;</span>, ExtendedThrowableProxyConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;nopex&quot;</span>, NopThrowableInformationConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;nopexception&quot;</span>, NopThrowableInformationConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;cn&quot;</span>, ContextNameConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;contextName&quot;</span>, ContextNameConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;caller&quot;</span>, CallerDataConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;marker&quot;</span>, MarkerConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;property&quot;</span>, PropertyConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;n&quot;</span>, LineSeparatorConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;black&quot;</span>, BlackCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;red&quot;</span>, RedCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;green&quot;</span>, GreenCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;yellow&quot;</span>, YellowCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;blue&quot;</span>, BlueCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;magenta&quot;</span>, MagentaCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;cyan&quot;</span>, CyanCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;white&quot;</span>, WhiteCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;gray&quot;</span>, GrayCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldRed&quot;</span>, BoldRedCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldGreen&quot;</span>, BoldGreenCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldYellow&quot;</span>, BoldYellowCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldBlue&quot;</span>, BoldBlueCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldMagenta&quot;</span>, BoldMagentaCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldCyan&quot;</span>, BoldCyanCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;boldWhite&quot;</span>, BoldWhiteCompositeConverter.class.getName());</span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;highlight&quot;</span>, HighlightingCompositeConverter.class.getName());</span><br><span class="line"></span><br><span class="line">        defaultConverterMap.put(<span class="string">&quot;lsn&quot;</span>, LocalSequenceNumberConverter.class.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PatternLayout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.postCompileProcessor = <span class="keyword">new</span> <span class="title class_">EnsureExceptionHandling</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getDefaultConverterMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> defaultConverterMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doLayout</span><span class="params">(ILoggingEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isStarted()) &#123;</span><br><span class="line">            <span class="keyword">return</span> CoreConstants.EMPTY_STRING;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> writeLoopOnConverters(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getPresentationHeaderPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> HEADER_PREFIX;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br>105<br>106<br>107<br>108<br>109<br>110</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OutputStreamAppender</span><br></pre></td></tr></table></figure>

<p>1</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">protected void subAppend(E event) &#123;</span><br><span class="line">        if (!isStarted()) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            // this step avoids LBCLASSIC-139</span><br><span class="line">            if (event instanceof DeferredProcessingAware) &#123;</span><br><span class="line">                ((DeferredProcessingAware) event).prepareForDeferredProcessing();</span><br><span class="line">            &#125;</span><br><span class="line">            // the synchronization prevents the OutputStream from being closed while we</span><br><span class="line">            // are writing. It also prevents multiple threads from entering the same</span><br><span class="line">            // converter. Converters assume that they are in a synchronized block.</span><br><span class="line">            // lock.lock();</span><br><span class="line"></span><br><span class="line">            byte[] byteArray = this.encoder.encode(event);</span><br><span class="line">            writeBytes(byteArray);</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException ioe) &#123;</span><br><span class="line">            // as soon as an exception occurs, move to non-started state</span><br><span class="line">            // and add a single ErrorStatus to the SM.</span><br><span class="line">            this.started = false;</span><br><span class="line">            addStatus(new ErrorStatus(&quot;IO failure in appender&quot;, this, ioe));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public byte[] encode(E event) &#123;</span><br><span class="line">        String txt = layout.doLayout(event);</span><br><span class="line">        return convertToBytes(txt);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildLoggingEventAndAppend</span><span class="params">(<span class="keyword">final</span> String localFQCN, <span class="keyword">final</span> Marker marker, <span class="keyword">final</span> Level level, <span class="keyword">final</span> String msg, <span class="keyword">final</span> Object[] params,</span></span><br><span class="line"><span class="params">                                        <span class="keyword">final</span> Throwable t)</span> &#123;</span><br><span class="line">    <span class="type">LoggingEvent</span> <span class="variable">le</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoggingEvent</span>(localFQCN, <span class="built_in">this</span>, level, msg, t, params);</span><br><span class="line">    le.setMarker(marker);</span><br><span class="line">    callAppenders(le);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6</p>
<h3 id="四、logback配置"><a href="#四、logback配置" class="headerlink" title="#四、logback配置"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E5%9B%9B%E3%80%81logback%E9%85%8D%E7%BD%AE">#</a>四、logback配置</h3><p>Let us begin by discussing the initialization steps that logback follows to try to configure itself:</p>
<ol>
<li>Logback tries to find a file called <em>logback-test.xml</em> <a target="_blank" rel="noopener" href="http://logback.qos.ch/faq.html#configFileLocation">in the classpathopen in new window</a>.</li>
<li>If no such file is found, logback tries to find a file called <em>logback.groovy</em> <a target="_blank" rel="noopener" href="http://logback.qos.ch/faq.html#configFileLocation">in the classpathopen in new window</a>.</li>
<li>If no such file is found, it checks for the file <em>logback.xml</em> <a target="_blank" rel="noopener" href="http://logback.qos.ch/faq.html#configFileLocation">in the classpathopen in new window</a>..</li>
<li>If no such file is found, <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">service-provider loading facilityopen in new window</a> (introduced in JDK 1.6) is used to resolve the implementation of <a target="_blank" rel="noopener" href="http://logback.qos.ch/xref/ch/qos/logback/classic/spi/Configurator.html"><code>com.qos.logback.classic.spi.Configurator</code>open in new window</a> interface by looking up the file <em>META-INF\services\ch.qos.logback.classic.spi.Configurator</em> in the class path. Its contents should specify the fully qualified class name of the desired <code>Configurator</code> implementation.</li>
<li>If none of the above succeeds, logback configures itself automatically using the <a target="_blank" rel="noopener" href="http://logback.qos.ch/xref/ch/qos/logback/classic/BasicConfigurator.html"><code>BasicConfigurator</code>open in new window</a> which will cause logging output to be directed to the console.</li>
<li>基本配置信息</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">    %msg：日志消息，%n是换行符--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %c [%thread]</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %-5level %msg%n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    	Appender: 设置日志信息的去向,常用的有以下几个</span></span><br><span class="line"><span class="comment">        ch.qos.logback.core.ConsoleAppender (控制台)</span></span><br><span class="line"><span class="comment">        ch.qos.logback.core.rolling.RollingFileAppender (文件大小到达指定尺寸的时候产生一个新文件)</span></span><br><span class="line"><span class="comment">        ch.qos.logback.core.FileAppender (文件)</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>System.err<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  用来设置某一个包或者具体的某一个类的日志打印级别、以及指定&lt;appender&gt;。</span></span><br><span class="line"><span class="comment">                    &lt;loger&gt;仅有一个name属性，一个可选的level和一个可选的addtivity属性</span></span><br><span class="line"><span class="comment">                    name:</span></span><br><span class="line"><span class="comment">        用来指定受此logger约束的某一个包或者具体的某一个类。</span></span><br><span class="line"><span class="comment">            level:</span></span><br><span class="line"><span class="comment">        用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和</span></span><br><span class="line"><span class="comment">            OFF，</span></span><br><span class="line"><span class="comment">            如果未设置此属性，那么当前logger将会继承上级的级别。</span></span><br><span class="line"><span class="comment">            additivity:</span></span><br><span class="line"><span class="comment">        是否向上级loger传递打印信息。默认是true。</span></span><br><span class="line"><span class="comment">            &lt;logger&gt;可以包含零个或多个&lt;appender-ref&gt;元素，标识这个appender将会添加到这个</span></span><br><span class="line"><span class="comment">            logger</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            也是&lt;logger&gt;元素，但是它是根logger。默认debug</span></span><br><span class="line"><span class="comment">            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL</span></span><br><span class="line"><span class="comment">                和 OFF，</span></span><br><span class="line"><span class="comment">                &lt;root&gt;可以包含零个或多个&lt;appender-ref&gt;元素，标识这个appender将会添加到这个</span></span><br><span class="line"><span class="comment">                logger。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;ALL&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46</p>
<ol>
<li>FileAppender配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义属性 可以通过$&#123;name&#125;进行引用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %L [%thread] %m %n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    日志输出格式：</span></span><br><span class="line"><span class="comment">    %d&#123;pattern&#125;日期</span></span><br><span class="line"><span class="comment">    %m或者%msg为信息</span></span><br><span class="line"><span class="comment">    %M为method</span></span><br><span class="line"><span class="comment">    %L为行号</span></span><br><span class="line"><span class="comment">    %c类的完整名称</span></span><br><span class="line"><span class="comment">    %thread线程名称</span></span><br><span class="line"><span class="comment">    %n换行</span></span><br><span class="line"><span class="comment">    %-5level</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件存放目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log_dir&quot;</span> <span class="attr">value</span>=<span class="string">&quot;d:/logs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--控制台输出appender对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>System.err<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志文件输出appender对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.FileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log_dir&#125;/logback.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 生成html格式appender对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;htmlFile&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.FileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.html.HTMLLayout&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%level%d&#123;yyyy-MM-dd HH:mm:ss&#125;%c%M%L%thread%m<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log_dir&#125;/logback.html<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--RootLogger对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;all&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;htmlFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55</p>
<ol>
<li>RollingFileAppender配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义属性 可以通过$&#123;name&#125;进行引用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %L [%thread] %m %n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    日志输出格式：</span></span><br><span class="line"><span class="comment">    %d&#123;pattern&#125;日期</span></span><br><span class="line"><span class="comment">    %m或者%msg为信息</span></span><br><span class="line"><span class="comment">    %M为method</span></span><br><span class="line"><span class="comment">    %L为行号</span></span><br><span class="line"><span class="comment">    %c类的完整名称</span></span><br><span class="line"><span class="comment">    %thread线程名称</span></span><br><span class="line"><span class="comment">    %n换行</span></span><br><span class="line"><span class="comment">    %-5level</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件存放目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log_dir&quot;</span> <span class="attr">value</span>=<span class="string">&quot;d:/logs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--控制台输出appender对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>System.err<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件拆分和归档的appender对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;rollFile&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log_dir&#125;/roll_logback.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定日志文件拆分和压缩规则--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--通过指定压缩文件名称，来确定分割文件方式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log_dir&#125;/rolling.%d&#123;yyyy-MMdd&#125;.log%i.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--文件拆分大小--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>1MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--RootLogger对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;all&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;rollFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53</p>
<ol>
<li>Filter和异步日志配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义属性 可以通过$&#123;name&#125;进行引用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss&#125; %c %M</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %L [%thread] %m %n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    日志输出格式：</span></span><br><span class="line"><span class="comment">    %d&#123;pattern&#125;日期</span></span><br><span class="line"><span class="comment">    %m或者%msg为信息</span></span><br><span class="line"><span class="comment">    %M为method</span></span><br><span class="line"><span class="comment">    %L为行号</span></span><br><span class="line"><span class="comment">    %c类的完整名称</span></span><br><span class="line"><span class="comment">    %thread线程名称</span></span><br><span class="line"><span class="comment">    %n换行</span></span><br><span class="line"><span class="comment">    %-5level</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件存放目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log_dir&quot;</span> <span class="attr">value</span>=<span class="string">&quot;d:/logs/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--控制台输出appender对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--输出流对象 默认 System.out 改为 System.err--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>System.err<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件拆分和归档的appender对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;rollFile&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志格式配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log_dir&#125;roll_logback.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定日志文件拆分和压缩规则--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--通过指定压缩文件名称，来确定分割文件方式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log_dir&#125;rolling.%d&#123;yyyy-MMdd&#125;.log%i.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--文件拆分大小--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>1MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--filter配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--设置拦截日志级别--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>error<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--异步日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;async&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;rollFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--RootLogger对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;all&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;async&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自定义logger additivity表示是否从 rootLogger继承配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.ydlclass&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68</p>
<h3 id="五、logback-access的使用"><a href="#五、logback-access的使用" class="headerlink" title="#五、logback-access的使用"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%94%E3%80%81logback-access%E7%9A%84%E4%BD%BF%E7%94%A8">#</a>五、logback-access的使用</h3><p>在server.xml里的<code>&lt;host&gt;</code>标签下加上</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span>  <span class="attr">directory</span>=<span class="string">&quot;logs&quot;</span> <span class="attr">prefix</span>=<span class="string">&quot;localhost_access_log.&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;.txt&quot;</span>  <span class="attr">pattern</span>=<span class="string">&quot;common&quot;</span> <span class="attr">resolveHosts</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>1</p>
<p>就可以了，下面咱们逐一分析各个参数。</p>
<table>
<thead>
<tr>
<th>className</th>
<th>想配置访问日志？这就必须得写成这样。</th>
</tr>
</thead>
<tbody><tr>
<td>directory</td>
<td>这个东西是日志文件放置的目录，在tomcat下面有个logs文件夹，那里面是专门放置日志文件的，当然你也可以修改，我就给改成了D:\</td>
</tr>
<tr>
<td>prefix</td>
<td>这个是日志文件的名称前缀，我的日志名称为localhost_access_log.2007-09-22.txt，前面的前缀就是这个localhost_access_log</td>
</tr>
<tr>
<td>suffix</td>
<td>这就是后缀名啦，可以改成别的</td>
</tr>
<tr>
<td>pattern</td>
<td>这个是最主要的参数了，具体的咱们下面讲，这个参数的内容比较丰富。</td>
</tr>
<tr>
<td>resolveHosts</td>
<td>如果这个值是true的话，tomcat会将这个服务器IP地址通过DNS转换为主机名，如果是false，就直接写服务器IP地址啦</td>
</tr>
</tbody></table>
<p>To use logback-access with Tomcat, after downloading the logback distribution, place the files <em>logback-core-1.3.0-alpha10.jar</em> and <em>logback-access-1.3.0-alpha10.jar</em> under $TOMCAT_HOME&#x2F;lib&#x2F; directory, where $TOMCAT_HOME is the folder where you have installed Tomcat.</p>
<p>logback-access模块与Servlet容器（如Tomcat和Jetty）集成，以提供HTTP访问日志功能。我们可以使 用logback-access模块来替换tomcat的访问日志。</p>
<ol>
<li>将logback-access.jar与logback-core.jar复制到$TOMCAT_HOME&#x2F;lib&#x2F;目录下</li>
<li>修改$TOMCAT_HOME&#x2F;conf&#x2F;server.xml中的Host元素中添加：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Valve className=<span class="string">&quot;ch.qos.logback.access.tomcat.LogbackValve&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>1</p>
<ol>
<li>logback默认会在$TOMCAT_HOME&#x2F;conf下查找文件 logback-access.xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- always a good activate OnConsoleStatusListener --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">statusListener</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.status.OnConsoleStatusListener&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_DIR&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;catalina.base&#125;/logs&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_DIR&#125;/access.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>access.%d&#123;yyyy-MM-dd&#125;.log.zip<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 访问日志的格式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>combined<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%h %l %u %user %date &quot;%r&quot; %s %b</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>官方配置： <a target="_blank" rel="noopener" href="https://logback.qos.ch/access.html#configuration">https://logback.qos.ch/access.html#configuration</a></p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211026105800183.ab8ebe30.png" alt="image-20211026105800183"></p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211026105525146.c644841e.png" alt="image-20211026105525146"></p>
<h2 id="第六章-log4j2的使用"><a href="#第六章-log4j2的使用" class="headerlink" title="第六章 log4j2的使用"></a>第六章 log4j2的使用</h2><p>Apache Log4j2是对Log4j的升级版，参考了logback的一些优秀的设计，并且修复了一些问题，因此带来了一些重大的提升，主要有：</p>
<ul>
<li>异常处理，在logback中，Appender中的异常不会被应用感知到，但是在log4j2中，提供了一些异常处理机制。</li>
<li>性能提升， log4j2相较于log4j 和logback都具有很明显的性能提升，后面会有官方测试的数据。</li>
<li>自动重载配置，参考了logback的设计，当然会提供自动刷新参数配置，最实用的就是我们在生产 上可以动态的修改日志的级别而不需要重启应用。</li>
</ul>
<p>官网： <a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/">https://logging.apache.org/log4j/2.x/</a></p>
<h3 id="一、Log4j2入门"><a href="#一、Log4j2入门" class="headerlink" title="#一、Log4j2入门"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%80%E3%80%81log4j2%E5%85%A5%E9%97%A8">#</a>一、Log4j2入门</h3><p> 目前已经有三个门面了，其实不管是哪里都是江湖，都想写一个门面，一统江湖，所以log42出了提供日志实现以外，也拥有一套自己的独立的门面。</p>
<p> 目前市面上最主流的日志门面就是SLF4J，虽然Log4j2也是日志门面，因为它的日志实现功能非常强大，性能优越。所以大家一般还是将Log4j2看作是日志的实现，Slf4j + Log4j2应该是未来的大势所趋。</p>
<h4 id="1、使用log4j-api做门面"><a href="#1、使用log4j-api做门面" class="headerlink" title="#1、使用log4j-api做门面"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81%E4%BD%BF%E7%94%A8log4j-api%E5%81%9A%E9%97%A8%E9%9D%A2">#</a>1、使用log4j-api做门面</h4><p>（1）添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Log4j2 门面API--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Log4j2 日志实现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p>
<p>（2）JAVA代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLog4j2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LogManager.getLogger(TestLog4j2.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLog</span><span class="params">()</span>&#123;</span><br><span class="line">        LOGGER.fatal(<span class="string">&quot;fatal&quot;</span>);</span><br><span class="line">        LOGGER.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        LOGGER.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        LOGGER.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">        LOGGER.trace(<span class="string">&quot;trace&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15</p>
<p>结果：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211025151930142.628fd044.png" alt="image-20211025151930142"></p>
<h4 id="2、使用slf4j做门面"><a href="#2、使用slf4j做门面" class="headerlink" title="#2、使用slf4j做门面"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_2%E3%80%81%E4%BD%BF%E7%94%A8slf4j%E5%81%9A%E9%97%A8%E9%9D%A2">#</a>2、使用slf4j做门面</h4><p>使用slf4j作为日志的门面，使用log4j2作为日志的实现。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Log4j2 门面API--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Log4j2 日志实现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用slf4j作为日志的门面,使用log4j2来记录日志 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--为slf4j绑定日志实现 log4j2的适配器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.<span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(TestLog4j2.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSlf4j</span><span class="params">()</span>&#123;</span><br><span class="line">    LOG.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    LOG.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">    LOG.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">    LOG.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    LOG.trace(<span class="string">&quot;trace&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p>
<p>结果：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211025152411946.d567ba08.png" alt="image-20211025152411946"></p>
<p>我们看到log4j2的默认日志级别好像是error。</p>
<h3 id="二、Log4j2配置"><a href="#二、Log4j2配置" class="headerlink" title="#二、Log4j2配置"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%BA%8C%E3%80%81log4j2%E9%85%8D%E7%BD%AE">#</a>二、Log4j2配置</h3><h4 id="1、默认配置："><a href="#1、默认配置：" class="headerlink" title="#1、默认配置："></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#_1%E3%80%81%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">#</a>1、默认配置：</h4><p>DefaultConfiguration类中提供的默认配置将设置，</p>
<p>通过debug可以在LoggerContext类中发现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConfiguration</span>();</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>可以看到默认的root日志的layout</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211025170516097.5ab25742.png" alt="image-20211025170516097"></p>
<p>我们也能看到他的日志级别：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211025170538643.e0e00836.png" alt="image-20211025170538643"></p>
<p>我们能从默认配置类中看到一些默认的配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setToDefault</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// LOG4J2-1176 facilitate memory leak investigation</span></span><br><span class="line">    setName(DefaultConfiguration.DEFAULT_NAME + <span class="string">&quot;@&quot;</span> + Integer.toHexString(hashCode()));</span><br><span class="line">    <span class="keyword">final</span> Layout&lt;? <span class="keyword">extends</span> <span class="title class_">Serializable</span>&gt; layout = PatternLayout.newBuilder()</span><br><span class="line">        .withPattern(DefaultConfiguration.DEFAULT_PATTERN)</span><br><span class="line">        .withConfiguration(<span class="built_in">this</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Appender</span> <span class="variable">appender</span> <span class="operator">=</span> ConsoleAppender.createDefaultAppenderForLayout(layout);</span><br><span class="line">    appender.start();</span><br><span class="line">    addAppender(appender);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">LoggerConfig</span> <span class="variable">rootLoggerConfig</span> <span class="operator">=</span> getRootLogger();</span><br><span class="line">    rootLoggerConfig.addAppender(appender, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Level</span> <span class="variable">defaultLevel</span> <span class="operator">=</span> Level.ERROR;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">levelName</span> <span class="operator">=</span> PropertiesUtil.getProperties().getStringProperty(DefaultConfiguration.DEFAULT_LEVEL,</span><br><span class="line">                                                                              defaultLevel.name());</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Level</span> <span class="variable">level</span> <span class="operator">=</span> Level.valueOf(levelName);</span><br><span class="line">    rootLoggerConfig.setLevel(level != <span class="literal">null</span> ? level : defaultLevel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19</p>
<p>5 自定义配置文件位置</p>
<p>log4j2默认在classpath下查找配置文件，可以修改配置文件的位置。在非web项目中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/log4j2.xml&quot;</span>);</span><br><span class="line">	<span class="type">BufferedInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file));</span><br><span class="line">	<span class="keyword">final</span> <span class="type">ConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationSource</span>(in);</span><br><span class="line">	Configurator.initialize(<span class="literal">null</span>, source);</span><br><span class="line">	</span><br><span class="line">	<span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(<span class="string">&quot;mylog&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<p>如果是web项目，在web.xml中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>log4jConfiguration<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/conf/log4j2.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.apache.logging.log4j.web.Log4jServletContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>log4j2默认加载classpath下的 log4j2.xml 文件中的配置。事实上log4j2可以通过 XML、JSON、YAML 或properties格式进行配置：</p>
<p><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/configuration.html">https://logging.apache.org/log4j/2.x/manual/configuration.html</a></p>
<p>如果找不到配置文件，Log4j 将提供默认配置。DefaultConfiguration 类中提供的默认配置将设置：</p>
<ul>
<li>%d{HH:mm:ss.SSS} ，表示输出到毫秒的时间</li>
<li>%t，输出当前线程名称</li>
<li>%-5level，输出日志级别，-5表示左对齐并且固定输出5个字符，如果不足在右边补0</li>
<li>%logger，输出logger名称，因为Root Logger没有名称，所以没有输出</li>
<li>%msg，日志文本</li>
<li>%n，换行</li>
</ul>
<p>其他常用的占位符有：</p>
<ul>
<li>%F，输出所在的类文件名，如Client.java</li>
<li>%L，输出行号</li>
<li>%M，输出所在方法名</li>
<li>%l，输出语句所在的行数, 包括类名、方法名、文件名、行数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reconfigure</span><span class="params">(<span class="keyword">final</span> URI configURI)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">externalContext</span> <span class="operator">=</span> externalMap.get(EXTERNAL_CONTEXT_KEY);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> ClassLoader.class.isInstance(externalContext) ? (ClassLoader) externalContext : <span class="literal">null</span>;</span><br><span class="line">    LOGGER.debug(<span class="string">&quot;Reconfiguration started for context[name=&#123;&#125;] at URI &#123;&#125; (&#123;&#125;) with optional ClassLoader: &#123;&#125;&quot;</span>,</span><br><span class="line">                 contextName, configURI, <span class="built_in">this</span>, cl);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Configuration</span> <span class="variable">instance</span> <span class="operator">=</span> ConfigurationFactory.getInstance().getConfiguration(<span class="built_in">this</span>, contextName, configURI, cl);</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">        LOGGER.error(<span class="string">&quot;Reconfiguration failed: No configuration found for &#x27;&#123;&#125;&#x27; at &#x27;&#123;&#125;&#x27; in &#x27;&#123;&#125;&#x27;&quot;</span>, contextName, configURI, cl);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setConfiguration(instance);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * instance.start(); Configuration old = setConfiguration(instance); updateLoggers(); if (old != null) &#123;</span></span><br><span class="line"><span class="comment">             * old.stop(); &#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">location</span> <span class="operator">=</span> configuration == <span class="literal">null</span> ? <span class="string">&quot;?&quot;</span> : String.valueOf(configuration.getConfigurationSource());</span><br><span class="line">        LOGGER.debug(<span class="string">&quot;Reconfiguration complete for context[name=&#123;&#125;] at URI &#123;&#125; (&#123;&#125;) with optional ClassLoader: &#123;&#125;&quot;</span>,</span><br><span class="line">                     contextName, location, <span class="built_in">this</span>, cl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConfigurationFactory</span><br></pre></td></tr></table></figure>

<p>1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">final</span> ConfigurationFactory factory : getFactories()) &#123;</span><br><span class="line">    <span class="keyword">final</span> String[] types = factory.getSupportedTypes();</span><br><span class="line">    <span class="keyword">if</span> (types != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">final</span> String type : types) &#123;</span><br><span class="line">            <span class="keyword">if</span> (type.equals(ALL_TYPES)) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> factory.getConfiguration(loggerContext, name, configLocation);</span><br><span class="line">                <span class="keyword">if</span> (config != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> config;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211025180117043.7c5baa95.png" alt="image-20211025180117043"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;warn&quot;</span> <span class="attr">monitorInterval</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span>&gt;</span>D:/logs<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;HH:mm:ss.SSS&#125; [%t] [%-5level] %c&#123;36&#125;:%L -</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    -- %m%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %c&#123;36&#125; - %m%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RandomAccessFile</span> <span class="attr">name</span>=<span class="string">&quot;accessFile&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/myAcclog.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %c&#123;36&#125; - %m%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RandomAccessFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;rollingFile&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/myrollog.log&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">filePattern</span>=<span class="string">&quot;D:/logs/$$&#123;date:yyyy-MM-dd&#125;/myrollog-%d&#123;yyyyMM-dd-HH-mm&#125;-%i.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%-5level] %l</span></span></span><br><span class="line"><span class="string"><span class="tag">                                    %c&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">OnStartupTriggeringPolicy</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10 MB&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingRandomAccessFile</span> <span class="attr">name</span>=<span class="string">&quot;MyFile&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">fileName</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/$&#123;FILE_NAME&#125;.log&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">filePattern</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/$$&#123;date:yyyy-MM&#125;/$&#123;FILE_NAME&#125;-%d&#123;yyyy-MM-dd HH-mm&#125;-%i.log&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">PatternLayout</span></span></span><br><span class="line"><span class="tag">				<span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10 MB&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">RollingRandomAccessFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">&quot;mylog&quot;</span> <span class="attr">level</span>=<span class="string">&quot;trace&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;MyFile&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;error&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52</p>
<p>注意根节点增加了一个monitorInterval属性，含义是每隔300秒重新读取配置文件，可以不重启应用的情况下修改配置，还是很好用的功能。</p>
<p>RollingRandomAccessFile的属性：</p>
<ul>
<li>fileName 指定当前日志文件的位置和文件名称</li>
<li>filePattern 指定当发生Rolling时，文件的转移和重命名规则</li>
<li>SizeBasedTriggeringPolicy 指定当文件体积大于size指定的值时，触发Rolling</li>
<li>DefaultRolloverStrategy 指定最多保存的文件个数</li>
<li>TimeBasedTriggeringPolicy 这个配置需要和filePattern结合使用，</li>
<li>注意filePattern中配置的文件重命名规则是${FILE_NAME}-%d{yyyy-MM-dd HH-mm}-%i，最小的时间粒度是mm，即分钟。</li>
<li>TimeBasedTriggeringPolicy指定的size是1，结合起来就是每1分钟生成一个新文件。如果改成%d{yyyy-MM-dd HH}，最小粒度为小时，则每一个小时生成一个文件。</li>
</ul>
<h3 id="三、Log4j2异步日志"><a href="#三、Log4j2异步日志" class="headerlink" title="#三、Log4j2异步日志"></a><a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/frame/data/#%E4%B8%89%E3%80%81log4j2%E5%BC%82%E6%AD%A5%E6%97%A5%E5%BF%97">#</a>三、Log4j2异步日志</h3><p><strong>异步日志</strong></p>
<p>log4j2最大的特点就是异步日志，其性能的提升主要也是从异步日志中受益，我们来看看如何使用 log4j2的异步日志。</p>
<ul>
<li><strong>同步日志</strong></li>
</ul>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211026112840360.769c8bf7.png" alt="image-20211026112840360"></p>
<ul>
<li><strong>异步日志</strong></li>
</ul>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211026114244785.2d1e9d39.png" alt="image-20211026114244785"></p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211026113622616.f880b79c.png" alt="image-20211026113622616"></p>
<p>Log4j2提供了两种实现日志的方式，一个是通过AsyncAppender，一个是通过AsyncLogger，分别对应 前面我们说的Appender组件和Logger组件。</p>
<p>注意：配置异步日志需要添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--异步日志依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lmax<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>disruptor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6</p>
<ol>
<li>AsyncAppender方式</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;warn&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span>&gt;</span>D:/logs<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d %p %c&#123;1.&#125; [%t] %m%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">&quot;Async&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;error&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Async&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21</p>
<ol>
<li>AsyncLogger方式</li>
</ol>
<p>AsyncLogger才是log4j2 的重头戏，也是官方推荐的异步方式。它可以使得调用Logger.log返回的 更快。你可以有两种选择：全局异步和混合异步。</p>
<ul>
<li><strong>全局异步</strong>就是，所有的日志都异步的记录，在配置文件上不用做任何改动，只需要添加一个 log4j2.component.properties 配置；</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Log4jContextSelector</span>=<span class="string">org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span></span><br></pre></td></tr></table></figure>

<p>1<br>2</p>
<ul>
<li><strong>混合异步</strong>就是，你可以在应用中同时使用同步日志和异步日志，这使得日志的配置方式更加灵活。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span>&gt;</span>D:/logs<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;LOG_HOME&#125;/myfile.log&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d %p %c&#123;1.&#125; [%t] %m%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">&quot;Async&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AsyncLogger</span> <span class="attr">name</span>=<span class="string">&quot;com.ydlclass&quot;</span> <span class="attr">level</span>=<span class="string">&quot;trace&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">includeLocation</span>=<span class="string">&quot;false&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">AsyncLogger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26</p>
<p>如上配置： com.ydlclass 日志是异步的，root日志是同步的。</p>
<p>使用异步日志需要注意的问题：</p>
<ol>
<li>如果使用异步日志，AsyncAppender、AsyncLogger和全局日志，不要同时出现。性能会和 AsyncAppender一致，降至最低。</li>
<li>设置includeLocation&#x3D;false ，打印位置信息会急剧降低异步日志的性能，比同步日志还要慢。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">    LOGGER.fatal(<span class="string">&quot;fatal&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">System.out.println(end - start);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2970</span></span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</p>
<p>Log4j2的性能</p>
<p>log4j官网对其性能进行大肆宣扬，但是网上也有专业认识进行测试，log4j在大量日志的情况下有一定的优势，他确实是日后的选择。但是也不必纠结。</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20211021234601896.e6e4f2f3.png" alt="image-20211021234601896"></p>
<p><a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/2.x/performance.html#asyncLogging">Log4j – Performance (apache.org)open in new window</a></p>
<h2 id="第七章：怎么打日志"><a href="#第七章：怎么打日志" class="headerlink" title="第七章：怎么打日志"></a>第七章：怎么打日志</h2><blockquote>
<p>基本格式</p>
</blockquote>
<p>必须使用参数化信息的方式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.debug(<span class="string">&quot;Processing trade with id:[&#123;&#125;] and symbol : [&#123;&#125;] &quot;</span>, id, symbol);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>不要进行字符串拼接,那样会产生很多String对象，占用空间，影响性能。反例(不要这么做):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.debug(<span class="string">&quot;Processing trade with id: &quot;</span> + id + <span class="string">&quot; symbol: &quot;</span> + symbol);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>使用[]进行参数变量隔离，如有参数变量，应该写成如下写法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.debug(<span class="string">&quot;Processing trade with id:[&#123;&#125;] and symbol : [&#123;&#125;] &quot;</span>, id, symbol);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>这样的格式写法，可读性更好，对于排查问题更有帮助。不同级别的使用</p>
<blockquote>
<p>ERROR，影响到程序正常运行、当前请求正常运行的异常情况:</p>
</blockquote>
<ul>
<li>打开配置文件失败</li>
<li>所有第三方对接的异常(包括第三方返回错误码)</li>
<li>所有影响功能使用的异常，包括:SQLException和除了业务异常之外的所有异常(RuntimeException和Exception)</li>
<li>不应该出现的情况，比如要使用阿里云传图片，但是未响应</li>
<li>如果有Throwable信息，需要记录完成的堆栈信息:</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log.error(&quot;获取用户[&#123;&#125;]的用户信息时出错&quot;,userName,e);</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>说明，如果进行了抛出异常操作，请不要记录error日志，由最终处理方进行处理：</p>
<p>反例(不要这么做):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">    String errorMessage=String.format(<span class="string">&quot;Error while reading information of user [%s]&quot;</span>,userName);</span><br><span class="line">    logger.error(errorMessage,ex);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserServiceException</span>(errorMessage,ex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<blockquote>
<p>WARN，不应该出现但是不影响程序、当前请求正常运行的异常情况:</p>
</blockquote>
<ol>
<li>有容错机制的时候出现的错误情况</li>
<li>找不到配置文件，但是系统能自动创建配置文件</li>
<li>即将接近临界值的时候，例如：缓存池占用达到警告线，业务异常的记录，比如:用户锁定异常</li>
</ol>
<blockquote>
<p>INFO，系统运行信息</p>
</blockquote>
<ol>
<li>Service方法中对于系统&#x2F;业务状态的变更</li>
<li>主要逻辑中的分步骤：1，初始化什么 2、加载什么</li>
<li>外部接口部分</li>
<li>客户端请求参数(REST&#x2F;WS)</li>
<li>调用第三方时的调用参数和调用结果</li>
<li>对于复杂的业务逻辑，需要进行日志打点，以及埋点记录，比如电商系统中的下订单逻辑，以及OrderAction操作(业务状态变更)。</li>
<li>调用其他第三方服务时，所有的出参和入参是必须要记录的(因为你很难追溯第三方模块发生的问题)</li>
</ol>
<p>说明 并不是所有的service都进行出入口打点记录,单一、简单service是没有意义的(job除外,job需要记录开始和结束,)。反例(不要这么做):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List <span class="title function_">listByBaseType</span><span class="params">(Integer baseTypeId)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;开始查询基地&quot;</span>);</span><br><span class="line">    BaseExample ex=<span class="keyword">new</span> <span class="title class_">BaseExample</span>();</span><br><span class="line">    BaseExample.<span class="type">Criteria</span> <span class="variable">ctr</span> <span class="operator">=</span> ex.createCriteria();</span><br><span class="line">    ctr.andIsDeleteEqualTo(IsDelete.USE.getValue());</span><br><span class="line">    Optionals.doIfPresent(baseTypeId, ctr::andBaseTypeIdEqualTo);</span><br><span class="line">    log.info(<span class="string">&quot;查询基地结束&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> baseRepository.selectByExample(ex);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p>
<blockquote>
<p>DEBUG，可以填写所有的想知道的相关信息(但不代表可以随便写，debug信息要有意义,最好有相关参数)</p>
</blockquote>
<p>生产环境需要关闭DEBUG信息</p>
<p>如果在生产情况下需要开启DEBUG,需要使用开关进行管理，不能一直开启。</p>
<p>说明 如果代码中出现以下代码，可以进行优化:</p>
<p>&#x2F;&#x2F;1. 获取用户基本薪资</p>
<p>&#x2F;&#x2F;2. 获取用户休假情况</p>
<p>&#x2F;&#x2F;3. 计算用户应得薪资</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">logger.debug(<span class="string">&quot;开始获取员工[&#123;&#125;] [&#123;&#125;]年基本薪资&quot;</span>,employee,year);</span><br><span class="line">logger.debug(<span class="string">&quot;获取员工[&#123;&#125;] [&#123;&#125;]年的基本薪资为[&#123;&#125;]&quot;</span>,employee,year,basicSalary);</span><br><span class="line">logger.debug(<span class="string">&quot;开始获取员工[&#123;&#125;] [&#123;&#125;]年[&#123;&#125;]月休假情况&quot;</span>,employee,year,month);</span><br><span class="line">logger.debug(<span class="string">&quot;员工[&#123;&#125;][&#123;&#125;]年[&#123;&#125;]月年假/病假/事假为[&#123;&#125;]/[&#123;&#125;]/[&#123;&#125;]&quot;</span>,employee,year,month,annualLeaveDays,sickLeaveDays,noPayLeaveDays);</span><br><span class="line">logger.debug(<span class="string">&quot;开始计算员工[&#123;&#125;][&#123;&#125;]年[&#123;&#125;]月应得薪资&quot;</span>,employee,year,month);</span><br><span class="line">logger.debug(<span class="string">&quot;员工[&#123;&#125;] [&#123;&#125;]年[&#123;&#125;]月应得薪资为[&#123;&#125;]&quot;</span>,employee,year,month,actualSalary);</span><br></pre></td></tr></table></figure>

<p>1<br>2<br>3<br>4<br>5<br>6</p>
<blockquote>
<p>TRACE，特别详细的系统运行完成信息，业务代码中，不要使用.(除非有特殊用意，否则请使用DEBUG级别替代)</p>
</blockquote>
<p>规范示例说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUserAndBindMobile</span><span class="params">(<span class="meta">@NotBlank</span> String mobile, <span class="meta">@NotNull</span> User user)</span> <span class="keyword">throws</span> CreateConflictException&#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">debug</span> <span class="operator">=</span> log.isDebugEnabled();</span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;开始创建用户并绑定手机号. args[mobile=[&#123;&#125;],user=[&#123;&#125;]]&quot;</span>, mobile, LogObjects.toString(user));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        user.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        userRepository.insertSelective(user);</span><br><span class="line">        <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;创建用户信息成功. insertedUser=[&#123;&#125;]&quot;</span>,LogObjects.toString(user));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserMobileRelationship</span> <span class="variable">relationship</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMobileRelationship</span>();</span><br><span class="line">        relationship.setMobile(mobile);</span><br><span class="line">        relationship.setOpenId(user.getOpenId());</span><br><span class="line">        relationship.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        relationship.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        userMobileRelationshipRepository.insertOnDuplicateKey(relationship);</span><br><span class="line">        <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;绑定手机成功. relationship=[&#123;&#125;]&quot;</span>,LogObjects.toString(relationship));</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;创建用户并绑定手机号. userId=[&#123;&#125;],openId=[&#123;&#125;],mobile[&#123;&#125;]&quot;</span>,user.getId(),user.getOpenId(),mobile); 		<span class="comment">// 如果考虑安全，手机号记得脱敏</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(DuplicateKeyException e)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;创建用户并绑定手机号失败,已存在相同的用户. openId=[&#123;&#125;],mobile=[&#123;&#125;]&quot;</span>,user.getOpenId(),mobile);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CreateConflictException</span>(<span class="string">&quot;创建用户发生冲突, openid=[%s]&quot;</span>,user.getOpenId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://manamn.space">Gao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://manamn.space/2022/05/03/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/">https://manamn.space/2022/05/03/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://manamn.space" target="_blank">爱笑的Gao的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaWeb/">JavaWeb</a><a class="post-meta__tags" href="/tags/%E6%97%A5%E5%BF%97/">日志</a></div><div class="post_share"><div class="social-share" data-image="https://tva1.sinaimg.cn/large/005BYqpggy1fwrgjhte8cj31hc0u0ds1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/03/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%B8%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/"><img class="prev-cover" src="https://tva3.sinaimg.cn/large/9bd9b167gy1fwrh8vixr6j21hc0xc43b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">动态代理与类加载器核心知识点汇总</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/03/Cookie%E5%92%8CSession%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/520ck/cdnseovx/1/I/l/1/I/l/seovx-com-2018%20(618).jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Cookie和Session的区别与联系</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/03/Ajax%E4%B8%8EJSON%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/" title="Ajax与JSON核心知识点汇总"><img class="cover" src="https://cdn.jsdelivr.net/gh/520ck/cdnseovx/1/I/l/1/I/l/seovx-com-2018%20(834).jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">Ajax与JSON核心知识点汇总</div></div></a></div><div><a href="/2022/05/03/CSS-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/" title="CSS--常用属性"><img class="cover" src="https://tva4.sinaimg.cn/large/9bd9b167gy1g2qjyn7fdxj21hc0u0gva.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">CSS--常用属性</div></div></a></div><div><a href="/2022/05/03/CSS%E2%80%94%E2%80%94%E9%80%89%E6%8B%A9%E5%99%A8%E5%8F%8A%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7/" title="CSS——选择器及三大特性"><img class="cover" src="https://tva2.sinaimg.cn/large/9bd9b167gy1g2qkreqd9dj21hc0u01kx.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">CSS——选择器及三大特性</div></div></a></div><div><a href="/2022/05/03/Cookie%E5%92%8CSession%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/" title="Cookie和Session的区别与联系"><img class="cover" src="https://cdn.jsdelivr.net/gh/520ck/cdnseovx/1/I/l/1/I/l/seovx-com-2018%20(618).jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">Cookie和Session的区别与联系</div></div></a></div><div><a href="/2022/05/03/DBUtils%E4%B8%8EBeanUtils%E4%BB%A5%E5%8F%8AGson%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="DBUtils与BeanUtils以及Gson工具类"><img class="cover" src="https://tva3.sinaimg.cn/large/9bd9b167gy1fwrt9cq7adj21hc0u0ncl.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">DBUtils与BeanUtils以及Gson工具类</div></div></a></div><div><a href="/2022/05/03/HTTP%E5%8D%8F%E8%AE%AE%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/" title="HTTP协议核心知识点汇总"><img class="cover" src="https://tva1.sinaimg.cn/large/9bd9b167gy1g4li6md32vj21hc0xcb29.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">HTTP协议核心知识点汇总</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Gao</div><div class="author-info__description">生活明朗 万物可爱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">390</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">104</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">日志框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%97%A5%E5%BF%97%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">第一章 日志的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%97%A5%E5%BF%97%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">二、日志的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8E%A5%E8%A7%A6%E8%BF%87%E7%9A%84%E6%97%A5%E5%BF%97"><span class="toc-number">1.1.3.</span> <span class="toc-text">三、接触过的日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%BB%E6%B5%81%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-number">1.1.4.</span> <span class="toc-text">四、主流日志框架</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-JUL%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-number">1.2.</span> <span class="toc-text">第二章 JUL日志框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">一、入门案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%97%A5%E5%BF%97%E7%9A%84%E7%BA%A7%E5%88%AB"><span class="toc-number">1.2.2.</span> <span class="toc-text">二、日志的级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">三、日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-Logger%E4%B9%8B%E9%97%B4%E7%9A%84%E7%88%B6%E5%AD%90%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.4.</span> <span class="toc-text">四、 Logger之间的父子关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.2.5.</span> <span class="toc-text">五、日志格式化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81String%E7%9A%84format%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">1、String的format方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84%E8%BD%AC%E6%8D%A2%E7%AC%A6"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">2、常用的转换符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">3、特殊符号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%97%A5%E6%9C%9F%E5%A4%84%E7%90%86"><span class="toc-number">1.2.5.4.</span> <span class="toc-text">4、日期处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.6.</span> <span class="toc-text">六、配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-LOG4J-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-number">1.3.</span> <span class="toc-text">第三章 LOG4J 日志框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">一、入门案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%84%E4%BB%B6%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.3.2.</span> <span class="toc-text">二、组件讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81Loggers"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">1、Loggers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81Appenders"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">2、Appenders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81Layouts"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">3、Layouts</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.3.</span> <span class="toc-text">三、配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89Logger"><span class="toc-number">1.3.4.</span> <span class="toc-text">四、自定义Logger</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2"><span class="toc-number">1.4.</span> <span class="toc-text">第四章 日志门面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81SLF4J%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2"><span class="toc-number">1.4.1.</span> <span class="toc-text">一、SLF4J日志门面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%98%BF%E9%87%8C%E6%97%A5%E5%BF%97%E8%A7%84%E7%BA%A6"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1、阿里日志规约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81SLF4J%E5%AE%9E%E6%88%98"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">2、SLF4J实战</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%BB%91%E5%AE%9A%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%88Binding%EF%BC%89"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">3、绑定其他日志的实现（Binding）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%A1%A5%E6%8E%A5%E6%97%A7%E7%9A%84%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%EF%BC%88Bridging%EF%BC%89"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">4、桥接旧的日志框架（Bridging）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81SLF4J%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">5、SLF4J原理解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81JCL-%E6%97%A5%E5%BF%97%E9%97%A8%E9%9D%A2"><span class="toc-number">1.4.2.</span> <span class="toc-text">二、JCL 日志门面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81JCL%E5%85%A5%E9%97%A8"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1、JCL入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81JCL%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2、JCL原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E6%97%A5%E5%BF%97%E7%94%9F%E6%80%81%E5%9B%BE%EF%BC%9A"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3、日志生态图：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-Logback%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">第五章 Logback的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81logback%E5%85%A5%E9%97%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">一、logback入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.2.</span> <span class="toc-text">二、源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81spi%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">1、spi机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">2、源码解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-number">1.5.3.</span> <span class="toc-text">三、三大组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81logback%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.4.</span> <span class="toc-text">四、logback配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81logback-access%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.5.</span> <span class="toc-text">五、logback-access的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-log4j2%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.6.</span> <span class="toc-text">第六章 log4j2的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81Log4j2%E5%85%A5%E9%97%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">一、Log4j2入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8log4j-api%E5%81%9A%E9%97%A8%E9%9D%A2"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">1、使用log4j-api做门面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8slf4j%E5%81%9A%E9%97%A8%E9%9D%A2"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">2、使用slf4j做门面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Log4j2%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.2.</span> <span class="toc-text">二、Log4j2配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">1、默认配置：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81Log4j2%E5%BC%82%E6%AD%A5%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.3.</span> <span class="toc-text">三、Log4j2异步日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0%EF%BC%9A%E6%80%8E%E4%B9%88%E6%89%93%E6%97%A5%E5%BF%97"><span class="toc-number">1.7.</span> <span class="toc-text">第七章：怎么打日志</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/10/16/Map-HashSet-HashMap-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="无题"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2022/10/16/Map-HashSet-HashMap-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="无题">无题</a><time datetime="2022-10-16T03:58:41.832Z" title="发表于 2022-10-16 11:58:41">2022-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC17%E7%AB%A0-Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="第17章 Java8新特性"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第17章 Java8新特性"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC17%E7%AB%A0-Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="第17章 Java8新特性">第17章 Java8新特性</a><time datetime="2022-07-28T05:08:53.000Z" title="发表于 2022-07-28 13:08:53">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC16%E7%AB%A0-%E5%8F%8D%E5%B0%84%EF%BC%88Reflect%EF%BC%89/" title="第16章 反射（Reflect）"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第16章 反射（Reflect）"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC16%E7%AB%A0-%E5%8F%8D%E5%B0%84%EF%BC%88Reflect%EF%BC%89/" title="第16章 反射（Reflect）">第16章 反射（Reflect）</a><time datetime="2022-07-28T05:08:38.000Z" title="发表于 2022-07-28 13:08:38">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC15%E7%AB%A0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="第15章 网络编程"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第15章 网络编程"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC15%E7%AB%A0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="第15章 网络编程">第15章 网络编程</a><time datetime="2022-07-28T05:08:24.000Z" title="发表于 2022-07-28 13:08:24">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC14%E7%AB%A0-File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" title="第14章 File类与IO流"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第14章 File类与IO流"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC14%E7%AB%A0-File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" title="第14章 File类与IO流">第14章 File类与IO流</a><time datetime="2022-07-28T05:08:10.000Z" title="发表于 2022-07-28 13:08:10">2022-07-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Gao</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="1708664797" data-server="tencent" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>