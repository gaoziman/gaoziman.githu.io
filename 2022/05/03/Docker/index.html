<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker | 爱笑的Gao的个人博客</title><meta name="keywords" content="Linux Docker"><meta name="author" content="Gao"><meta name="copyright" content="Gao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="DockerDocker 是目前火热的容器化虚拟化技术，每一个 Docker 容器都是一个精简的 Linux 虚拟机，通过 Docker 可以实现部署项目的环境统一，持续集成和发布。文章主要是在 CentOS7 下 Docker 的基础使用。文档：https:&#x2F;&#x2F;docs.docker.com 为什么会出现历史 文档资料 docker可以干什么       Docker 组成   镜像(Image">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://manamn.space/2022/05/03/Docker/index.html">
<meta property="og:site_name" content="爱笑的Gao的个人博客">
<meta property="og:description" content="DockerDocker 是目前火热的容器化虚拟化技术，每一个 Docker 容器都是一个精简的 Linux 虚拟机，通过 Docker 可以实现部署项目的环境统一，持续集成和发布。文章主要是在 CentOS7 下 Docker 的基础使用。文档：https:&#x2F;&#x2F;docs.docker.com 为什么会出现历史 文档资料 docker可以干什么       Docker 组成   镜像(Image">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/9bd9b167gy1g2qkprglszj21hc0u01kx.jpg">
<meta property="article:published_time" content="2022-05-03T06:09:28.000Z">
<meta property="article:modified_time" content="2022-05-06T03:52:36.037Z">
<meta property="article:author" content="Gao">
<meta property="article:tag" content="Linux Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/9bd9b167gy1g2qkprglszj21hc0u01kx.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://manamn.space/2022/05/03/Docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-06 11:52:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="爱笑的Gao的个人博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">390</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">104</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-zhuye"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-yuedu"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link faa-float animated-hover"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/photos"><i class="fa-fw iconfont icon-xiangji1"></i><span> 照片墙</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-wo faa-float animated-hover"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://tva1.sinaimg.cn/large/9bd9b167gy1g2qkprglszj21hc0u01kx.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">爱笑的Gao的个人博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-zhuye"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-yuedu"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link faa-float animated-hover"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/photos"><i class="fa-fw iconfont icon-xiangji1"></i><span> 照片墙</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-wo faa-float animated-hover"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-03T06:09:28.000Z" title="发表于 2022-05-03 14:09:28">2022-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-06T03:52:36.037Z" title="更新于 2022-05-06 11:52:36">2022-05-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>Docker 是目前火热的容器化虚拟化技术，每一个 Docker 容器都是一个精简的 Linux 虚拟机，通过 Docker 可以实现部署项目的环境统一，持续集成和发布。文章主要是在 CentOS7 下 Docker 的基础使用。<br>文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com</a></p>
<h2 id="为什么会出现"><a href="#为什么会出现" class="headerlink" title="为什么会出现"></a>为什么会出现</h2><h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p><img src="http://img.zhaojishun.cn/img/image-20200514193557351.png" alt="image-20200514193557351"></p>
<h2 id="文档资料"><a href="#文档资料" class="headerlink" title="文档资料"></a>文档资料</h2><p><img src="http://img.zhaojishun.cn/img/image-20200514194028833.png" alt="image-20200514194028833"></p>
<h2 id="docker可以干什么"><a href="#docker可以干什么" class="headerlink" title="docker可以干什么"></a>docker可以干什么</h2><p><img src="http://img.zhaojishun.cn/img/image-20200514194257516.png" alt="image-20200514194257516"></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200514194353256.png" alt="image-20200514194353256"></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200514194541704.png" alt="image-20200514194541704"></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200514194639567.png" alt="image-20200514194639567"></p>
<p><img src="file:///E:/Typora/upload/image-20200514194729939.png" alt="image-20200514194729939"></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200514195109082.png" alt="image-20200514195109082"></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200514195425405.png" alt="image-20200514195425405"></p>
<h1 id="Docker-组成"><a href="#Docker-组成" class="headerlink" title="Docker 组成"></a>Docker 组成</h1><p><img src="http://img.zhaojishun.cn/img/image-20200514195834727.png" alt="image-20200514195834727"></p>
<p><img src="https://img.hacpai.com/file/2019/10/image-67305af4.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="image.png"></p>
<ul>
<li><p>镜像(Image)<br>Docker 中的镜像相当于我们 VM 虚拟机中使用的 iso 文件</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200514200124227.png" alt="image-20200514200124227"></p>
</li>
<li><p>容器(Container)<br>容器可以类比成是一个正在运行的虚拟机</p>
</li>
</ul>
<p><img src="http://img.zhaojishun.cn/img/image-20200514200230803.png" alt="image-20200514200230803"></p>
<ul>
<li>tar 文件<br>Docker 镜像可以保存成一个 tar 文件，同样的 tar 文件也可以通过 load 命令加载成一个镜像，然后通过镜像运行成一个容器。</li>
<li>Dockerfile<br>Docker 的构建文件，可以通过 Dockerfile 文件构建成一个 Docker 镜像</li>
<li>仓库(Repository)<br>远程仓库，上面有很多已经做好的镜像，比如 MySQL，nginx 等，通过 pull 命令拉取镜像，通过 push 命令推送镜像</li>
</ul>
<hr>
<p>PS ：镜像与容器的关系很像 Java 中的类与实例的关系，一个镜像可以实例化出多个容器，多个容器之间互不干扰，一个类可以有无数个实例，同样的一个镜像可以有无数个实例。</p>
<h1 id="Docker-的安装、启动、卸载"><a href="#Docker-的安装、启动、卸载" class="headerlink" title="Docker 的安装、启动、卸载"></a>Docker 的安装、启动、卸载</h1><h2 id="centos下安装"><a href="#centos下安装" class="headerlink" title="centos下安装"></a>centos下安装</h2><blockquote>
<p>1、安装gcc</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、CentOS 下需要卸载旧的版本</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove docker docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure>

<p>2018.3官网版本卸载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3、安装所需软件包</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4、设置stable镜像仓库</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<blockquote>
<p>5、更新yum软件包索引</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<blockquote>
<p>6、安装DOCKER CE</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure>

<blockquote>
<p>7、启动 Docker</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试 是否安装成功</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://b32o6mfv.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//卸载程序</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">//删除默认路径</span><br><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>

<h2 id="docker是如何工作的"><a href="#docker是如何工作的" class="headerlink" title="docker是如何工作的"></a>docker是如何工作的</h2><p><img src="http://img.zhaojishun.cn/img/image-20200515071228276.png" alt="image-20200515071228276"></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200515071217313.png" alt="image-20200515071217313"></p>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version  #显示docker 的版本信息</span><br><span class="line">docker info     #显示docker的详细信息</span><br><span class="line">docker --help	#帮助命令</span><br></pre></td></tr></table></figure>

<p>命令帮助文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline">https://docs.docker.com/engine/reference/commandline</a></p>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><h3 id="列出本地镜像docker-images"><a href="#列出本地镜像docker-images" class="headerlink" title="列出本地镜像docker images"></a>列出本地镜像<code>docker images</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zhaojishun.cn/img/image-20200511203013354.png" alt="image-20200511203013354"></p>
<ul>
<li>REPOSITORY：表示镜像的仓库源</li>
<li>TAG：镜像的标签<code>latest</code>为默认</li>
<li>IMAGE ID：镜像ID</li>
<li>CREATED：镜像创建时间</li>
<li>SIZE：镜像大小</li>
</ul>
<blockquote>
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p>
<p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像</p>
</blockquote>
<h4 id="a-列出本地所有的镜像（含中间映像层）"><a href="#a-列出本地所有的镜像（含中间映像层）" class="headerlink" title="-a :列出本地所有的镜像（含中间映像层）"></a><code>-a</code> :列出本地所有的镜像（含中间映像层）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images -a</span><br></pre></td></tr></table></figure>

<h4 id="q-只显示镜像ID。"><a href="#q-只显示镜像ID。" class="headerlink" title="-q :只显示镜像ID。"></a><code>-q</code> :只显示镜像ID。</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images -q</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zhaojishun.cn/img/image-20200511203406595.png" alt="image-20200511203406595"></p>
<h3 id="docker-search-搜索镜像"><a href="#docker-search-搜索镜像" class="headerlink" title="docker search 搜索镜像"></a><code>docker search</code> 搜索镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search tomcat </span><br><span class="line"># 可选项</span><br><span class="line">[--filter=STARS=3000] 搜索出的镜像start大于3000</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zhaojishun.cn/img/image-20200511205419516.png" alt="image-20200511205419516"></p>
<h3 id="docker-pull-拉取镜像"><a href="#docker-pull-拉取镜像" class="headerlink" title="docker pull 拉取镜像"></a><code>docker pull</code> 拉取镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># docker pull imgName[:tag] //不写tag默认拉取latest</span><br><span class="line">docker pull nginx</span><br><span class="line">#分层下载 docker的核心，联合文件系统</span><br><span class="line">[root@localhost ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">54fec2fa59d0: Already exists </span><br><span class="line">4ede6f09aefe: Pull complete </span><br><span class="line">f9dc69acb465: Pull complete </span><br><span class="line">Digest: sha256:404ed8de56dd47adadadf9e2641b1ba6ad5ce69abf251421f91d7601a2808ebe</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure>

<h3 id="docker-rmi删除镜像"><a href="#docker-rmi删除镜像" class="headerlink" title="docker rmi删除镜像"></a><code>docker rmi</code>删除镜像</h3><p>删除单个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 镜像id</span><br></pre></td></tr></table></figure>

<p>删除多个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 镜像id1 镜像id2</span><br></pre></td></tr></table></figure>

<p>删除全部</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f $(docker images -qa)</span><br></pre></td></tr></table></figure>

<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><blockquote>
<p>有镜像才能创建容器，这是根本前提(下载一个CentOS镜像演示)</p>
</blockquote>
<h3 id="docker-run新建并启动容器"><a href="#docker-run新建并启动容器" class="headerlink" title="docker run新建并启动容器"></a><code>docker run</code>新建并启动容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run [options] image [command] [arg...]</span><br><span class="line">docker run -it -d --name=mysql01 -p3333:3333 mysql</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>--name=&quot;容器新名字&quot;:</code> 为容器指定一个名称；</p>
</li>
<li><p><code>-d: 后台运行容器</code>，并返回容器ID，也即启动守护式容器； 类似nohup</p>
</li>
<li><p><code>-i</code>：以交互模式运行容器，通常与 -t 同时使用；</p>
</li>
<li><p><code>-t</code>：为容器重新分配一个伪输入终端，通常与 -i 同时使用；</p>
</li>
<li><p><code>-P</code>: 随机端口映射；</p>
</li>
<li><p>&#96;&#96;&#96;<br>-p</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  : 指定端口映射，有以下四种格式</span><br><span class="line"></span><br><span class="line">  - ip:hostPort:containerPort</span><br><span class="line">  - ip::containerPort</span><br><span class="line">  - hostPort:containerPort</span><br><span class="line">  - containerPort</span><br><span class="line"></span><br><span class="line">&gt; 运行流程图</span><br><span class="line"></span><br><span class="line">![image-20200515070922860](http://img.zhaojishun.cn/img/image-20200515070922860.png)</span><br><span class="line"></span><br><span class="line">### `docker ps`列出正在运行的容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker ps</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20200512101009595](http://img.zhaojishun.cn/img/image-20200512101009595.png)</span><br><span class="line"></span><br><span class="line">- `-a` :列出当前所有正在运行的容器+历史上运行过的</span><br><span class="line">- -l :显示最近创建的容器。</span><br><span class="line">- -n=1：显示最近1个创建的容器。</span><br><span class="line">- `-q` :静默模式，只显示容器编号。</span><br><span class="line">- --no-trunc :不截断输出。(显示完整容器id)</span><br><span class="line"></span><br><span class="line">### 退出容器</span><br><span class="line"></span><br><span class="line">1. 容器停止退出</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>exit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 容器不停止退出</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ctrl+p+q</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### `docker rm` 删除容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker rm 容器id                 # 删除一个容器，正在运行的容器不能删除，强制删除用 -f<br>docker rm -f $(docker ps -aq)	#删除所有容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### `docker start`启动容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker start 容器id或容器名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### `docker restart`重启容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker restart 容器id或容器名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### `docker stop`停止容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker stop 容器id或容器名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### `docker kill` 强制停止容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker kill 容器id或容器名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 重要命令</span><br><span class="line"></span><br><span class="line">#### 守护式容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker run -d 容器名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">很重要的要说明的一点: Docker容器`后台运行`,就`必须有一个前台进程`.</span><br><span class="line"></span><br><span class="line">容器运行的命令如果不是那些`一直挂起`的命令（比如运行top，tail），就是会`自动退出`的。</span><br><span class="line"></span><br><span class="line">这个是docker的机制问题,比如你的web容器,我们以nginx为例，正常情况下,我们配置启动服务只需要启动响应的service即可。例如</span><br><span class="line"></span><br><span class="line">service nginx start</span><br><span class="line"></span><br><span class="line">但是,这样做,nginx为后台进程模式运行,就导致docker前台没有运行的应用,</span><br><span class="line"></span><br><span class="line">这样的容器后台启动后,会立即自杀因为他觉得他没事可做了.</span><br><span class="line"></span><br><span class="line">所以，最佳的解决方案是,将你要运行的程序`以前台进程的形式运行`</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker run -it centos &#x2F;bin&#x2F;bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 查看容器日志</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker logs -f -t –tail 容器ID</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- -t 加入时间戳</span><br><span class="line">- -f 跟随最新的日志打印</span><br><span class="line">- --tail 数字 显示最后多少条</span><br><span class="line"></span><br><span class="line">#### 查看容器内运行的进程</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker top 容器id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 进入运行的容器并以命令行交互</span><br><span class="line"></span><br><span class="line">1、</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker exec -it 容器id bashshell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 一般的bashshell为/bin/bash</span><br><span class="line"></span><br><span class="line">1. 重新进入docker attach 容器ID</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker attach 容器id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 从容器拷贝文件到宿主机</span><br><span class="line"></span><br><span class="line">&gt; 容器处于关闭状态也可拷贝</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker cp 容器ID:容器内路径 目的主机路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 查看容器的元数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker inspect 容器id<br>[<br>  {<br>  “Id”: “21d8bc7c77b55732793ea85267ebd9f63c1cd11ea597c9995ba49d827dc2d1b1”,<br>  “Created”: “2020-05-15T06:36:11.576573516Z”,<br>  “Path”: “&#x2F;bin&#x2F;bash”,<br>  “Args”: [],<br>  “State”: {<br>      “Status”: “running”,<br>      “Running”: true,<br>      “Paused”: false,<br>      “Restarting”: false,<br>      “OOMKilled”: false,<br>      “Dead”: false,<br>      “Pid”: 3201,<br>      “ExitCode”: 0,<br>      “Error”: “”,<br>      “StartedAt”: “2020-05-15T06:36:12.466152437Z”,<br>      “FinishedAt”: “0001-01-01T00:00:00Z”<br>  },<br>  “Image”: “sha256:470671670cac686c7cf0081e0b37da2e9f4f768ddc5f6a26102ccd1c6954c1ee”,<br>  “ResolvConfPath”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;21d8bc7c77b55732793ea85267ebd9f63c1cd11ea597c9995ba49d827dc2d1b1&#x2F;resolv.conf”,<br>  “HostnamePath”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;21d8bc7c77b55732793ea85267ebd9f63c1cd11ea597c9995ba49d827dc2d1b1&#x2F;hostname”,<br>  “HostsPath”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;21d8bc7c77b55732793ea85267ebd9f63c1cd11ea597c9995ba49d827dc2d1b1&#x2F;hosts”,<br>  “LogPath”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;21d8bc7c77b55732793ea85267ebd9f63c1cd11ea597c9995ba49d827dc2d1b1&#x2F;21d8bc7c77b55732793ea85267ebd9f63c1cd11ea597c9995ba49d827dc2d1b1-json.log”,<br>  “Name”: “&#x2F;determined_wiles”,<br>  “RestartCount”: 0,<br>  “Driver”: “overlay2”,<br>  “Platform”: “linux”,<br>  “MountLabel”: “”,<br>  “ProcessLabel”: “”,<br>  “AppArmorProfile”: “”,<br>  “ExecIDs”: null,<br>  “HostConfig”: {<br>      “Binds”: null,<br>      “ContainerIDFile”: “”,<br>      “LogConfig”: {<br>          “Type”: “json-file”,<br>          “Config”: {}<br>      },<br>      “NetworkMode”: “default”,<br>      “PortBindings”: {},<br>      “RestartPolicy”: {<br>          “Name”: “no”,<br>          “MaximumRetryCount”: 0<br>      },<br>      “AutoRemove”: false,<br>      “VolumeDriver”: “”,<br>      “VolumesFrom”: null,<br>      “CapAdd”: null,<br>      “CapDrop”: null,<br>      “Capabilities”: null,<br>      “Dns”: [],<br>      “DnsOptions”: [],<br>      “DnsSearch”: [],<br>      “ExtraHosts”: null,<br>      “GroupAdd”: null,<br>      “IpcMode”: “private”,<br>      “Cgroup”: “”,<br>      “Links”: null,<br>      “OomScoreAdj”: 0,<br>      “PidMode”: “”,<br>      “Privileged”: false,<br>      “PublishAllPorts”: false,<br>      “ReadonlyRootfs”: false,<br>      “SecurityOpt”: null,<br>      “UTSMode”: “”,<br>      “UsernsMode”: “”,<br>      “ShmSize”: 67108864,<br>      “Runtime”: “runc”,<br>      “ConsoleSize”: [<br>          0,<br>          0<br>      ],<br>      “Isolation”: “”,<br>      “CpuShares”: 0,<br>      “Memory”: 0,<br>      “NanoCpus”: 0,<br>      “CgroupParent”: “”,<br>      “BlkioWeight”: 0,<br>      “BlkioWeightDevice”: [],<br>      “BlkioDeviceReadBps”: null,<br>      “BlkioDeviceWriteBps”: null,<br>      “BlkioDeviceReadIOps”: null,<br>      “BlkioDeviceWriteIOps”: null,<br>      “CpuPeriod”: 0,<br>      “CpuQuota”: 0,<br>      “CpuRealtimePeriod”: 0,<br>      “CpuRealtimeRuntime”: 0,<br>      “CpusetCpus”: “”,<br>      “CpusetMems”: “”,<br>      “Devices”: [],<br>      “DeviceCgroupRules”: null,<br>      “DeviceRequests”: null,<br>      “KernelMemory”: 0,<br>      “KernelMemoryTCP”: 0,<br>      “MemoryReservation”: 0,<br>      “MemorySwap”: 0,<br>      “MemorySwappiness”: null,<br>      “OomKillDisable”: false,<br>      “PidsLimit”: null,<br>      “Ulimits”: null,<br>      “CpuCount”: 0,<br>      “CpuPercent”: 0,<br>      “IOMaximumIOps”: 0,<br>      “IOMaximumBandwidth”: 0,<br>      “MaskedPaths”: [<br>          “&#x2F;proc&#x2F;asound”,<br>          “&#x2F;proc&#x2F;acpi”,<br>          “&#x2F;proc&#x2F;kcore”,<br>          “&#x2F;proc&#x2F;keys”,<br>          “&#x2F;proc&#x2F;latency_stats”,<br>          “&#x2F;proc&#x2F;timer_list”,<br>          “&#x2F;proc&#x2F;timer_stats”,<br>          “&#x2F;proc&#x2F;sched_debug”,<br>          “&#x2F;proc&#x2F;scsi”,<br>          “&#x2F;sys&#x2F;firmware”<br>      ],<br>      “ReadonlyPaths”: [<br>          “&#x2F;proc&#x2F;bus”,<br>          “&#x2F;proc&#x2F;fs”,<br>          “&#x2F;proc&#x2F;irq”,<br>          “&#x2F;proc&#x2F;sys”,<br>          “&#x2F;proc&#x2F;sysrq-trigger”<br>      ]<br>  },<br>  “GraphDriver”: {<br>      “Data”: {<br>          “LowerDir”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;729b8199271e8b8b1cb5414cf5ef1782a52108c66ff13f159dafabb16cc2f6f2-init&#x2F;diff:&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;4369da29b7531898a87fa64ffb034e6e1c91a30d1ed8e37c08bcfa2c4fc3a70e&#x2F;diff”,<br>          “MergedDir”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;729b8199271e8b8b1cb5414cf5ef1782a52108c66ff13f159dafabb16cc2f6f2&#x2F;merged”,<br>          “UpperDir”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;729b8199271e8b8b1cb5414cf5ef1782a52108c66ff13f159dafabb16cc2f6f2&#x2F;diff”,<br>          “WorkDir”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;729b8199271e8b8b1cb5414cf5ef1782a52108c66ff13f159dafabb16cc2f6f2&#x2F;work”<br>      },<br>      “Name”: “overlay2”<br>  },<br>  “Mounts”: [],<br>  “Config”: {<br>      “Hostname”: “21d8bc7c77b5”,<br>      “Domainname”: “”,<br>      “User”: “”,<br>      “AttachStdin”: true,<br>      “AttachStdout”: true,<br>      “AttachStderr”: true,<br>      “Tty”: true,<br>      “OpenStdin”: true,<br>      “StdinOnce”: true,<br>      “Env”: [<br>          “PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin”<br>      ],<br>      “Cmd”: [<br>          “&#x2F;bin&#x2F;bash”<br>      ],<br>      “Image”: “centos”,<br>      “Volumes”: null,<br>      “WorkingDir”: “”,<br>      “Entrypoint”: null,<br>      “OnBuild”: null,<br>      “Labels”: {<br>          “org.label-schema.build-date”: “20200114”,<br>          “org.label-schema.license”: “GPLv2”,<br>          “org.label-schema.name”: “CentOS Base Image”,<br>          “org.label-schema.schema-version”: “1.0”,<br>          “org.label-schema.vendor”: “CentOS”,<br>          “org.opencontainers.image.created”: “2020-01-14 00:00:00-08:00”,<br>          “org.opencontainers.image.licenses”: “GPL-2.0-only”,<br>          “org.opencontainers.image.title”: “CentOS Base Image”,<br>          “org.opencontainers.image.vendor”: “CentOS”<br>      }<br>  },<br>  “NetworkSettings”: {<br>      “Bridge”: “”,<br>      “SandboxID”: “c37d6af31fd2e464bc0f580aa47ea83db566d88d42820774e9e6d27e92d138ed”,<br>      “HairpinMode”: false,<br>      “LinkLocalIPv6Address”: “”,<br>      “LinkLocalIPv6PrefixLen”: 0,<br>      “Ports”: {},<br>      “SandboxKey”: “&#x2F;var&#x2F;run&#x2F;docker&#x2F;netns&#x2F;c37d6af31fd2”,<br>      “SecondaryIPAddresses”: null,<br>      “SecondaryIPv6Addresses”: null,<br>      “EndpointID”: “45b8e67f40e4395187e1adf19b227d9d7d46ca87a60e7fb08d5770c049af2be9”,<br>      “Gateway”: “172.17.0.1”,<br>      “GlobalIPv6Address”: “”,<br>      “GlobalIPv6PrefixLen”: 0,<br>      “IPAddress”: “172.17.0.2”,<br>      “IPPrefixLen”: 16,<br>      “IPv6Gateway”: “”,<br>      “MacAddress”: “02:42:ac:11:00:02”,<br>      “Networks”: {<br>          “bridge”: {<br>              “IPAMConfig”: null,<br>              “Links”: null,<br>              “Aliases”: null,<br>              “NetworkID”: “e78edd4f399e8cb21117502229c99bc17e469f3a6e83a233b08f014cb32fe8ac”,<br>              “EndpointID”: “45b8e67f40e4395187e1adf19b227d9d7d46ca87a60e7fb08d5770c049af2be9”,<br>              “Gateway”: “172.17.0.1”,<br>              “IPAddress”: “172.17.0.2”,<br>              “IPPrefixLen”: 16,<br>              “IPv6Gateway”: “”,<br>              “GlobalIPv6Address”: “”,<br>              “GlobalIPv6PrefixLen”: 0,<br>              “MacAddress”: “02:42:ac:11:00:02”,<br>              “DriverOpts”: null<br>          }<br>      }<br>  }<br>  }<br>]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 总结</span><br><span class="line"></span><br><span class="line">![img](http://img.zhaojishun.cn/img/%E4%B8%8B%E8%BD%BD.png)</span><br><span class="line"></span><br><span class="line">`attach` Attach to a running container # 当前 shell 下 attach 连接指定运行镜像</span><br><span class="line"></span><br><span class="line">`build` Build an image from a Dockerfile # 通过 Dockerfile 定制镜像</span><br><span class="line"></span><br><span class="line">`commit` Create a new image from a container changes # 提交当前容器为新的镜像</span><br><span class="line"></span><br><span class="line">`cp` Copy files/folders from the containers filesystem to the host path #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line"></span><br><span class="line">`create` Create a new container # 创建一个新的容器，同 run，但不启动容器</span><br><span class="line"></span><br><span class="line">`diff` Inspect changes on a container&#x27;s filesystem # 查看 docker 容器变化</span><br><span class="line"></span><br><span class="line">`events` Get real time events from the server # 从 docker 服务获取容器实时事件</span><br><span class="line"></span><br><span class="line">`exe`c Run a command in an existing container # 在已存在的容器上运行命令</span><br><span class="line"></span><br><span class="line">`export` Stream the contents of a container as a tar archive # 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span><br><span class="line"></span><br><span class="line">`history` Show the history of an image # 展示一个镜像形成历史</span><br><span class="line"></span><br><span class="line">`images` List images # 列出系统当前镜像</span><br><span class="line"></span><br><span class="line">`import` Create a new filesystem image from the contents of a tarball # 从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line"></span><br><span class="line">`info` Display system-wide information # 显示系统相关信息</span><br><span class="line"></span><br><span class="line">`inspect` Return low-level information on a container # 查看容器详细信息</span><br><span class="line"></span><br><span class="line">`kill` Kill a running container # kill 指定 docker 容器</span><br><span class="line"></span><br><span class="line">`load` Load an image from a tar archive # 从一个 tar 包中加载一个镜像[对应 save]</span><br><span class="line"></span><br><span class="line">`login` Register or Login to the docker registry server # 注册或者登陆一个 docker 源服务器</span><br><span class="line"></span><br><span class="line">`logout` Log out from a Docker registry server # 从当前 Docker registry 退出</span><br><span class="line"></span><br><span class="line">`logs` Fetch the logs of a container # 输出当前容器日志信息</span><br><span class="line"></span><br><span class="line">`port` Lookup the public-facing port which is NAT-ed to PRIVATE_PORT # 查看映射端口对应的容器内部源端口</span><br><span class="line"></span><br><span class="line">`pause` Pause all processes within a container # 暂停容器</span><br><span class="line"></span><br><span class="line">`ps` List containers # 列出容器列表</span><br><span class="line"></span><br><span class="line">`pull` Pull an image or a repository from the docker registry server # 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line"></span><br><span class="line">`push` Push an image or a repository to the docker registry server # 推送指定镜像或者库镜像至docker源服务器</span><br><span class="line"></span><br><span class="line">`restart` Restart a running container # 重启运行的容器</span><br><span class="line"></span><br><span class="line">`rm` Remove one or more containers # 移除一个或者多个容器</span><br><span class="line"></span><br><span class="line">`rmi` Remove one or more images # 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span><br><span class="line"></span><br><span class="line">`run` Run a command in a new container # 创建一个新的容器并运行一个命令</span><br><span class="line"></span><br><span class="line">`save` Save an image to a tar archive # 保存一个镜像为一个 tar 包[对应 load]</span><br><span class="line"></span><br><span class="line">`search` Search for an image on the Docker Hub # 在 docker hub 中搜索镜像</span><br><span class="line"></span><br><span class="line">`start` Start a stopped containers # 启动容器</span><br><span class="line"></span><br><span class="line">`stop` Stop a running containers # 停止容器</span><br><span class="line"></span><br><span class="line">`tag` Tag an image into a repository # 给源中镜像打标签</span><br><span class="line"></span><br><span class="line">`top` Lookup the running processes of a container # 查看容器中运行的进程信息</span><br><span class="line"></span><br><span class="line">`unpause` Unpause a paused container # 取消暂停容器</span><br><span class="line"></span><br><span class="line">`version` Show the docker version information # 查看 docker 版本号</span><br><span class="line"></span><br><span class="line">`wait` Block until a container stops, then print its exit code # 截取容器停止时的退出状态值</span><br><span class="line"></span><br><span class="line">## 练习</span><br><span class="line"></span><br><span class="line">&gt; docker 安装启动nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[root@localhost ~]# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>mysql               latest              a7a67c95e831        2 weeks ago         541MB<br>mysql               latest              a7a67c95e831        2 weeks ago         541MB<br>tomcat              latest              927899a31456        2 weeks ago         647MB<br>nginx               latest              602e111c06b6        3 weeks ago         127MB<br>centos              latest              470671670cac        3 months ago        237MB<br>hello-world         latest              bf756fb1ae65        4 months ago        13.3kB<br>[root@localhost ~]# docker run -d –name mynginx -p 9999:80 nginx<br>dab7d64d47a78863d7defd63080de53ae08e39babbba5e3b7b7cfafbb19a4aac<br>[root@localhost ~]# curl localhost:9999</p>
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
  body {
      width: 35em;
      margin: 0 auto;
      font-family: Tahoma, Verdana, Arial, sans-serif;
  }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p></li>
</ul>
<p>For online documentation and support please refer to
<a target="_blank" rel="noopener" href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a target="_blank" rel="noopener" href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 安装tomcat</span><br><span class="line"></span><br></pre></td></tr></table></figure>
--rm 用完即删
docker run -it --rm tomcat:9.0
Unable to find image 'tomcat:9.0' locally
9.0: Pulling from library/tomcat
90fe46dd8199: Already exists 
35a4f1977689: Already exists 
bbc37f14aded: Already exists 
74e27dc593d4: Already exists 
93a01fbfad7f: Already exists 
35b994955649: Already exists 
7f9f18312a34: Already exists 
574205fe650b: Already exists 
35150a1638af: Pull complete 
c398e449144f: Pull complete 
Digest: sha256:989f0c7140d1af980e6c988c4780d962aa7431111de4757636dd12932401657b
Status: Downloaded newer image for tomcat:9.0
Using CATALINA_BASE:   /usr/local/tomcat
Using CATALINA_HOME:   /usr/local/tomcat
Using CATALINA_TMPDIR: /usr/local/tomcat/temp
Using JRE_HOME:        /usr/local/openjdk-11
Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
NOTE: Picked up JDK_JAVA_OPTIONS:  --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED
15-May-2020 07:01:00.112 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version name:   Apache Tomcat/9.0.35
15-May-2020 07:01:00.115 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          May 5 2020 20:36:20 UTC
15-May-2020 07:01:00.115 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version number: 9.0.35.0
15-May-2020 07:01:00.115 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Linux
15-May-2020 07:01:00.115 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version:            3.10.0-1062.12.1.el7.x86_64


<p>[root@localhost ~]# docker run -it -d -p:2222:3333 tomcat:9.0<br>82ab7ae512aebb44916ba1a98ed5ed2a4347d4918aa6debfa424c64ff9d205a5<br>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                              NAMES<br>82ab7ae512ae        tomcat:9.0          “catalina.sh run”        6 seconds ago       Up 4 seconds        8080&#x2F;tcp, 0.0.0.0:2222-&gt;3333&#x2F;tcp   brave_bell<br>dab7d64d47a7        nginx               “nginx -g ‘daemon of…”   15 minutes ago      Up 15 minutes       0.0.0.0:9999-&gt;80&#x2F;tcp               mynginx<br>21d8bc7c77b5        centos              “&#x2F;bin&#x2F;bash”              31 minutes ago      Up 31 minutes                                          determined_wiles<br>[root@localhost ~]# docker exec -it 82 &#x2F;bin&#x2F;bash<br>root@82ab7ae512ae:&#x2F;usr&#x2F;local&#x2F;tomcat#</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Docker 镜像</span><br><span class="line"></span><br><span class="line">## 是什么</span><br><span class="line"></span><br><span class="line">&gt; 镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</span><br><span class="line"></span><br><span class="line">UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</span><br><span class="line"></span><br><span class="line">## 镜像加载原理</span><br><span class="line"></span><br><span class="line">&gt; docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</span><br><span class="line">&gt;</span><br><span class="line">&gt; bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</span><br><span class="line">&gt;</span><br><span class="line">&gt; rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</span><br><span class="line"></span><br><span class="line">![image-20200512104752689](http://img.zhaojishun.cn/img/image-20200512104752689.png)</span><br><span class="line"></span><br><span class="line">对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</span><br><span class="line"></span><br><span class="line">## 镜像的分层</span><br><span class="line"></span><br><span class="line">以我们的pull为例，在下载的过程中我们可以看到docker的镜像好像是在一层一层的在下载</span><br><span class="line"></span><br><span class="line">![image-20200512104844102](http://img.zhaojishun.cn/img/image-20200512104844102.png)</span><br><span class="line"></span><br><span class="line">使用分层接口的好处</span><br><span class="line"></span><br><span class="line">最大的一个好处就是 - 共享资源</span><br><span class="line"></span><br><span class="line">比如：有多个镜像都从相同的 base 镜像构建而来，那么宿主机只需在磁盘上保存一份base镜像，</span><br><span class="line"></span><br><span class="line">同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</span><br><span class="line"></span><br><span class="line">## 特点</span><br><span class="line"></span><br><span class="line">Docker镜像都是只读的</span><br><span class="line"></span><br><span class="line">当容器启动时，**一个新的可写层被加载到镜像的顶部。**</span><br><span class="line"></span><br><span class="line">这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</span><br><span class="line"></span><br><span class="line">## commit 镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker commit 提交容器为一个新的副本<br>docker commit -m”本次提交信息” -a”作者” 容器id 提交镜像名[:tag]</p>
<h1 id="1、启动一个默认的tomcat"><a href="#1、启动一个默认的tomcat" class="headerlink" title="1、启动一个默认的tomcat"></a>1、启动一个默认的tomcat</h1><p>[root@localhost ~]# docker run -itd -p:8080:8080 tomcat:9.0<br>98b1fde6bd4b42c11bb37498a9aafe6f71503c43ce24954ce3d8e009e0bb07c8<br>[root@localhost ~]# docker exec -it 98 &#x2F;bin&#x2F;bash<br>root@98b1fde6bd4b:&#x2F;usr&#x2F;local&#x2F;tomcat# ls<br>BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist<br>CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</p>
<h1 id="2、修改镜像"><a href="#2、修改镜像" class="headerlink" title="2、修改镜像"></a>2、修改镜像</h1><p>root@98b1fde6bd4b:&#x2F;usr&#x2F;local&#x2F;tomcat# cp -r webapps.dist&#x2F;* webapps<br>root@98b1fde6bd4b:&#x2F;usr&#x2F;local&#x2F;tomcat# cd webapps<br>root@98b1fde6bd4b:&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps# ls<br>ROOT  docs  examples  host-manager  manager<br>root@98b1fde6bd4b:&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps# curl localhost:8080</p>
<!DOCTYPE html>
<html lang="en">
  //内容太多不展示了
</html>
# 3、提交镜像
[root@localhost ~]# docker commit -m"add webapp" -a"zhao" 98b1fde6bd4b tomcatzhao:1.0
sha256:1891f2c19c632713ef496c7e0e95ca0ee1563c0a836513002ebb439ecd988d2a
[root@localhost ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
tomcatzhao          1.0                 1891f2c19c63        10 minutes ago      652MB
tomcat              9.0                 d03312117bb0        2 days ago          647MB
redis               latest              f9b990972689        13 days ago         104MB
mysql               latest              a7a67c95e831        2 weeks ago         541MB
mysql               latest              a7a67c95e831        2 weeks ago         541MB
tomcat              latest              927899a31456        2 weeks ago         647MB
nginx               latest              602e111c06b6        3 weeks ago         127MB
centos              latest              470671670cac        3 months ago        237MB
hello-world         latest              bf756fb1ae65        4 months ago        13.3kB
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 容器数据卷</span><br><span class="line"></span><br><span class="line">## 是什么</span><br><span class="line"></span><br><span class="line">- 将运用与运行的环境打包形成容器运行 ，运行可以伴随着容器，但是我们对数据的要求希望是`持久化`的</span><br><span class="line">- 容器之间希望有可`能共享数据`</span><br><span class="line"></span><br><span class="line">Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，</span><br><span class="line"></span><br><span class="line">那么当`容器删除后`，`数据`自然也就`没有`了。</span><br><span class="line"></span><br><span class="line">为了能保存数据在docker中我们使用容器数据卷。</span><br><span class="line"></span><br><span class="line">## 能干什么</span><br><span class="line"></span><br><span class="line">卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性：</span><br><span class="line"></span><br><span class="line">卷的设计目的就是数据的`持久化`，完全独立于容器的生存周期，因此`Docker不会在容器删除时删除其挂载的数据卷`</span><br><span class="line"></span><br><span class="line">特点：</span><br><span class="line"></span><br><span class="line">1：数据卷可在容器之间`共享或重用数据`</span><br><span class="line"></span><br><span class="line">2：卷中的`更改可以直接生效`</span><br><span class="line"></span><br><span class="line">3：数据卷中的更改不会包含在镜像的更新中</span><br><span class="line"></span><br><span class="line">4：数据卷的生命周期一直持续到没有容器使用它为止</span><br><span class="line"></span><br><span class="line">5：容器和宿主机之间数据共享</span><br><span class="line"></span><br><span class="line">6：容器停止后，主机修改数据后数据同步</span><br><span class="line"></span><br><span class="line">## 创建一个数据卷 `--mount`</span><br><span class="line"></span><br></pre></td></tr></table></figure>
docker volume create myvolume
[root@localhost home]# docker volume create myvolume
myvolume
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 查看所有数据卷</span><br><span class="line"></span><br></pre></td></tr></table></figure>
docker volume ls
[root@localhost home]# docker volume ls
DRIVER              VOLUME NAME
local               myvolume
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 查看指定数据卷的信息</span><br><span class="line"></span><br></pre></td></tr></table></figure>
docker volume inspect myvolume 
[root@localhost home]# docker volume inspect myvolume 
[
    {
        "CreatedAt": "2020-05-15T19:31:08-07:00",
        "Driver": "local",
        "Labels": {},
        "Mountpoint": "/var/lib/docker/volumes/myvolume/_data",
        "Name": "myvolume",
        "Options": {},
        "Scope": "local"
    }
]
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 启动一个挂载数据卷的容器</span><br><span class="line"></span><br><span class="line">在用 `docker run` 命令的时候，使用 `--mount` 标记来将 `数据卷` 挂载到容器里。在一次 `docker run` 中可以挂载多个 `数据卷`。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
[root@localhost home]# docker run -itd --mount source=myvloume,target=/test/ centos /bin/bash
c2faa631c5a5efc7a5a250527be564252ab233338c5d2e0ccfe983538010dc7d
[root@localhost home]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES
c2faa631c5a5        centos              "/bin/bash"         4 seconds ago        Up 3 seconds                            epic_haibt
0a11c340d3a5        centos              "/bin/bash"         About a minute ago   Up About a minute                       tender_einstein
[root@localhost home]# docker exec c2 /bin/bash
[root@localhost home]# docker exec -it c2 /bin/bash
[root@c2faa631c5a5 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  test  tmp  usr  var
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 删除数据卷</span><br><span class="line"></span><br></pre></td></tr></table></figure>
docker volume rm volumeName
[root@localhost home]# docker volume rm myvolume
myvolume
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`数据卷` 是被设计用来持久化数据的，它的生命周期独立于容器，Docker 不会在容器被删除后自动删除 `数据卷`，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的 `数据卷`。如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 `docker rm -v` 这个命令。</span><br><span class="line"></span><br><span class="line">无主的数据卷可能会占据很多空间，要清理请使用以下命令</span><br><span class="line"></span><br></pre></td></tr></table></figure>
$ docker volume prune
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 挂载主机目录作为数据卷</span><br><span class="line"></span><br><span class="line">使用 `--mount` 标记可以指定挂载一个本地主机的目录到容器中去。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
docker run -itd --mount type=bind,source=/home,target=/test/home centos /bin/bash
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">上面的命令加载主机的 `/home` 目录到容器的 `/test/home`目录。这个功能在进行测试的时候十分方便，比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作。本地目录的路径必须是绝对路径，以前使用 `-v` 参数时如果本地目录不存在 Docker 会自动为你创建一个文件夹，现在使用 `--mount` 参数时如果本地目录不存在，Docker 会报错。</span><br><span class="line"></span><br><span class="line">&gt; 测试文件显示</span><br><span class="line"></span><br></pre></td></tr></table></figure>
宿主机
[root@localhost home]# cd /home/
[root@localhost home]# ls
threefloorsingin-1.0-SNAPSHOT-jar-with-dependencies.jar  zhaojishun

<p>docker容器<br>[root@0a0f80449f1d &#x2F;]# cd test&#x2F;home&#x2F;<br>[root@0a0f80449f1d home]# ls<br>threefloorsingin-1.0-SNAPSHOT-jar-with-dependencies.jar  zhaojishun</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 测试文件写入</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker容器<br>[root@0a0f80449f1d home]# touch test.java<br>[root@0a0f80449f1d home]# ls<br>test.java  threefloorsingin-1.0-SNAPSHOT-jar-with-dependencies.jar  zhaojishun</p>
<p>宿主机<br>[root@localhost home]# ls<br>test.java  threefloorsingin-1.0-SNAPSHOT-jar-with-dependencies.jar  zhaojishun</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Docker 挂载主机目录的默认权限是 `读写`，用户也可以通过增加 `readonly` 指定为 `只读`。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker run -itd –mount type&#x3D;bind,source&#x3D;&#x2F;home,target&#x3D;&#x2F;test&#x2F;home,readonly centos &#x2F;bin&#x2F;bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">加了 `readonly` 之后，就挂载为 `只读` 了。如果你在容器内 `/test/home` 目录新建文件，会显示如下错误</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2F;test&#x2F;home # touch new.txt<br>touch: new.txt: Read-only file system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 为容器添加数据卷 `-v`</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker run -it -v &#x2F;宿主机目录:&#x2F;容器内目录 centos &#x2F;bin&#x2F;bash</p>
<p>[root@localhost ~]# docker run -it -v &#x2F;home&#x2F;zhaojishun&#x2F;:&#x2F;home centos &#x2F;bin&#x2F;bash</p>
<h2 id="宿主机-被挂载的目录如果不存在会自动创建"><a href="#宿主机-被挂载的目录如果不存在会自动创建" class="headerlink" title="宿主机 被挂载的目录如果不存在会自动创建"></a>宿主机 被挂载的目录如果不存在会自动创建</h2><p>[root@localhost ~]# cd &#x2F;home&#x2F;<br>[root@localhost home]# ls<br>zhaojishun</p>
<h2 id="通过docker-inspect-查看容器挂载情况"><a href="#通过docker-inspect-查看容器挂载情况" class="headerlink" title="通过docker inspect 查看容器挂载情况"></a>通过docker inspect 查看容器挂载情况</h2><p>docker inspect f88d14b4b0af</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20200519192621325](http://img.zhaojishun.cn/img/image-20200519192621325.png)</span><br><span class="line"></span><br><span class="line">&gt; 测试数据双向同步</span><br><span class="line"></span><br><span class="line">![image-20200519194242777](http://img.zhaojishun.cn/img/image-20200519194242777.png)</span><br><span class="line"></span><br><span class="line">### 查看是否挂载成功</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker inspect 容器ID<br>“Mounts”: [<br>            {<br>                “Type”: “volume”,<br>                “Name”: “myvloume”,<br>                “Source”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;myvloume&#x2F;_data”,<br>                “Destination”: “&#x2F;test”,<br>                “Driver”: “local”,<br>                “Mode”: “z”,<br>                “RW”: true,<br>                “Propagation”: “”<br>            }<br>        ],</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 设置读写权限</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="通过容器内路径-v-容器内路径-ro-rw-改变读写权限"><a href="#通过容器内路径-v-容器内路径-ro-rw-改变读写权限" class="headerlink" title="通过容器内路径 -v 容器内路径:ro  rw 改变读写权限"></a>通过容器内路径 -v 容器内路径:ro  rw 改变读写权限</h1><p>ro 只读<br>rw 可读可写（默认）</p>
<h1 id="一旦设置了权限，容器对挂载出来的内容就有限定"><a href="#一旦设置了权限，容器对挂载出来的内容就有限定" class="headerlink" title="一旦设置了权限，容器对挂载出来的内容就有限定"></a>一旦设置了权限，容器对挂载出来的内容就有限定</h1><p>docker run -d -P –name mynginx01 -v &#x2F;etc&#x2F;nginx:ro nginx<br>docker run -d -P –name mynginx01 -v &#x2F;etc&#x2F;nginx:rw nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 具名挂载与匿名挂载</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="匿名挂载"><a href="#匿名挂载" class="headerlink" title="匿名挂载"></a>匿名挂载</h1><p>[root@localhost ~]# docker run -d -P –name mynginx01 -v &#x2F;etc&#x2F;nginx nginx<br>50c23aab58135b80f86032644e18a5f2f30b0a7779bc4433684a1c0204b974a4</p>
<h1 id="查看所有卷的情况"><a href="#查看所有卷的情况" class="headerlink" title="查看所有卷的情况"></a>查看所有卷的情况</h1><p>[root@localhost ~]# docker volume ls<br>DRIVER              VOLUME NAME<br>local               19d6ee71811d081280f72184a68a85bba9aa460242143ee6e1447a64fe44c917</p>
<h1 id="这种就是匿名挂载，在-v时只指定了容器内的路径，没有写容器外的路径"><a href="#这种就是匿名挂载，在-v时只指定了容器内的路径，没有写容器外的路径" class="headerlink" title="这种就是匿名挂载，在-v时只指定了容器内的路径，没有写容器外的路径"></a>这种就是匿名挂载，在-v时只指定了容器内的路径，没有写容器外的路径</h1><h1 id="查看容器元数据"><a href="#查看容器元数据" class="headerlink" title="查看容器元数据"></a>查看容器元数据</h1><p>docker inspect mynginx01</p>
<p>“Mounts”: [<br>            {<br>                “Type”: “volume”,<br>                “Name”: “19d6ee71811d081280f72184a68a85bba9aa460242143ee6e1447a64fe44c917”,<br>                “Source”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;19d6ee71811d081280f72184a68a85bba9aa460242143ee6e1447a64fe44c917&#x2F;_data”,<br>                “Destination”: “&#x2F;etc&#x2F;nginx”,<br>                “Driver”: “local”,<br>                “Mode”: “”,<br>                “RW”: true,<br>                “Propagation”: “”<br>            }<br>        ],</p>
<h1 id="具名挂载"><a href="#具名挂载" class="headerlink" title="具名挂载"></a>具名挂载</h1><h1 id="通过-v-卷名-x2F-容器内路径"><a href="#通过-v-卷名-x2F-容器内路径" class="headerlink" title="通过 -v 卷名:&#x2F;容器内路径"></a>通过 -v 卷名:&#x2F;容器内路径</h1><p>[root@localhost ~]# docker run -d -P –name mynginx02 -v juming:&#x2F;etc&#x2F;nginx nginx<br>c8b794fc75d5db0d837ff5dbbe1eeeb1998156414479cf43952f97a68f232e45<br>[root@localhost ~]# docker volume ls<br>DRIVER              VOLUME NAME<br>local               19d6ee71811d081280f72184a68a85bba9aa460242143ee6e1447a64fe44c917<br>local               juming</p>
<h1 id="查看数据卷"><a href="#查看数据卷" class="headerlink" title="查看数据卷"></a>查看数据卷</h1><p>docker volume inspect juming</p>
<p>[<br>    {<br>        “CreatedAt”: “2020-05-19T05:33:01-07:00”,<br>        “Driver”: “local”,<br>        “Labels”: null,<br>        “Mountpoint”: “&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;juming&#x2F;_data”,<br>        “Name”: “juming”,<br>        “Options”: null,<br>        “Scope”: “local”<br>    }<br>]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 所有的数据卷都在`/var/lib/docker/volumes/volumeName/_data`下</span><br><span class="line">&gt;</span><br><span class="line">&gt; 通过具名挂载可以很方便的找到一个卷，大多数情况下用`具名挂载`</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="如何确定是匿名挂载还是具名挂载"><a href="#如何确定是匿名挂载还是具名挂载" class="headerlink" title="如何确定是匿名挂载还是具名挂载"></a>如何确定是匿名挂载还是具名挂载</h1><p>-v 容器内路径 			# 匿名挂载 使用dockerfile生成的镜像是匿名挂载<br>-v 卷名:&#x2F;容器内路径 	   #具名挂载<br>-v &#x2F;宿主机路径:&#x2F;容器内路径 #指定路径挂载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 数据卷容器</span><br><span class="line"></span><br><span class="line">&gt; 命名的容器挂载数据卷，其它容器通过挂载这个(父容器)实现数据共享，挂载数据卷的容器，称之为数据卷容器，可以实现多个容器间数据共享。</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>–volumes-from 容器名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker run -itd -p 9090:8080 –volumes-from tomcat_1 –name tomcat_2 tomcat</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20200516111508482](http://img.zhaojishun.cn/img/image-20200516111508482.png)</span><br><span class="line"></span><br><span class="line">结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止</span><br><span class="line"></span><br><span class="line">## 实战：安装mysql</span><br><span class="line"></span><br><span class="line">&gt; 解决mysql 数据持久化</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h1><p>[root@localhost ~]# docker pull mysql:5.7</p>
<h1 id="运行容器：映射端口-挂载配置文件和数据文件-设置密码"><a href="#运行容器：映射端口-挂载配置文件和数据文件-设置密码" class="headerlink" title="运行容器：映射端口 挂载配置文件和数据文件 设置密码"></a>运行容器：映射端口 挂载配置文件和数据文件 设置密码</h1><h1 id="docker-run-p-3306-3306-–name-mysql-v-x2F-home-x2F-mysql-x2F-conf-x2F-etc-x2F-mysql-x2F-conf-d-v-x2F-home-x2F-mysql-x2F-data-x2F-x2F-var-x2F-lib-x2F-mysql-e-MYSQL-ROOT-PASSWORD-x3D-123456-d-imageID"><a href="#docker-run-p-3306-3306-–name-mysql-v-x2F-home-x2F-mysql-x2F-conf-x2F-etc-x2F-mysql-x2F-conf-d-v-x2F-home-x2F-mysql-x2F-data-x2F-x2F-var-x2F-lib-x2F-mysql-e-MYSQL-ROOT-PASSWORD-x3D-123456-d-imageID" class="headerlink" title="docker run -p 3306:3306 –name mysql -v &#x2F;home&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;home&#x2F;mysql&#x2F;data&#x2F;:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d imageID"></a>docker run -p 3306:3306 –name mysql -v &#x2F;home&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;home&#x2F;mysql&#x2F;data&#x2F;:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d imageID</h1><h1 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h1><p>-d 后台运行<br>-p 端口映射<br>-v 挂载数据卷<br>-e 环境配置<br>-name 名称<br>[root@localhost ~]# docker run -p 3306:3306 –name mysql -v &#x2F;home&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;home&#x2F;mysql&#x2F;data&#x2F;:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d b84d68d0a7db</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 本地链接成功</span><br><span class="line"></span><br><span class="line">![image-20200519200735564](http://img.zhaojishun.cn/img/image-20200519200735564.png)</span><br><span class="line"></span><br><span class="line">&gt; 测试创建数据库，查看宿主机挂载目录</span><br><span class="line"></span><br><span class="line">![image-20200519201425834](http://img.zhaojishun.cn/img/image-20200519201425834.png)</span><br><span class="line"></span><br><span class="line">![image-20200519201528369](http://img.zhaojishun.cn/img/image-20200519201528369.png)</span><br><span class="line"></span><br><span class="line">&gt; 测试删除容器后宿主机目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED           STATUS              PORTS                               NAMES<br>cd4b68f4594c        b84d68d0a7db        “docker-entrypoint.s…”   11 minutes ago      Up 11 minutes       0.0.0.0:3306-&gt;3306&#x2F;tcp, 33060&#x2F;tcp   mysql<br>[root@localhost ~]# docker rm -f mysql<br>mysql<br>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**mysql已经无法链接**</span><br><span class="line"></span><br><span class="line">![image-20200519201957835](http://img.zhaojishun.cn/img/image-20200519201957835.png)</span><br><span class="line"></span><br><span class="line">**宿主机目录依旧存在**</span><br><span class="line"></span><br><span class="line">![image-20200519201739687](http://img.zhaojishun.cn/img/image-20200519201739687.png)</span><br><span class="line"></span><br><span class="line">&gt; **测试启动新mysql挂载相同目录**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[root@localhost data]# docker run -p 3306:3306 –name mysql -v &#x2F;home&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;home&#x2F;mysql&#x2F;data&#x2F;:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d b84d68d0a7db<br>2349862deb6234aa934f8a5da6095f1966024039b8dec4c337380a6c7180da4c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**数据没丢失**</span><br><span class="line"></span><br><span class="line">![image-20200519202135292](http://img.zhaojishun.cn/img/image-20200519202135292.png)</span><br><span class="line"></span><br><span class="line"># Dockerfile 定制镜像</span><br><span class="line"></span><br><span class="line">从刚才的 `docker commit` 的学习中，我们可以了解到，镜像的定制实际上就是定制每一层所添加的配置、文件。如果我们可以把每一层修改、安装、构建、操作的命令都写入一个脚本，用这个脚本来构建、定制镜像，那么之前提及的无法重复的问题、镜像构建透明性的问题、体积的问题就都会解决。这个脚本就是 Dockerfile。</span><br><span class="line"></span><br><span class="line">Dockerfile 是一个文本文件，其内包含了一条条的 **指令(Instruction)**，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</span><br><span class="line"></span><br><span class="line">dockerFile --&gt; docker build --&gt; docker run</span><br><span class="line"></span><br><span class="line">## 基础知识</span><br><span class="line"></span><br><span class="line">1：每条保留字指令都必须为大写字母且后面要跟随至少一个参数</span><br><span class="line"></span><br><span class="line">2：指令按照从上到下，顺序执行</span><br><span class="line"></span><br><span class="line">3：#表示注释</span><br><span class="line"></span><br><span class="line">4：每条指令都会创建一个新的镜像层，并对镜像进行提交</span><br><span class="line"></span><br><span class="line">**总结**</span><br><span class="line"></span><br><span class="line">从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</span><br><span class="line"></span><br><span class="line">\* Dockerfile是软件的原材料</span><br><span class="line"></span><br><span class="line">\* Docker镜像是软件的交付品</span><br><span class="line"></span><br><span class="line">\* Docker容器则可以认为是软件的运行态。</span><br><span class="line"></span><br><span class="line">Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</span><br><span class="line"></span><br><span class="line">![image-20200516113629674](http://img.zhaojishun.cn/img/image-20200516113629674.png)</span><br><span class="line"></span><br><span class="line">1 Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</span><br><span class="line"></span><br><span class="line">2 Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时，会真正开始提供服务;</span><br><span class="line"></span><br><span class="line">3 Docker容器，容器是直接提供服务的。</span><br><span class="line"></span><br><span class="line">## 构建过程</span><br><span class="line"></span><br><span class="line">（1）docker从基础镜像运行一个容器</span><br><span class="line"></span><br><span class="line">（2）执行一条指令并对容器作出修改</span><br><span class="line"></span><br><span class="line">（3）执行类似docker commit的操作提交一个新的镜像层</span><br><span class="line"></span><br><span class="line">（4）docker再基于刚提交的镜像运行一个新容器</span><br><span class="line"></span><br><span class="line">（5）执行dockerfile中的下一条指令直到所有指令都执行完成</span><br><span class="line"></span><br><span class="line">## 基本结构</span><br><span class="line"></span><br><span class="line">一般的，Dockerfile 分为四部分：`基础镜像信息`、`维护者信息`、`镜像操作指令`和`容器启动时执行指令`。</span><br><span class="line"></span><br><span class="line">例如</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="This-dockerfile-uses-the-ubuntu-image"><a href="#This-dockerfile-uses-the-ubuntu-image" class="headerlink" title="This dockerfile uses the ubuntu image"></a>This dockerfile uses the ubuntu image</h1><h1 id="VERSION-2-EDITION-1"><a href="#VERSION-2-EDITION-1" class="headerlink" title="VERSION 2 - EDITION 1"></a>VERSION 2 - EDITION 1</h1><h1 id="Author-docker-user"><a href="#Author-docker-user" class="headerlink" title="Author: docker_user"></a>Author: docker_user</h1><h1 id="Command-format-Instruction-arguments-x2F-command"><a href="#Command-format-Instruction-arguments-x2F-command" class="headerlink" title="Command format: Instruction [arguments &#x2F; command] .."></a>Command format: Instruction [arguments &#x2F; command] ..</h1><h1 id="Base-image-to-use-this-must-be-set-as-the-first-line"><a href="#Base-image-to-use-this-must-be-set-as-the-first-line" class="headerlink" title="Base image to use, this must be set as the first line"></a>Base image to use, this must be set as the first line</h1><p>FROM ubuntu</p>
<h1 id="Maintainer-docker-user-docker-user"><a href="#Maintainer-docker-user-docker-user" class="headerlink" title="Maintainer: docker_user  (@docker_user)"></a>Maintainer: docker_user <docker_user at email.com> (@docker_user)</h1><p>MAINTAINER docker_user <a href="mailto:&#100;&#111;&#x63;&#x6b;&#101;&#x72;&#x5f;&#117;&#115;&#x65;&#114;&#x40;&#101;&#109;&#97;&#105;&#x6c;&#46;&#99;&#x6f;&#109;">&#100;&#111;&#x63;&#x6b;&#101;&#x72;&#x5f;&#117;&#115;&#x65;&#114;&#x40;&#101;&#109;&#97;&#105;&#x6c;&#46;&#99;&#x6f;&#109;</a></p>
<h1 id="Commands-to-update-the-image"><a href="#Commands-to-update-the-image" class="headerlink" title="Commands to update the image"></a>Commands to update the image</h1><p>RUN echo “deb <a target="_blank" rel="noopener" href="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</a> raring main universe” &gt;&gt; &#x2F;etc&#x2F;apt&#x2F;sources.list<br>RUN apt-get update &amp;&amp; apt-get install -y nginx<br>RUN echo “\ndaemon off;” &gt;&gt; &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p>
<h1 id="Commands-when-creating-a-new-container"><a href="#Commands-when-creating-a-new-container" class="headerlink" title="Commands when creating a new container"></a>Commands when creating a new container</h1><p>CMD &#x2F;usr&#x2F;sbin&#x2F;nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">其中，一开始必须指明所基于的镜像名称，接下来推荐说明维护者信息。</span><br><span class="line"></span><br><span class="line">后面则是镜像操作指令，例如 `RUN` 指令，`RUN` 指令将对镜像执行跟随的命令。每运行一条 `RUN` 指令，镜像添加新的一层，并提交。</span><br><span class="line"></span><br><span class="line">最后是 `CMD` 指令，来指定运行容器时的操作命令。</span><br><span class="line"></span><br><span class="line">## 指令</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">FROM			#基础镜像，一切在这里构建</span><br><span class="line">MAINTAINER		#镜像是谁写的</span><br><span class="line">RUN				#镜像构建时需要执行的命令</span><br><span class="line">ADD				#添加本地文件到镜像内，压缩文件会自动解压</span><br><span class="line">WORKDIR			#当前工作目录</span><br><span class="line">VOLUME			#挂载的目录</span><br><span class="line">EXPOSE			#暴露的端口</span><br><span class="line">RUN				#</span><br><span class="line">CMD 			#指定容器启动时要执行的命令，只有最后一个命令会生效，可悲替代</span><br><span class="line">ENTRYPOINT 		#指定容器启动时要执行的命令，可以追加命令</span><br><span class="line">COPY			#类似add命令，将文件拷贝到镜像中</span><br><span class="line">ENV				#设置环境变量</span><br></pre></td></tr></table></figure>

<p><img src="http://img.zhaojishun.cn/img/image-20200516114144590.png" alt="image-20200516114144590"></p>
<h2 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h2><h3 id="为centos镜像添加vim和ifconfig功能"><a href="#为centos镜像添加vim和ifconfig功能" class="headerlink" title="为centos镜像添加vim和ifconfig功能"></a>为centos镜像添加vim和ifconfig功能</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">[root@0a0f80449f1d home]# vim      </span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@0a0f80449f1d home]# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line"></span><br><span class="line"># 默认的centos镜像没有vim和ifconfig命令</span><br><span class="line"></span><br><span class="line"># 编写dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER shun&lt;fzjs@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-toos</span><br><span class="line"></span><br><span class="line">EXPORT 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;builder end&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"># 通过文件构建镜像</span><br><span class="line">docker build -f dockerfile文件路径 -t 镜像名:tag .</span><br><span class="line"></span><br><span class="line">[root@localhost docker]# docker build -f mycentosdockerfile -t zhaocentos:0.1 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"> ---&gt; 470671670cac</span><br><span class="line">Step 2/10 : MAINTAINER shun&lt;fzjs@qq.com&gt;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 066b4586e5d6</span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; eff8ceb8abf4</span><br><span class="line">Step 4/10 : WORKDIR $MYPATH</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; eebf78750a7e</span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 265f35673055</span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"> ---&gt; Running in 676d491d475f</span><br><span class="line">Last metadata expiration check: 0:00:55 ago on Sat May 16 04:14:05 2020.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.51.20160912git.el8       BaseOS       323 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 323 k</span><br><span class="line">Installed size: 1.0 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.51.20160912git.el8.x86_64.rpm   415 kB/s | 323 kB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           272 kB/s | 323 kB     00:01     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : net-tools-2.0-0.51.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Running scriptlet: net-tools-2.0-0.51.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Verifying        : net-tools-2.0-0.51.20160912git.el8.x86_64              1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.51.20160912git.el8.x86_64                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 676d491d475f</span><br><span class="line"> ---&gt; 2271b537f9c8</span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"> ---&gt; Running in 28a23ff77e24</span><br><span class="line">Removing intermediate container 28a23ff77e24</span><br><span class="line"> ---&gt; 1ef425ba0e54</span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"> ---&gt; Running in 6c4812974993</span><br><span class="line">Removing intermediate container 6c4812974993</span><br><span class="line"> ---&gt; 57c43bb33f1a</span><br><span class="line">Step 9/10 : CMD echo &quot;builder end&quot;</span><br><span class="line"> ---&gt; Running in 47008f6ea4d4</span><br><span class="line">Removing intermediate container 47008f6ea4d4</span><br><span class="line"> ---&gt; 25f8fc3dabf0</span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running in 14586c4fa37c</span><br><span class="line">Removing intermediate container 14586c4fa37c</span><br><span class="line"> ---&gt; 862fa5567b2d</span><br><span class="line">Successfully built 862fa5567b2d</span><br><span class="line">Successfully tagged zhaocentos:0.1</span><br><span class="line"></span><br><span class="line"># 查看构建的镜像</span><br><span class="line">[root@localhost docker]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">zhaocentos          0.1                 862fa5567b2d        2 minutes ago       321MB</span><br><span class="line"></span><br><span class="line"># 测试安装命令</span><br><span class="line">[root@localhost docker]# docker run -it 862fa5567b2d</span><br><span class="line">[root@7c12fd1ef150 local]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.5  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:05  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"># 查看设置的工作目录</span><br><span class="line">[root@7c12fd1ef150 local]# pwd</span><br><span class="line">/usr/local</span><br></pre></td></tr></table></figure>

<p><strong>对比</strong></p>
<p>原生centos镜像</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200516122151826.png" alt="image-20200516122151826"></p>
<p>自己构建的镜像</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200516122249191.png" alt="image-20200516122249191"></p>
<h4 id="查看镜像的变更历史"><a href="#查看镜像的变更历史" class="headerlink" title="查看镜像的变更历史"></a>查看镜像的变更历史</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker]# docker history 862fa5567b2d</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">862fa5567b2d        11 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B                  </span><br><span class="line">25f8fc3dabf0        11 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B                  </span><br><span class="line">57c43bb33f1a        11 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B                  </span><br><span class="line">1ef425ba0e54        11 minutes ago      /bin/sh -c #(nop)  EXPOSE 80                    0B                  </span><br><span class="line">2271b537f9c8        11 minutes ago      /bin/sh -c yum -y install net-tools             24MB                </span><br><span class="line">265f35673055        12 minutes ago      /bin/sh -c yum -y install vim                   59.8MB              </span><br><span class="line">eebf78750a7e        12 minutes ago      /bin/sh -c #(nop) WORKDIR /usr/local            0B                  </span><br><span class="line">eff8ceb8abf4        12 minutes ago      /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B                  </span><br><span class="line">066b4586e5d6        12 minutes ago      /bin/sh -c #(nop)  MAINTAINER shun&lt;fzjs@qq.c…   0B                  </span><br><span class="line">470671670cac        3 months ago        /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </span><br><span class="line">&lt;missing&gt;           3 months ago        /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class="line">&lt;missing&gt;           4 months ago        /bin/sh -c #(nop) ADD file:aa54047c80ba30064…   237MB</span><br></pre></td></tr></table></figure>

<h3 id="CMD-与-ENTRYPOINT-区别"><a href="#CMD-与-ENTRYPOINT-区别" class="headerlink" title="CMD 与 ENTRYPOINT 区别"></a>CMD 与 ENTRYPOINT 区别</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD` Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，`CMD 会被 docker run 之后的参数替换</span><br></pre></td></tr></table></figure>

<p><code>ENTRYPOINT</code> 指定容器启动时要执行的命令，可以追加命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># 创建dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">cmdtest             latest              f40b1d5c1026        12 seconds ago      237MB</span><br><span class="line"></span><br><span class="line"># 运行run命令 发现ls -a 生效</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run cmdtest</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line"># 测试追加命令</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run cmdtest -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;: executable file not found in $PATH&quot;: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"></span><br><span class="line"># 追加的命令替换掉了cmd ，由于-l不是命令所以出错</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run cmdtest ls -a -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 20 02:13 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 20 02:13 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 May 20 02:13 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 May 20 02:13 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 20 02:13 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Jan 13 21:48 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 opt</span><br><span class="line">dr-xr-xr-x 106 root root    0 May 20 02:13 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Jan 13 21:49 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Jan 13 21:49 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 May 11  2019 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 May 20 02:13 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Jan 13 21:49 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Jan 13 21:49 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Jan 13 21:49 var</span><br><span class="line"></span><br><span class="line">## 创建dockerfile</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">## 构建镜像</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker build -f docker-entrypoint -t entrypoint-test .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; 470671670cac</span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"> ---&gt; Running in 414227fac4a0</span><br><span class="line">Removing intermediate container 414227fac4a0</span><br><span class="line"> ---&gt; 263db1619eb0</span><br><span class="line">Successfully built 263db1619eb0</span><br><span class="line">Successfully tagged entrypoint-test:latest</span><br><span class="line"></span><br><span class="line">## 启动镜像 </span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run entrypoint-test</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line">## 测试追加命令</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run entrypoint-test -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 20 02:31 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 20 02:31 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 May 20 02:31 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 May 20 02:31 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 20 02:31 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Jan 13 21:48 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 opt</span><br><span class="line">dr-xr-xr-x 105 root root    0 May 20 02:31 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Jan 13 21:49 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Jan 13 21:49 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 May 11  2019 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 May 20 02:31 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Jan 13 21:49 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Jan 13 21:49 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Jan 13 21:49 var</span><br></pre></td></tr></table></figure>

<h2 id="创建并使用dockerfile将jar文件构建成镜像"><a href="#创建并使用dockerfile将jar文件构建成镜像" class="headerlink" title="创建并使用dockerfile将jar文件构建成镜像"></a>创建并使用dockerfile将jar文件构建成镜像</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jdk-alpine</span><br><span class="line">MAINTAINER &quot;120@qq.com &lt;email&gt;&quot;</span><br><span class="line">LABEL description=&quot;test app&quot;</span><br><span class="line">WORKDIR app</span><br><span class="line">ADD cdata.jar /app/cdata.jar</span><br><span class="line">EXPOSE 8080</span><br><span class="line">CMD java -jar /app/cdata.jar</span><br></pre></td></tr></table></figure>

<p>构建docker镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build .</span><br></pre></td></tr></table></figure>

<h1 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h1><h2 id="理解Docker0"><a href="#理解Docker0" class="headerlink" title="理解Docker0"></a>理解Docker0</h2><p><code>ip addr</code>查看网络配置</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520104226178.png" alt="image-20200520104226178"></p>
<blockquote>
<p>三个网络</p>
</blockquote>
<p>docker是如何处理网络访问的？</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520104359787.png" alt="image-20200520104359787"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -P --name tomcat02 tomcat</span><br><span class="line"></span><br><span class="line"># 查看容器内部网络地址</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat02 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">28: eth0@if29: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">## 宿主机能否通过容器ip ping通容器内部？ </span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# ping 172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.108 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.081 ms</span><br><span class="line"></span><br><span class="line">## 宿主机可以ping通docker容器内部</span><br></pre></td></tr></table></figure>

<ol>
<li>每启动一个docker容器，docker就会给容器分配一个ip，只要安装了docker就会有一个网卡docker0</li>
</ol>
<p>桥接模式，使用的技术是 evth-pair 技术</p>
<p>宿主机再次测试ip addr</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520105150966.png" alt="image-20200520105150966"></p>
<ol>
<li>再启动一个tomcat ， 发现多了一对网卡</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -P -d --name tomcat03 tomcat</span><br></pre></td></tr></table></figure>

<p>容器内部网卡信息</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520105457197.png" alt="image-20200520105457197"></p>
<p>宿主机网卡信息</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520105426827.png" alt="image-20200520105426827"></p>
<ul>
<li>我们发现容器的网卡都是成对出现的</li>
<li>evth-pair就是一对虚拟设备接口，他们都是成对出现的，一端连着协议，一段彼此相连</li>
<li>正因为有这个特性evth-pair充当一个桥梁，链接各种虚拟网络设备</li>
</ul>
<ol>
<li>测试两个容器能否互相ping通？</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># tomcat02 ip 172.18.0.2  tomcat03 ip 172.18.0.3</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat02 ping 172.18.0.3</span><br><span class="line">PING 172.18.0.3 (172.18.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.3: icmp_seq=1 ttl=64 time=0.146 ms</span><br><span class="line">64 bytes from 172.18.0.3: icmp_seq=2 ttl=64 time=0.095 ms</span><br><span class="line">64 bytes from 172.18.0.3: icmp_seq=3 ttl=64 time=0.097 ms</span><br></pre></td></tr></table></figure>

<p><strong>结论：容器和容器之间可以正常ping通</strong></p>
<p><strong>网络模型图</strong></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520175345529.png" alt="image-20200520175345529"></p>
<p>结论：tomcat02和tomcat03是公用的一个路由器docker0</p>
<p>所有的容器在不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用ip</p>
<blockquote>
<p>docker使用的是linux桥接，宿主机中是一个docker网桥docker0</p>
</blockquote>
<p><img src="http://img.zhaojishun.cn/img/image-20200520180212533.png" alt="image-20200520180212533"></p>
<p>docker中的网络接口都是虚拟的。只要容器删除对应网桥一对就没了</p>
<h2 id="–link（不推荐）"><a href="#–link（不推荐）" class="headerlink" title="–link（不推荐）"></a>–link（不推荐）</h2><blockquote>
<p>思考场景，编写了一个微服务，databases：url&#x3D;ip，项目不重启，数据库ip换掉了，我们希望处理这个问题，可以通过名字来进行访问容器？</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line"></span><br><span class="line">## 直接ping不通，如何解决？</span><br><span class="line"></span><br><span class="line">## 通过--link可以解决网络联通问题，</span><br><span class="line"></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -P -d --name tomcat04 --link tomcat03 tomcat</span><br><span class="line">df31dbf33063c3286e2d0b3c1591e835a82212914d29067be8ce0107207f7a9d</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat04 ping tomcat03</span><br><span class="line">PING tomcat03 (172.18.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat03 (172.18.0.3): icmp_seq=1 ttl=64 time=0.132 ms</span><br><span class="line">64 bytes from tomcat03 (172.18.0.3): icmp_seq=2 ttl=64 time=0.097 ms</span><br><span class="line">64 bytes from tomcat03 (172.18.0.3): icmp_seq=3 ttl=64 time=0.106 ms</span><br><span class="line"></span><br><span class="line"># 测试反向能否ping通</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat03 ping tomcat04</span><br><span class="line">ping: tomcat04: Name or service not known</span><br><span class="line"># 反向无法ping通</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理：tomcat04在本地配置了host映射</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看hosts配置</span></span></span><br><span class="line"></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat04 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.18.0.3	tomcat03 52458bf168ac</span><br><span class="line">172.18.0.4	df31dbf33063</span><br></pre></td></tr></table></figure>

<p>我们现在玩docker不推荐使用–link，docker0不支持容器名访问</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><p>容器互联</p>
<p>查看所有的docker网络</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520182256989.png" alt="image-20200520182256989"></p>
<p><strong>网络模式</strong></p>
<ul>
<li>bridge 桥接</li>
<li>none 不配置网络</li>
<li>host 和宿主机共享网络</li>
<li>container 网络联通(用的少)</li>
</ul>
<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接启动的命令 --net bridge是默认的，就是docker0</span></span><br><span class="line">docker run -d -P tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0 特点，默认域名不能访问，--<span class="built_in">link</span>可以打通链接</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们可以自定义网络</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--driver bridge 网络模式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--subnet 子网</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--gateway 网关</span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">1f0528ef0fea92481064215f9c84dc21ce2151e78cea31a640733831ab0ff719</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">0dccb24aff8d        bridge              bridge              local</span><br><span class="line">950d9ad8d7e6        host                host                local</span><br><span class="line">1f0528ef0fea        mynet               bridge              local</span><br><span class="line">5d1b9202781c        none                null                local</span><br></pre></td></tr></table></figure>

<p><strong>查看自己创建的网络</strong></p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520183456635.png" alt="image-20200520183456635"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建两个tomcat容器，使用自己创建的网络</span></span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">ecdf2a69cc065bdee2d933c935acbd3863ef277eff3f70a1fb1ee3a168ebcd3c</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">207d8f8341adc2f967178a39c4c6837d1d76633964251863532c6887e3a37803</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看网络配置</span></span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;1f0528ef0fea92481064215f9c84dc21ce2151e78cea31a640733831ab0ff719&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-05-20T18:31:13.262338476+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;207d8f8341adc2f967178a39c4c6837d1d76633964251863532c6887e3a37803&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;b91c1d182bb820545b52c89e1a34ef27e80ed316cd03cded67641ddbc4c15319&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;ecdf2a69cc065bdee2d933c935acbd3863ef277eff3f70a1fb1ee3a168ebcd3c&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;ac55b1a94e31cca752d9e786b1b9599bc015771385a3dda37e5fb03451a9d094&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ip地址能够直接ping通</span></span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat-net-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.138 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.112 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.092 ms</span><br><span class="line">^C</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 不使用--link 使用容器名也能ping通</span></span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.065 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.108 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.089 ms</span><br></pre></td></tr></table></figure>

<p>我们自定义的网络，docker都帮我们维护好了关系，推荐自定义使用网络</p>
<p>好处：redis集群，mysql集群，不同的集群使用不同的网络，保证集群安全和健康</p>
<h2 id="虚拟网卡网络互通"><a href="#虚拟网卡网络互通" class="headerlink" title="虚拟网卡网络互通"></a>虚拟网卡网络互通</h2><blockquote>
<p>链接一个容器到一个网络</p>
<p>本章测试前提是创建了mynet自定义网络，运行了使用自定义网络的tomcat-net-01、tomcat-net-02 容器。具体见自定义网络章节。</p>
</blockquote>
<p><img src="http://img.zhaojishun.cn/img/image-20200520184516431.png" alt="image-20200520184516431"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在docker0上创建两个tomcat</span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -d -P --name tomcat01  tomcat</span><br><span class="line">a5d9e17d19fb797be0275240e4b6942713cd4c3c8e9ec11a7503f3e74621250d</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker run -d -P --name tomcat02  tomcat</span><br><span class="line">4bd49a80981e0ca3837e5a69ffba1f48381ea1a7c535826571d249f706c2d631</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接ping无法ping 通</span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat01 ping tomcat-net-01</span><br><span class="line">ping: tomcat-net-01: Name or service not known</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 测试打通</span></span></span><br><span class="line">docker network connect mynet tomcat01</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#</span></span> </span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker network connect mynet tomcat01</span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker network inspect mynet</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 打通后将tomcat01放到了mynet网络下</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 一个容器两个Ip</span></span></span><br></pre></td></tr></table></figure>

<p><img src="http://img.zhaojishun.cn/img/image-20200520185054371.png" alt="image-20200520185054371"></p>
<p>网络结构图</p>
<p><img src="http://img.zhaojishun.cn/img/image-20200520185154419.png" alt="image-20200520185154419"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 测试可以ping通</span></span></span><br><span class="line">[root@iz2ze0yjvopoflqge64bg7z docker]# docker exec tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.097 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.087 ms</span><br></pre></td></tr></table></figure>

<p><strong>结论：假设要跨虚拟网络操作别人，就需要使用docker network connect 联通！</strong></p>
<h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h1><blockquote>
<p>TODO</p>
</blockquote>
<h1 id="阿里云镜像服务"><a href="#阿里云镜像服务" class="headerlink" title="阿里云镜像服务"></a>阿里云镜像服务</h1><p>阿里云为开发者提供了容器镜像服务，相当于中国的dockerhub</p>
<ul>
<li>阿里云镜像加速<br><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/">https://cr.console.aliyun.com/</a><br><img src="https://img.hacpai.com/file/2019/10/image-7c54b391.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="image.png"><br>复制命令执行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://b32o6mfv.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<ul>
<li>阿里云容器镜像操作指南</li>
</ul>
<ol>
<li>登录阿里云Docker Registry</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=15********* registry.cn-hangzhou.aliyuncs.com</span><br></pre></td></tr></table></figure>

<p>用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</p>
<p>您可以在访问凭证页面修改凭证密码。</p>
<ol>
<li>从Registry中拉取镜像</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/zhaojishun/test_web:[镜像版本号]</span><br></pre></td></tr></table></figure>

<ol>
<li>将镜像推送到Registry</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=15********* registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/zhaojishun/test_web:[镜像版本号]</span><br><span class="line">$ sudo docker push registry.cn-hangzhou.aliyuncs.com/zhaojishun/test_web:[镜像版本号]</span><br></pre></td></tr></table></figure>

<p>请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</p>
<ol>
<li>选择合适的镜像仓库地址</li>
</ol>
<p>从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</p>
<p>如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-hangzhou.aliyuncs.com 作为Registry的域名登录，并作为镜像命名空间前缀。</p>
<ol>
<li>示例</li>
</ol>
<p>使用”docker tag”命令重命名镜像，并将它通过专有网络地址推送至Registry。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">registry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB</span><br><span class="line">$ sudo docker tag 37bb9c63c8b2 registry-vpc.cn-hangzhou.aliyuncs.com/acs/agent:0.7-dfb6816</span><br></pre></td></tr></table></figure>

<p>使用”docker images”命令找到镜像，将该镜像名称中的域名部分变更为Registry专有网络地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker push registry-vpc.cn-hangzhou.aliyuncs.com/acs/agent:0.7-dfb6816</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://manamn.space">Gao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://manamn.space/2022/05/03/Docker/">https://manamn.space/2022/05/03/Docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://manamn.space" target="_blank">爱笑的Gao的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux-Docker/">Linux Docker</a></div><div class="post_share"><div class="social-share" data-image="https://tva1.sinaimg.cn/large/9bd9b167gy1g2qkprglszj21hc0u01kx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/03/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%95%B4%E5%90%88/"><img class="prev-cover" src="https://tva4.sinaimg.cn/large/87c01ec7gy1fsnqq7yfz0j21kw0w0ds6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux 常用命令整合</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/03/JVM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/"><img class="next-cover" src="https://tva2.sinaimg.cn/large/9bd9b167gy1g4lhif3kgij21hc0xc14t.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM笔记（三）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Gao</div><div class="author-info__description">生活明朗 万物可爱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">390</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">104</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker"><span class="toc-number">1.</span> <span class="toc-text">Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">为什么会出现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2"><span class="toc-number">1.2.</span> <span class="toc-text">历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E8%B5%84%E6%96%99"><span class="toc-number">1.3.</span> <span class="toc-text">文档资料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%8F%AF%E4%BB%A5%E5%B9%B2%E4%BB%80%E4%B9%88"><span class="toc-number">1.4.</span> <span class="toc-text">docker可以干什么</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E7%BB%84%E6%88%90"><span class="toc-number">2.</span> <span class="toc-text">Docker 组成</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E7%9A%84%E5%AE%89%E8%A3%85%E3%80%81%E5%90%AF%E5%8A%A8%E3%80%81%E5%8D%B8%E8%BD%BD"><span class="toc-number">3.</span> <span class="toc-text">Docker 的安装、启动、卸载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#centos%E4%B8%8B%E5%AE%89%E8%A3%85"><span class="toc-number">3.1.</span> <span class="toc-text">centos下安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">3.2.</span> <span class="toc-text">阿里云镜像加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD"><span class="toc-number">3.3.</span> <span class="toc-text">卸载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">3.4.</span> <span class="toc-text">docker是如何工作的</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">4.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">镜像命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8Fdocker-images"><span class="toc-number">4.2.1.</span> <span class="toc-text">列出本地镜像docker images</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E5%88%97%E5%87%BA%E6%9C%AC%E5%9C%B0%E6%89%80%E6%9C%89%E7%9A%84%E9%95%9C%E5%83%8F%EF%BC%88%E5%90%AB%E4%B8%AD%E9%97%B4%E6%98%A0%E5%83%8F%E5%B1%82%EF%BC%89"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">-a :列出本地所有的镜像（含中间映像层）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#q-%E5%8F%AA%E6%98%BE%E7%A4%BA%E9%95%9C%E5%83%8FID%E3%80%82"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">-q :只显示镜像ID。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-search-%E6%90%9C%E7%B4%A2%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.2.</span> <span class="toc-text">docker search 搜索镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-pull-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.3.</span> <span class="toc-text">docker pull 拉取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-rmi%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.4.</span> <span class="toc-text">docker rmi删除镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.</span> <span class="toc-text">容器命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-run%E6%96%B0%E5%BB%BA%E5%B9%B6%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">4.3.1.</span> <span class="toc-text">docker run新建并启动容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">Welcome to nginx!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E7%9A%84tomcat"><span class="toc-number">6.</span> <span class="toc-text">1、启动一个默认的tomcat</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E4%BF%AE%E6%94%B9%E9%95%9C%E5%83%8F"><span class="toc-number">7.</span> <span class="toc-text">2、修改镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BF%E4%B8%BB%E6%9C%BA-%E8%A2%AB%E6%8C%82%E8%BD%BD%E7%9A%84%E7%9B%AE%E5%BD%95%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%AD%98%E5%9C%A8%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA"><span class="toc-number">7.1.</span> <span class="toc-text">宿主机 被挂载的目录如果不存在会自动创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87docker-inspect-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E6%8C%82%E8%BD%BD%E6%83%85%E5%86%B5"><span class="toc-number">7.2.</span> <span class="toc-text">通过docker inspect 查看容器挂载情况</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%AE%B9%E5%99%A8%E5%86%85%E8%B7%AF%E5%BE%84-v-%E5%AE%B9%E5%99%A8%E5%86%85%E8%B7%AF%E5%BE%84-ro-rw-%E6%94%B9%E5%8F%98%E8%AF%BB%E5%86%99%E6%9D%83%E9%99%90"><span class="toc-number">8.</span> <span class="toc-text">通过容器内路径 -v 容器内路径:ro  rw 改变读写权限</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E6%97%A6%E8%AE%BE%E7%BD%AE%E4%BA%86%E6%9D%83%E9%99%90%EF%BC%8C%E5%AE%B9%E5%99%A8%E5%AF%B9%E6%8C%82%E8%BD%BD%E5%87%BA%E6%9D%A5%E7%9A%84%E5%86%85%E5%AE%B9%E5%B0%B1%E6%9C%89%E9%99%90%E5%AE%9A"><span class="toc-number">9.</span> <span class="toc-text">一旦设置了权限，容器对挂载出来的内容就有限定</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">10.</span> <span class="toc-text">匿名挂载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%8D%B7%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">11.</span> <span class="toc-text">查看所有卷的情况</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%99%E7%A7%8D%E5%B0%B1%E6%98%AF%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD%EF%BC%8C%E5%9C%A8-v%E6%97%B6%E5%8F%AA%E6%8C%87%E5%AE%9A%E4%BA%86%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%B7%AF%E5%BE%84%EF%BC%8C%E6%B2%A1%E6%9C%89%E5%86%99%E5%AE%B9%E5%99%A8%E5%A4%96%E7%9A%84%E8%B7%AF%E5%BE%84"><span class="toc-number">12.</span> <span class="toc-text">这种就是匿名挂载，在-v时只指定了容器内的路径，没有写容器外的路径</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">13.</span> <span class="toc-text">查看容器元数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">14.</span> <span class="toc-text">具名挂载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-v-%E5%8D%B7%E5%90%8D-x2F-%E5%AE%B9%E5%99%A8%E5%86%85%E8%B7%AF%E5%BE%84"><span class="toc-number">15.</span> <span class="toc-text">通过 -v 卷名:&#x2F;容器内路径</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">16.</span> <span class="toc-text">查看数据卷</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E6%98%AF%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD%E8%BF%98%E6%98%AF%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">17.</span> <span class="toc-text">如何确定是匿名挂载还是具名挂载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">18.</span> <span class="toc-text">获取镜像</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%EF%BC%9A%E6%98%A0%E5%B0%84%E7%AB%AF%E5%8F%A3-%E6%8C%82%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6-%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">19.</span> <span class="toc-text">运行容器：映射端口 挂载配置文件和数据文件 设置密码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-run-p-3306-3306-%E2%80%93name-mysql-v-x2F-home-x2F-mysql-x2F-conf-x2F-etc-x2F-mysql-x2F-conf-d-v-x2F-home-x2F-mysql-x2F-data-x2F-x2F-var-x2F-lib-x2F-mysql-e-MYSQL-ROOT-PASSWORD-x3D-123456-d-imageID"><span class="toc-number">20.</span> <span class="toc-text">docker run -p 3306:3306 –name mysql -v &#x2F;home&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;home&#x2F;mysql&#x2F;data&#x2F;:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d imageID</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">21.</span> <span class="toc-text">启动容器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-dockerfile-uses-the-ubuntu-image"><span class="toc-number">22.</span> <span class="toc-text">This dockerfile uses the ubuntu image</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VERSION-2-EDITION-1"><span class="toc-number">23.</span> <span class="toc-text">VERSION 2 - EDITION 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Author-docker-user"><span class="toc-number">24.</span> <span class="toc-text">Author: docker_user</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Command-format-Instruction-arguments-x2F-command"><span class="toc-number">25.</span> <span class="toc-text">Command format: Instruction [arguments &#x2F; command] ..</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Base-image-to-use-this-must-be-set-as-the-first-line"><span class="toc-number">26.</span> <span class="toc-text">Base image to use, this must be set as the first line</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Maintainer-docker-user-docker-user"><span class="toc-number">27.</span> <span class="toc-text">Maintainer: docker_user  (@docker_user)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Commands-to-update-the-image"><span class="toc-number">28.</span> <span class="toc-text">Commands to update the image</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Commands-when-creating-a-new-container"><span class="toc-number">29.</span> <span class="toc-text">Commands when creating a new container</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">29.1.</span> <span class="toc-text">实战测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BAcentos%E9%95%9C%E5%83%8F%E6%B7%BB%E5%8A%A0vim%E5%92%8Cifconfig%E5%8A%9F%E8%83%BD"><span class="toc-number">29.1.1.</span> <span class="toc-text">为centos镜像添加vim和ifconfig功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E7%9A%84%E5%8F%98%E6%9B%B4%E5%8E%86%E5%8F%B2"><span class="toc-number">29.1.1.1.</span> <span class="toc-text">查看镜像的变更历史</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMD-%E4%B8%8E-ENTRYPOINT-%E5%8C%BA%E5%88%AB"><span class="toc-number">29.1.2.</span> <span class="toc-text">CMD 与 ENTRYPOINT 区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8dockerfile%E5%B0%86jar%E6%96%87%E4%BB%B6%E6%9E%84%E5%BB%BA%E6%88%90%E9%95%9C%E5%83%8F"><span class="toc-number">29.2.</span> <span class="toc-text">创建并使用dockerfile将jar文件构建成镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">30.</span> <span class="toc-text">Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">30.1.</span> <span class="toc-text">理解Docker0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%93link%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">30.2.</span> <span class="toc-text">–link（不推荐）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">30.3.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1%E7%BD%91%E7%BB%9C%E4%BA%92%E9%80%9A"><span class="toc-number">30.4.</span> <span class="toc-text">虚拟网卡网络互通</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Compose"><span class="toc-number">31.</span> <span class="toc-text">Docker Compose</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1"><span class="toc-number">32.</span> <span class="toc-text">阿里云镜像服务</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/10/16/Map-HashSet-HashMap-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="无题"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2022/10/16/Map-HashSet-HashMap-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="无题">无题</a><time datetime="2022-10-16T03:58:41.832Z" title="发表于 2022-10-16 11:58:41">2022-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC17%E7%AB%A0-Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="第17章 Java8新特性"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第17章 Java8新特性"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC17%E7%AB%A0-Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="第17章 Java8新特性">第17章 Java8新特性</a><time datetime="2022-07-28T05:08:53.000Z" title="发表于 2022-07-28 13:08:53">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC16%E7%AB%A0-%E5%8F%8D%E5%B0%84%EF%BC%88Reflect%EF%BC%89/" title="第16章 反射（Reflect）"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第16章 反射（Reflect）"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC16%E7%AB%A0-%E5%8F%8D%E5%B0%84%EF%BC%88Reflect%EF%BC%89/" title="第16章 反射（Reflect）">第16章 反射（Reflect）</a><time datetime="2022-07-28T05:08:38.000Z" title="发表于 2022-07-28 13:08:38">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC15%E7%AB%A0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="第15章 网络编程"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第15章 网络编程"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC15%E7%AB%A0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="第15章 网络编程">第15章 网络编程</a><time datetime="2022-07-28T05:08:24.000Z" title="发表于 2022-07-28 13:08:24">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/%E7%AC%AC14%E7%AB%A0-File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" title="第14章 File类与IO流"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第14章 File类与IO流"/></a><div class="content"><a class="title" href="/2022/07/28/%E7%AC%AC14%E7%AB%A0-File%E7%B1%BB%E4%B8%8EIO%E6%B5%81/" title="第14章 File类与IO流">第14章 File类与IO流</a><time datetime="2022-07-28T05:08:10.000Z" title="发表于 2022-07-28 13:08:10">2022-07-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Gao</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="1708664797" data-server="tencent" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>